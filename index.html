<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✏️ 成长手账 | 智能同步版</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- 引入手绘风格字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ====== 手绘风格全局样式 ====== */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Comic Neue', cursive, -apple-system, sans-serif;
            background: #fef9f3 url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffd6cc' fill-opacity='0.3' fill-rule='evenodd'/%3E%3C/svg%3E");
            min-height: 100vh;
            color: #5a4a42;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }

        /* ====== 手绘标题与导航 ====== */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: #fffaf0;
            border-radius: 24px 24px 48px 24px;
            color: #5a4a42;
            box-shadow: 8px 8px 0px #e0c9b8, 12px 12px 15px rgba(0, 0, 0, 0.05);
            border: 3px solid #5a4a42;
            position: relative;
        }
        .header::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 30px;
            width: 120px;
            height: 10px;
            background: #ff9a8b;
            border-radius: 5px;
            opacity: 0.7;
        }
        .header h1 {
            font-size: 3.2em;
            margin-bottom: 10px;
            font-family: 'Gochi Hand', cursive;
            color: #5a4a42;
            text-shadow: 3px 3px 0px #ffd6cc;
            letter-spacing: 1px;
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        /* ====== 手绘网格布局 ====== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(3, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        /* ====== 手绘卡片设计 ====== */
        .card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 30px;
            box-shadow: 6px 6px 0px #d4b8a7, 10px 10px 20px rgba(0, 0, 0, 0.07);
            border: 2.5px solid #5a4a42;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
        }
        .card::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 1px dashed #ff9a8b;
            border-radius: 24px 10px 24px 10px;
            pointer-events: none;
            opacity: 0.6;
        }
        .card:hover {
            transform: translateY(-5px) rotate(0.5deg);
            box-shadow: 8px 8px 0px #c9a58f, 15px 15px 25px rgba(0, 0, 0, 0.09);
        }
        .card h2 {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px dotted #ff9a8b;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            color: #5a4a42;
            font-size: 1.6em;
            font-family: 'Gochi Hand', cursive;
        }
        .card h2 .collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            color: #ff6b6b;
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #ff9a8b;
            background: #fffaf5;
            transition: all 0.3s;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
        }
        .card h2 .collapse-btn:hover {
            background: #ff9a8b;
            color: white;
            transform: scale(1.05);
        }

        /* ====== 手绘玩家等级显示 ====== */
        .level-display {
            font-size: 5em;
            font-weight: 800;
            text-align: center;
            margin: 25px 0;
            font-family: 'Gochi Hand', cursive;
            color: #ff6b6b;
            text-shadow: 4px 4px 0px #ffd6cc, 8px 8px 8px rgba(0,0,0,0.1);
            letter-spacing: -2px;
            transform: rotate(-2deg);
        }
        .xp-progress {
            height: 26px;
            background: #ffe8d6;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid #5a4a42;
            box-shadow: inset 3px 3px 5px rgba(0,0,0,0.1);
        }
        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #a3de83);
            border-radius: 13px;
            transition: width 0.7s ease;
            box-shadow: inset 2px 2px 4px rgba(255,255,255,0.5);
        }

        /* ====== 手绘任务与技能项 ====== */
        .skill-item {
            padding: 20px;
            background: #fffaf5;
            border-radius: 16px 8px 16px 8px;
            margin: 16px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-left: 6px solid transparent;
            border: 2px solid #e0c9b8;
            position: relative;
        }
        .skill-item::before {
            content: '☁️';
            position: absolute;
            top: -12px;
            right: 10px;
            font-size: 1.2em;
            opacity: 0.5;
        }
        .skill-item:hover {
            background: #fffef9;
            border-left-color: #ff9a8b;
            transform: translateX(5px);
        }
        .xp-badge {
            background: linear-gradient(45deg, #ff9a00, #ff5e00);
            color: white;
            padding: 6px 16px;
            border-radius: 20px 8px 20px 8px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
            border: 1px solid #fff;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        /* ====== 手绘按钮样式 ====== */
        .btn {
            background: linear-gradient(90deg, #ff9a8b, #ff6b6b);
            border: none;
            padding: 16px 32px;
            border-radius: 50px 15px 50px 15px;
            color: white;
            cursor: pointer;
            font-size: 17px;
            font-weight: 700;
            font-family: 'Comic Neue', cursive;
            transition: all 0.3s;
            display: block;
            width: 100%;
            margin-top: 20px;
            box-shadow: 4px 4px 0px #d45d5d;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        .btn:hover {
            transform: translateY(-3px) rotate(0.5deg);
            box-shadow: 6px 6px 0px #b84a4a;
        }
        .btn:active {
            transform: translateY(1px);
            box-shadow: 2px 2px 0px #d45d5d;
        }
        .btn-sm {
            padding: 10px 24px;
            font-size: 0.95em;
            width: auto;
            border-radius: 30px 8px 30px 8px;
            background: linear-gradient(90deg, #4ecdc4, #a3de83);
            box-shadow: 3px 3px 0px #2ba69b;
            border: none;
            color: white;
            font-weight: bold;
        }

        /* ====== 手绘配置面板 ====== */
        .config-panel {
            max-width: 600px;
            margin: 40px auto;
        }
        .config-info {
            padding: 20px;
            background: #fff9f0;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 0.95em;
            border: 2px dashed #ffc8a3;
        }
        .config-info a {
            color: #ff6b6b;
            font-weight: bold;
            text-decoration: underline wavy;
        }

        /* ====== 手绘笔记系统 ====== */
        .note-section {
            margin-top: 40px;
        }
        .note-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .note-tab {
            padding: 14px 32px;
            background: #fffaf5;
            border-radius: 40px 12px 40px 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            border: 2px solid #e0c9b8;
            font-family: 'Comic Neue', cursive;
            color: #5a4a42;
        }
        .note-tab.active {
            background: linear-gradient(90deg, #a3de83, #4ecdc4);
            color: white;
            border-color: #2ba69b;
            box-shadow: 4px 4px 0px #2ba69b;
            transform: rotate(-0.5deg);
        }
        .note-editor {
            background: #fffefc;
            border-radius: 20px 10px 20px 10px;
            padding: 30px;
            box-shadow: 6px 6px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            margin-bottom: 30px;
        }
        .note-input, .tag-input, .note-textarea {
            width: 100%;
            padding: 18px;
            border: 2.5px solid #e0c9b8;
            border-radius: 15px 5px 15px 5px;
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
            margin-bottom: 25px;
            transition: all 0.3s;
            background: #fffaf9;
        }
        .note-textarea {
            min-height: 200px;
            resize: vertical;
        }
        .note-input:focus, .tag-input:focus, .note-textarea:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
            background: #fff;
        }
        .note-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }
        /* 读书笔记在网格布局中的适配 */
/* ====== 修正：读书笔记在网格布局中的适配 ====== */
.note-list .book-note-card {
    grid-column: span 1; /* 每个卡片占一列 */
    height: auto; /* 高度自适应 */
    min-height: 400px; /* 最小高度 */
    margin: 0; /* 移除外边距 */
    display: flex; /* 使用flex布局 */
    flex-direction: column; /* 垂直排列 */
    transition: all 0.3s ease;
}

/* 调整读书笔记卡片内部布局 */
.note-list .book-note-card .book-note-header {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 2px dashed #ffc8a3;
    flex-shrink: 0; /* 防止被压缩 */
}

.note-list .book-note-card .rating-stars {
    margin: 12px 0;
    justify-content: center;
    flex-shrink: 0;
}

.note-list .book-note-card .book-note-content,
.note-list .book-note-card .book-reflection {
    margin: 12px 0;
    flex-grow: 1; /* 内容区域自动填充剩余空间 */
    overflow: hidden; /* 防止内容溢出 */
}

.note-list .book-note-card .book-note-content {
    max-height: 120px;
    overflow-y: auto;
}

.note-list .book-note-card .book-reflection {
    max-height: 100px;
    overflow-y: auto;
}

.note-list .book-note-card .book-tags {
    margin: 12px 0;
    flex-shrink: 0;
}

.note-list .book-note-card .book-note-footer {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 2px dotted #e0c9b8;
    flex-shrink: 0;
}
.note-list .book-note-card .book-note-content div,
.note-list .book-note-card .book-reflection div {
    max-height: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 4; /* 显示4行 */
    -webkit-box-orient: vertical;
}

/* 空状态样式在网格布局中的适配 */
.note-list + .book-empty-state {
    grid-column: 1 / -1; /* 跨所有列 */
    text-align: center;
    padding: 50px 20px;
    color: #c9b8a7;
}
        .note-card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 30px;
            box-shadow: 6px 6px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            position: relative;
        }
        .note-card::before {
            content: '📌';
            position: absolute;
            top: -15px;
            right: 20px;
            font-size: 1.5em;
            transform: rotate(15deg);
        }
        .note-tags { display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0; }
        .note-tag {
            background: rgba(255, 154, 139, 0.15);
            color: #d45d5d;
            padding: 6px 14px;
            border-radius: 20px 8px 20px 8px;
            font-size: 0.9em;
            font-weight: 700;
            border: 1.5px dashed #ff9a8b;
        }
        .note-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 15px 5px 15px 5px;
            margin-top: 20px;
            box-shadow: 4px 4px 0px #d4b8a7;
            border: 2px solid #5a4a42;
            display: block;
        }

        /* ====== 手绘图片上传区域 ====== */
        .image-upload-area {
            margin: 20px 0;
            padding: 25px;
            border: 3px dashed #ffc8a3;
            border-radius: 20px 8px 20px 8px;
            background: rgba(255, 248, 240, 0.7);
            text-align: center;
        }
        .image-preview {
            margin-top: 20px;
        }
        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 15px 5px 15px 5px;
            border: 3px solid #ff9a8b;
            box-shadow: 4px 4px 0px #ffd6cc;
        }

        /* ====== 手绘状态提示 ====== */
        .status-message {
            padding: 15px 25px;
            border-radius: 15px 5px 15px 5px;
            margin: 20px 0;
            font-weight: 700;
            border: 2.5px solid;
            font-family: 'Comic Neue', cursive;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.1);
        }
        .status-success {
            background: rgba(163, 222, 131, 0.95);
            color: #2d5a27;
            border-color: #2ba69b;
        }
        .status-error {
            background: rgba(255, 154, 139, 0.95);
            color: #7a2c28;
            border-color: #d45d5d;
        }
        .status-warning {
            background: rgba(255, 219, 153, 0.95);
            color: #8a5a29;
            border-color: #ffa94d;
        }

        /* ====== 手绘统计信息 ====== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            text-align: center;
            margin-top: 30px;
        }
        .stat-box {
            padding: 30px 20px;
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            box-shadow: 5px 5px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            transition: transform 0.3s;
        }
        .stat-box:hover {
            transform: translateY(-5px) rotate(0.5deg);
        }
        .stat-value {
            font-size: 3.2em;
            font-weight: 800;
            font-family: 'Gochi Hand', cursive;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            text-shadow: 2px 2px 0px #ffd6cc;
        }
        .stat-label {
            margin-top: 15px;
            font-size: 1.2em;
            color: #7a6a62;
            font-weight: 700;
            font-family: 'Comic Neue', cursive;
        }

        /* ====== 加载动画 ====== */
        .loading-spinner {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 4px solid rgba(255, 154, 139, 0.3);
            border-radius: 50%;
            border-top-color: #ff6b6b;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ====== 成就系统手绘样式 ====== */
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .achievement-card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 25px;
            box-shadow: 5px 5px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            position: relative;
            overflow: hidden;
        }
        .achievement-card.locked { 
            opacity: 0.7; 
            filter: grayscale(0.3);
            background: #f5f1eb;
        }
        .achievement-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: rgba(255, 154, 139, 0.1);
            border-radius: 0 0 0 40px;
        }
        .achievement-icon {
            font-size: 3em;
            margin-bottom: 20px;
            text-align: center;
            transform: rotate(-3deg);
        }
        .achievement-progress {
            height: 12px;
            background: #ffe8d6;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            border: 1.5px solid #e0c9b8;
        }
        .achievement-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a8b, #ff6b6b);
            border-radius: 6px;
            transition: width 0.8s ease;
        }

        /* ====== 新增：折叠面板样式 ====== */
        .collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            color: #ff6b6b;
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #ff9a8b;
            background: #fffaf5;
            transition: all 0.3s;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
        }
        .collapse-btn:hover {
            background: #ff9a8b;
            color: white;
            transform: scale(1.05);
        }

        /* ====== 新增：笔记筛选器样式（简化版） ====== */
        .note-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
            padding: 20px;
            background: #fffaf5;
            border-radius: 15px;
            border: 2px solid #e0c9b8;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }
        .filter-group label {
            font-weight: bold;
            color: #5a4a42;
            font-family: 'Comic Neue', cursive;
        }
        .filter-group select, .filter-group input {
            padding: 12px 15px;
            border: 2px solid #e0c9b8;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            background: #fffefc;
            color: #5a4a42;
        }
        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 2px 2px 0px #ffd6cc;
        }

        /* ====== 新增：批量添加成就面板样式 ====== */
        .batch-add-panel {
            background: #fff9f0;
            border: 3px dashed #ffc8a3;
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
        }
        .batch-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0c9b8;
            border-radius: 15px;
            font-family: 'Comic Neue', cursive;
            font-size: 14px;
            background: #fffefc;
            color: #5a4a42;
            margin-bottom: 15px;
            resize: vertical;
        }
        .batch-textarea:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
        }
        .batch-example {
            font-size: 0.9em;
            color: #7a6a62;
            background: #fffaf5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #4ecdc4;
        }

        /* ====== 思维导图样式 ====== */
        .mindmap-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: #fffaf5;
            border: 2.5px solid #e0c9b8;
            border-radius: 15px 5px 15px 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        .mindmap-node {
            position: absolute;
            width: 120px;
            height: 30px;
            padding: 10px 15px;
            background: #fffefc;
            border-radius: 10px 5px 10px 5px;
            border: 2px solid #5a4a42;
            box-shadow: 3px 3px 0px #d4b8a7;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
            color: #5a4a42;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            user-select: none;
            transition: all 0.2s;
        }
        .mindmap-node:hover {
            box-shadow: 4px 4px 0px #c9a58f;
            transform: translateY(-2px);
        }
        .mindmap-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .mindmap-input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 2px solid #e0c9b8;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            background: #fffefc;
            color: #5a4a42;
        }
        .mindmap-input:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 2px 2px 0px #ffd6cc;
        }
        .mindmap-nodes-list {
            margin: 20px 0;
            padding: 15px;
            background: #fffaf5;
            border-radius: 15px;
            border: 2px solid #e0c9b8;
        }
        .mindmap-node-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #ff9a8b;
        }

        /* ====== 新增：读书笔记样式 ====== */
        .book-notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .book-note-card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 25px;
            box-shadow: 5px 5px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            position: relative;
            transition: all 0.3s;
        }
        
        .book-note-card:hover {
            transform: translateY(-5px) rotate(0.5deg);
            box-shadow: 7px 7px 0px #c9a58f, 12px 12px 20px rgba(0, 0, 0, 0.08);
        }
        
        .book-note-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px dashed #ffc8a3;
        }
        
        .book-icon {
            font-size: 2.5em;
            transform: rotate(-3deg);
            background: linear-gradient(45deg, #ffd6cc, #ff9a8b);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 3px 3px 0px #d45d5d;
        }
        
        .book-info {
            flex-grow: 1;
        }
        
        .book-title {
            font-size: 1.4em;
            font-weight: 800;
            color: #5a4a42;
            font-family: 'Gochi Hand', cursive;
            margin-bottom: 5px;
        }
        
        .book-author {
            font-size: 0.95em;
            color: #7a6a62;
            font-weight: bold;
        }
        
        .book-note-content {
            margin: 20px 0;
            padding: 15px;
            background: #fffaf5;
            border-radius: 12px;
            border: 2px solid #e0c9b8;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .book-reflection {
            margin: 20px 0;
            padding: 15px;
            background: rgba(163, 222, 131, 0.1);
            border-radius: 12px;
            border: 2px dashed #4ecdc4;
            font-style: italic;
        }
        
        .rating-stars {
            display: flex;
            gap: 5px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .star {
            font-size: 1.8em;
            cursor: pointer;
            transition: all 0.2s;
            color: #e0c9b8;
        }
        
        .star.filled {
            color: #ffd166;
            text-shadow: 0 0 5px rgba(255, 209, 102, 0.5);
        }
        
        .star:hover {
            transform: scale(1.2);
        }
        
        .rating-value {
            text-align: center;
            font-weight: bold;
            color: #7a6a62;
            margin-top: 10px;
            font-family: 'Gochi Hand', cursive;
        }
        
        .book-note-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dotted #e0c9b8;
        }
        
        .book-date {
            font-size: 0.9em;
            color: #7a6a62;
        }
        
        .book-actions {
            display: flex;
            gap: 10px;
        }
        
       .book-form {
    grid-column: 1 / -1; /* 表单跨所有列 */
    background: #fffaf5;
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    border: 3px dashed #ffc8a3;
}
        
        .book-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .book-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2.5px solid #e0c9b8;
            border-radius: 15px 5px 15px 5px;
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
            margin-bottom: 20px;
            transition: all 0.3s;
            background: #fffaf9;
            resize: vertical;
        }
        
        .book-textarea:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
            background: #fff;
        }
        
        .book-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .book-tag {
            background: rgba(255, 154, 139, 0.15);
            color: #d45d5d;
            padding: 6px 14px;
            border-radius: 20px 8px 20px 8px;
            font-size: 0.9em;
            font-weight: 700;
            border: 1.5px dashed #ff9a8b;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .book-tag:hover {
            background: #ff9a8b;
            color: white;
            transform: scale(1.05);
        }
        
        .book-tag.active {
            background: #ff6b6b;
            color: white;
            border-color: #d45d5d;
        }
        
        .book-empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #c9b8a7;
        }
        
        .book-empty-icon {
            font-size: 4em;
            margin-bottom: 20px;
            transform: rotate(-5deg);
        }
        
       .book-search-bar {
    grid-column: 1 / -1;
    margin-bottom: 25px;
}

        
        .book-search-input {
            width: 100%;
            padding: 15px 20px;
            border: 2.5px solid #e0c9b8;
            border-radius: 15px 5px 15px 5px;
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
            background: #fffaf9;
        }
        
        .book-search-input:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
        }
        
        .book-stats {
    grid-column: 1 / -1;
    display: flex;
    gap: 20px;
    margin-top: 25px;
    padding: 20px;
    background: #fffaf5;
    border-radius: 15px;
    border: 2px solid #e0c9b8;
    justify-content: center;
    flex-wrap: wrap;
}
        
        .book-stat-item {
            text-align: center;
            padding: 15px 25px;
            background: white;
            border-radius: 12px;
            border: 2px solid #ffc8a3;
            min-width: 120px;
        }
        
        .book-stat-value {
            font-size: 2em;
            font-weight: 800;
            color: #ff6b6b;
            font-family: 'Gochi Hand', cursive;
        }
        
        .book-stat-label {
            font-size: 0.9em;
            color: #7a6a62;
            margin-top: 8px;
            font-weight: bold;
        }
        
        /* ====== 简化后的笔记内容样式 ====== */
        .note-content-plain {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #5a4a42;
            line-height: 1.7;
            margin: 25px 0;
            padding: 15px;
            background: #fffaf5;
            border-radius: 12px;
            border: 2px solid #e0c9b8;
            font-family: 'Comic Neue', cursive;
            font-size: 16px;
        }
        
/* ====== 响应式调整 ====== */
        @media (max-width: 768px) {
            .note-list .book-note-card {
                min-height: 350px;
            }
            
            .note-list .book-note-card .book-note-content {
                max-height: 100px;
            }
            
            .note-list .book-note-card .book-reflection {
                max-height: 80px;
            }
        }

        @media (max-width: 480px) {
            .note-list .book-note-card {
                min-height: 300px;
            }
            
            .book-form {
                padding: 20px 15px;
            }
            
            .book-form-row {
                grid-template-columns: 1fr !important; /* 在小屏幕上单列显示 */
                gap: 15px;
            }
        }
        /* 强制读书笔记卡片占据整行 */
#app .grid > .card:nth-child(4) {
    grid-column: 1 / -1 !important;
    width: 100% !important;
}

/* 确保读书笔记列表正确显示网格 */
#app .grid > .card:nth-child(4) .note-list {
    display: grid !important;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;
    gap: 25px !important;
    width: 100% !important;
}

/* 确保每个读书笔记卡片填充网格单元格 */
#app .grid > .card:nth-child(4) .note-list .book-note-card {
    width: 100% !important;
    height: auto !important;
    min-height: 450px !important;
}
        /* ====== 成就系统单独一行 ====== */
/* 成就系统卡片（第3个卡片）占据整行 */
#app .grid > .card:nth-child(3) {
    padding: 35px 40px; /* 增加内边距 */
}

/* 调整成就系统内部网格布局 */
#app .grid > .card:nth-child(3) .achievement-grid {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
}
        #app .grid > .card:nth-child(3) .note-tabs {
    justify-content: flex-start;
    flex-wrap: wrap;
}

/* 确保读书笔记卡片也正确布局 */
#app .grid > .card:nth-child(4) {
    grid-column: 1 / -1;
    margin-top: 20px;
}

/* 调整前两个卡片的宽度 */
#app .grid > .card:nth-child(1),
#app .grid > .card:nth-child(2) {
    grid-column: span 1; /* 每个卡片占据1列 */
}

/* 响应式调整：小屏幕上改为单列布局 */
@media (max-width: 1024px) {
    .grid {
        grid-template-columns: 1fr; /* 小屏幕上单列 */
    }
    
    #app .grid > .card:nth-child(1),
    #app .grid > .card:nth-child(2),
    #app .grid > .card:nth-child(3),
    #app .grid > .card:nth-child(4) {
        grid-column: 1 / -1;
    }
}
    </style>
</head>
<body>
    <div id="app" class="container">
        <!-- === 配置面板 === -->
        <div v-if="!isConfigured" class="config-panel">
            <div class="card">
                <h2>✏️ 设置你的手账同步</h2>
                <div class="config-info">
                    <p><strong>准备事项：</strong></p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>一个GitHub账号</li>
                        <li>一个<strong>私有仓库</strong>存放数据</li>
                        <li>一个有 <code>repo</code> 权限的<strong>访问令牌</strong>
                            <br><a href="https://github.com/settings/tokens" target="_blank">点此创建Token</a>
                        </li>
                    </ol>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">GitHub 用户名</label>
                    <input type="text" v-model="config.username" class="note-input" placeholder="例如：zhangsan">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">数据仓库名称</label>
                    <input type="text" v-model="config.repo" class="note-input" placeholder="例如：my-growth-data">
                </div>
                
                <div style="margin-bottom: 30px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">个人访问令牌 (Token)</label>
                    <input type="password" v-model="config.token" class="note-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                    <p style="font-size: 0.9em; color: #7a6a62; margin-top: 5px;">
                        ⚠️ Token仅用于本次会话通信，刷新页面后需重新输入。
                    </p>
                </div>
                
                <div style="display: flex; gap: 15px;">
                    <button class="btn" @click="saveConfigAndLoad" style="flex: 1;">
                        <span v-if="isLoading">⌛ 连接中...</span>
                        <span v-else>✅ 连接并加载数据</span>
                    </button>
                    <button class="btn" @click="loadDemoData" style="flex: 1; background:linear-gradient(90deg, #a3a3a3, #7a7a7a);" :disabled="isLoading">
                        🎮 试用手账数据
                    </button>
                </div>
                
                <div v-if="configError" class="status-error status-message">
                    {{ configError }}
                </div>
            </div>
        </div>

        <!-- === 主手账界面 === -->
        <div v-else>
            <!-- 顶部状态栏 -->
            <div class="header">
                <h1>✏️ 智能成长手账</h1>
                <p>数据同步至: <strong>{{ config.username }}/{{ config.repo }}</strong></p>
                
                <div style="position: absolute; top: 30px; right: 30px; display: flex; gap: 10px;">
                    <button class="btn-sm" @click="forceLoadFromGitHub" :disabled="isLoading">
                        <span v-if="isLoading">⌛ 同步中...</span>
                        <span v-else>🔄 立即同步</span>
                    </button>
                    <button class="btn-sm" @click="forceSaveToGitHub" :disabled="isSaving" style="background:linear-gradient(90deg, #4ecdc4, #2ba69b);">
                        <span v-if="isSaving">💾 保存中...</span>
                        <span v-else>💾 立即保存</span>
                    </button>
                    <button class="btn-sm" @click="showConfig=!showConfig" style="background:linear-gradient(90deg, #7a6a62, #5a4a42);">
                        ⚙️ {{ showConfig ? '隐藏设置' : '显示设置' }}
                    </button>
                </div>
                
                <div style="font-size: 0.95em; opacity: 0.9; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 20px;">
                    <span>🕒 最后同步: {{ lastSyncTime || '从未同步' }}</span>
                    <span v-if="isSaving" style="color: #ff6b6b;">
                        <span class="loading-spinner" style="margin-right: 5px;"></span> 正在保存...
                    </span>
                </div>
            </div>

            <!-- 配置抽屉 -->
            <div v-if="showConfig" class="card" style="margin-bottom: 30px;">
                <h3>⚙️ 同步设置</h3>
                <p>当前仓库: <code>{{ config.username }}/{{ config.repo }}</code></p>
                <p style="font-size: 0.95em; color: #7a6a62; margin-top: 10px;">
                    Token: {{ config.token ? '已设置 (' + config.token.substring(0, 8) + '...)' : '未设置' }}
                </p>
                <div style="display: flex; gap: 10px; margin-top: 25px; flex-wrap: wrap;">
                    <button class="btn-sm" @click="openRepoInGitHub" style="background:linear-gradient(90deg, #4a9fff, #2d73cc);">📂 打开仓库</button>
                    <button class="btn-sm" @click="exportLocalData" style="background:linear-gradient(90deg, #a3de83, #4ecdc4);">💾 备份数据</button>
                    <button class="btn-sm" @click="showImport=!showImport" style="background:linear-gradient(90deg, #ffd166, #ffb347); color:#5a4a42;">📂 导入数据</button>
                    <button class="btn-sm" @click="isConfigured=false" style="background:#f0e6dc; color:#5a4a42; border:2px solid #d4b8a7;">✏️ 修改设置</button>
                </div>
                
                <!-- 导入数据区域 -->
                <div v-if="showImport" style="margin-top: 25px; padding-top: 25px; border-top: 3px dashed #e0c9b8;">
                    <h4>导入备份数据</h4>
                    <input type="file" accept=".json" @change="importLocalData" style="margin: 15px 0; padding: 10px; border: 2px dashed #ffc8a3; border-radius: 10px; width:100%; background:#fffaf9;">
                    <p style="font-size: 0.95em; color: #7a6a62;">选择之前导出的JSON备份文件</p>
                </div>
            </div>
            
            <!-- 状态消息 -->
            <div v-if="statusMessage" :class="['status-message', statusMessage.type === 'success' ? 'status-success' : statusMessage.type === 'error' ? 'status-error' : 'status-warning']">
                {{ statusMessage.text }}
            </div>

            <!-- 主网格布局 -->
            <div class="grid">
                <!-- 玩家状态面板 -->
                <div class="card">
                    <h2>
                        📊 成长状态
                        <button class="collapse-btn" @click="collapseStatus = !collapseStatus">
                            {{ collapseStatus ? '展开' : '折叠' }}
                        </button>
                    </h2>
                    <div v-if="!collapseStatus">
                        <div class="level-display">Lv. {{ player.level }}</div>
                        <div style="margin: 25px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; font-weight:bold;">
                                <span>经验值 (XP):</span>
                                <span><strong>{{ player.xp }}</strong> / {{ player.nextLevelXp }}</span>
                            </div>
                            <div class="xp-progress">
                                <div class="xp-fill" :style="{ width: (player.xp / player.nextLevelXp * 100) + '%' }"></div>
                            </div>
                            <div style="text-align: center; margin-top: 18px; font-size: 1.05em; color: #7a6a62; font-weight:bold;">
                                还需 {{ player.nextLevelXp - player.xp }} XP 升级
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; padding-top: 30px; border-top: 3px dotted #ffc8a3;">
                            <div class="stats-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <div style="font-size: 2.2em; font-weight: bold; color: #ff6b6b; font-family:'Gochi Hand';">{{ totalSkills }}</div>
                                    <div style="color: #7a6a62; font-weight:bold;">技能数量</div>
                                </div>
                                <div>
                                    <div style="font-size: 2.2em; font-weight: bold; color: #4ecdc4; font-family:'Gochi Hand';">{{ completedAchievementsCount }}</div>
                                    <div style="color: #7a6a62; font-weight:bold;">成就达成</div>
                                </div>
                            </div>
                            <button class="btn" @click="forceSaveToGitHub" style="background:linear-gradient(90deg, #4ecdc4, #2ba69b); margin-top:20px;">
                                💾 立即保存到云端
                            </button>
                            <button class="btn" @click="resetData" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d); margin-top:15px;">
                                🔄 重置所有数据（谨慎！）
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 技能树 -->
                <div class="card">
                    <h2>
                        🌱 我的技能树
                        <button class="collapse-btn" @click="collapseSkills = !collapseSkills">
                            {{ collapseSkills ? '展开' : '折叠' }}
                        </button>
                    </h2>
                    <div v-if="!collapseSkills">
                        <p style="margin-bottom:20px; color:#7a6a62; font-weight:bold;">从零开始，自由添加你想培养的任何技能</p>
                        
                        <div v-if="skills.length === 0" style="text-align:center; padding:40px 20px; color:#c9b8a7;">
                            <div style="font-size:3.5em; margin-bottom:15px; transform:rotate(-5deg);">🌱</div>
                            <p style="font-weight:bold; font-size:1.1em;">技能树空空如也</p>
                            <p>点击下方按钮添加你的第一个技能吧！</p>
                        </div>
                        
                        <div v-for="skill in skills" :key="skill.id" class="skill-item">
                            <div style="flex-grow:1;">
                                <div style="display:flex; align-items:center; gap:15px; margin-bottom:10px;">
                                    <span style="font-size:2em; transform:rotate(3deg);">{{ skill.icon }}</span>
                                    <div>
                                        <strong style="font-size:1.3em; color:#5a4a42;">{{ skill.name }}</strong>
                                        <div style="font-size:0.95em; color:#7a6a62; font-weight:bold;">类别: {{ skill.category }} · 等级 {{ skill.level }}</div>
                                    </div>
                                </div>
                                <div class="xp-progress" style="height:14px; margin:12px 0;">
                                    <div class="xp-fill" :style="{ width: (skill.xp / skill.maxXp * 100) + '%' }"></div>
                                </div>
                                <div style="display:flex; justify-content:space-between; font-size:0.95em; color:#7a6a62; font-weight:bold;">
                                    <span>{{ skill.xp }} / {{ skill.maxXp }} XP</span>
                                    <span>{{ Math.round(skill.xp / skill.maxXp * 100) }}%</span>
                                </div>
                            </div>
                            <div style="display:flex; gap:12px;">
                                <button class="btn-sm" @click="practiceSkill(skill.id)" style="background:linear-gradient(90deg, #ff9a8b, #ff6b6b); box-shadow:3px 3px 0px #d45d5d;">
                                    练习 +{{ getSkillXpPerPractice(skill) }}
                                </button>
                                <button class="btn-sm" @click="deleteSkill(skill.id)" style="background:#f0e6dc; color:#7a6a62; border:2px solid #d4b8a7; box-shadow:3px 3px 0px #c9b8a7;">
                                    删除
                                </button>
                            </div>
                        </div>
                        
                        <button class="btn" @click="addNewSkill" style="background:linear-gradient(90deg, #a3de83, #4ecdc4); margin-top:25px;">
                            🌟 添加新技能
                        </button>
                    </div>
                </div>

                <!-- 成就系统 -->
                <div class="card">
                    <h2>
                        🏆 成就系统
                        <button class="collapse-btn" @click="collapseAchievements = !collapseAchievements">
                            {{ collapseAchievements ? '展开' : '折叠' }}
                        </button>
                    </h2>
                    
                    <div v-if="!collapseAchievements">
                        <!-- 成就筛选与批量添加区域 -->
                        <div style="margin-bottom: 25px; display: flex; gap: 15px; align-items: center;">
                            <div class="note-tabs" style="margin-bottom: 0; flex-grow: 1;">
                                <div class="note-tab" :class="{active: activeAchievementTab === 'all'}" @click="activeAchievementTab = 'all'">全部</div>
                                <div class="note-tab" :class="{active: activeAchievementTab === 'yixue'}" @click="activeAchievementTab = 'yixue'">易学</div>
                                <div class="note-tab" :class="{active: activeAchievementTab === 'english'}" @click="activeAchievementTab = 'english'">英语</div>
                                <div class="note-tab" :class="{active: activeAchievementTab === 'fitness'}" @click="activeAchievementTab = 'fitness'">健身</div>
                                <div class="note-tab" :class="{active: activeAchievementTab === 'custom'}" @click="activeAchievementTab = 'custom'">自定义</div>
                            </div>
                            <button class="btn-sm" @click="showBatchAdd = !showBatchAdd" style="background:linear-gradient(90deg, #ffd166, #ffb347); color:#5a4a42;">
                                📥 批量添加成就
                            </button>
                        </div>
                        
                        <!-- 批量添加成就面板 -->
                        <div v-if="showBatchAdd" class="batch-add-panel">
                            <h3 style="margin-bottom: 15px; color: #5a4a42;">📥 批量添加成就</h3>
                            <p style="margin-bottom: 15px; color: #7a6a62; font-weight: bold;">
                                请按照JSON格式输入成就数据，每个成就包含以下字段：
                            </p>
                            <textarea 
                                v-model="batchAchievementInput" 
                                class="batch-textarea" 
                                placeholder='例如：
[
  {
    "category": "custom",
    "name": "早起达人",
    "icon": "🌅",
    "description": "连续30天早上6点前起床",
    "requirement": 30,
    "reward": 150
  }
]'>
                            </textarea>
                            <div class="batch-example">
                                <strong>字段说明：</strong><br>
                                • <code>category</code>: 分类（自定义分类会自动创建）<br>
                                • <code>name</code>: 成就名称<br>
                                • <code>icon</code>: 图标表情<br>
                                • <code>description</code>: 描述<br>
                                • <code>requirement</code>: 达成要求（数字）<br>
                                • <code>reward</code>: 奖励经验值
                            </div>
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="btn-sm" @click="addBatchAchievements" style="background:linear-gradient(90deg, #a3de83, #4ecdc4);">
                                    ✅ 添加这些成就
                                </button>
                                <button class="btn-sm" @click="loadExampleAchievements" style="background:linear-gradient(90deg, #4a9fff, #2d73cc);">
                                    📋 加载示例
                                </button>
                                <button class="btn-sm" @click="clearBatchInput" style="background:linear-gradient(90deg, #a3a3a3, #7a7a7a);">
                                    清空
                                </button>
                            </div>
                        </div>
                        
                        <div class="achievement-grid">
                            <div v-for="achievement in filteredAchievements" :key="achievement.id" 
                                 class="achievement-card" :class="{locked: !achievement.unlocked}">
                                <div class="achievement-icon">{{ achievement.icon }}</div>
                                <h3 style="margin-bottom:12px; color:#5a4a42; font-family:'Gochi Hand';">{{ achievement.name }}</h3>
                                <p style="font-size:0.95em; color:#7a6a62; margin-bottom:20px; min-height:45px; font-weight:bold;">{{ achievement.description }}</p>
                                
                                <div v-if="!achievement.unlocked">
                                    <div class="achievement-progress">
                                        <div class="achievement-progress-fill" 
                                             :style="{ width: Math.min(100, (achievement.current / achievement.requirement * 100)) + '%' }"></div>
                                    </div>
                                    <div style="display:flex; justify-content:space-between; font-size:0.9em; color:#7a6a62; font-weight:bold;">
                                        <span>进度: {{ achievement.current }} / {{ achievement.requirement }}</span>
                                        <span>{{ Math.round(achievement.current / achievement.requirement * 100) }}%</span>
                                    </div>
                                </div>
                                
                                <div v-if="achievement.unlocked" 
                                     style="text-align:center; padding:15px; background:rgba(163,222,131,0.2); border-radius:15px; margin-top:20px; border:2px dashed #4ecdc4;">
                                    <span style="color:#2d5a27; font-weight:bold; font-family:'Gochi Hand';">🎉 已解锁</span>
                                    <div style="font-size:0.95em; color:#2d5a27; margin-top:8px; font-weight:bold;">
                                        {{ achievement.reward }} XP
                                    </div>
                                </div>
                                
                                <!-- 删除成就按钮（仅自定义成就显示） -->
                                <div v-if="achievement.category === 'custom'" style="margin-top: 15px; text-align: right;">
                                    <button class="btn-sm" @click="deleteAchievement(achievement.id)" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d); padding: 5px 15px; font-size: 0.8em;">
                                        删除
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 空状态提示 -->
                        <div v-if="filteredAchievements.length === 0" style="text-align:center; padding:50px 20px; color:#c9b8a7; margin-top: 30px;">
                            <div style="font-size:4em; margin-bottom:20px; transform:rotate(-5deg);">🏆</div>
                            <p style="font-weight:bold; font-size:1.3em; margin-bottom:10px;">这个分类还没有成就</p>
                            <p>点击"批量添加成就"按钮创建你的第一个成就吧！</p>
                        </div>
                    </div>
                </div>

                <!-- ==================== 新增：读书笔记板块 ==================== -->
                <div class="card">
                    <h2>
                        📚 读书笔记
                        <button class="collapse-btn" @click="collapseBookNotes = !collapseBookNotes">
                            {{ collapseBookNotes ? '展开' : '折叠' }}
                        </button>
                    </h2>
                    
                    <div v-if="!collapseBookNotes">
                        <!-- 搜索和统计 -->
                        <div class="book-search-bar">
                            <input 
                                type="text" 
                                v-model="bookSearchQuery" 
                                class="book-search-input" 
                                placeholder="🔍 搜索书名、作者、标签..."
                                @input="searchBooks"
                            >
                        </div>
                        
                        <!-- 读书笔记统计 -->
                        <div class="book-stats">
                            <div class="book-stat-item">
                                <div class="book-stat-value">{{ bookNotes.length }}</div>
                                <div class="book-stat-label">总书籍数</div>
                            </div>
                            <div class="book-stat-item">
                                <div class="book-stat-value">{{ averageBookRating.toFixed(1) }}</div>
                                <div class="book-stat-label">平均评分</div>
                            </div>
                            <div class="book-stat-item">
                                <div class="book-stat-value">{{ favoriteBooksCount }}</div>
                                <div class="book-stat-label">最爱书籍</div>
                            </div>
                            <div class="book-stat-item">
                                <div class="book-stat-value">{{ totalBookTags }}</div>
                                <div class="book-stat-label">标签数量</div>
                            </div>
                        </div>
                        
                        <!-- 添加/编辑表单 -->
                        <div class="book-form" v-if="showBookForm">
                            <h3 style="margin-bottom:20px; color:#5a4a42; font-family:'Gochi Hand';">
                                {{ editingBookNote ? '✏️ 编辑读书笔记' : '📖 添加新读书笔记' }}
                            </h3>
                            
                            <div class="book-form-row">
                                <div>
                                    <label style="display:block; margin-bottom:8px; font-weight:bold; color:#5a4a42;">书名</label>
                                    <input type="text" v-model="newBookNote.title" class="note-input" placeholder="请输入书名">
                                </div>
                                <div>
                                    <label style="display:block; margin-bottom:8px; font-weight:bold; color:#5a4a42;">作者</label>
                                    <input type="text" v-model="newBookNote.author" class="note-input" placeholder="请输入作者">
                                </div>
                            </div>
                            
                            <div>
                                <label style="display:block; margin-bottom:8px; font-weight:bold; color:#5a4a42;">笔记内容</label>
                                <textarea 
                                    v-model="newBookNote.note" 
                                    class="book-textarea" 
                                    placeholder="记录读书时的重点、摘录、思考..."
                                ></textarea>
                            </div>
                            
                            <div>
                                <label style="display:block; margin-bottom:8px; font-weight:bold; color:#5a4a42;">读书感悟</label>
                                <textarea 
                                    v-model="newBookNote.reflection" 
                                    class="book-textarea" 
                                    placeholder="写下读完这本书的感悟、收获、启示..."
                                ></textarea>
                            </div>
                            
                            <div style="margin:20px 0;">
                                <label style="display:block; margin-bottom:8px; font-weight:bold; color:#5a4a42;">评分</label>
                                <div class="rating-stars">
                                    <span 
                                        v-for="star in 5" 
                                        :key="star" 
                                        class="star" 
                                        :class="{filled: star <= newBookNote.rating}"
                                        @click="newBookNote.rating = star"
                                    >
                                        ★
                                    </span>
                                </div>
                                <div class="rating-value">
                                    当前评分: {{ newBookNote.rating }} 星
                                </div>
                            </div>
                            
                            <div style="margin:20px 0;">
                                <label style="display:block; margin-bottom:8px; font-weight:bold; color:#5a4a42;">标签</label>
                                <div class="book-tags">
                                    <span 
                                        v-for="tag in commonBookTags" 
                                        :key="tag"
                                        class="book-tag" 
                                        :class="{active: newBookNote.tags.includes(tag)}"
                                        @click="toggleBookTag(tag)"
                                    >
                                        {{ tag }}
                                    </span>
                                </div>
                                <input 
                                    type="text" 
                                    v-model="newBookTagInput" 
                                    class="note-input" 
                                    placeholder="输入自定义标签，按回车添加"
                                    @keyup.enter="addCustomBookTag"
                                    style="margin-top:10px;"
                                >
                                <div style="font-size:0.9em; color:#7a6a62; margin-top:5px;">
                                    已选标签: {{ newBookNote.tags.join(', ') || '无' }}
                                </div>
                            </div>
                            
                            <div style="display:flex; gap:15px; margin-top:25px;">
                                <button class="btn" @click="saveBookNote" style="width:auto; padding:14px 45px;">
                                    {{ editingBookNote ? '💾 更新笔记' : '📚 保存读书笔记' }}
                                </button>
                                <button class="btn" @click="cancelBookNote" style="width:auto; padding:14px 35px; background:linear-gradient(90deg, #a3a3a3, #7a7a7a);">
                                    取消
                                </button>
                            </div>
                        </div>
                        
                        <!-- 读书笔记列表 -->
<div v-if="filteredBookNotes.length > 0" class="note-list">
    <div v-for="book in filteredBookNotes" :key="book.id" class="book-note-card">
        <div class="book-note-header">
            <div class="book-icon">
                📚
            </div>
            <div class="book-info">
                <div class="book-title">{{ book.title }}</div>
                <div class="book-author">作者: {{ book.author }}</div>
            </div>
        </div>
        
        <div class="rating-stars" style="justify-content:flex-start;">
            <span 
                v-for="star in 5" 
                :key="star" 
                class="star" 
                :class="{filled: star <= book.rating}"
            >
                ★
            </span>
        </div>
        
        <div class="book-note-content">
            <strong style="color:#5a4a42; display:block; margin-bottom:10px;">📝 笔记摘要:</strong>
            <div style="max-height:80px; overflow:hidden; text-overflow:ellipsis;">
                {{ book.note.substring(0, 150) }}{{ book.note.length > 150 ? '...' : '' }}
            </div>
        </div>
        
        <div class="book-reflection">
            <strong style="color:#5a4a42; display:block; margin-bottom:10px;">💭 我的感悟:</strong>
            <div style="max-height:80px; overflow:hidden; text-overflow:ellipsis;">
                {{ book.reflection.substring(0, 120) }}{{ book.reflection.length > 120 ? '...' : '' }}
            </div>
        </div>
        
        <div class="book-tags" v-if="book.tags && book.tags.length > 0">
            <span 
                v-for="tag in book.tags.slice(0, 3)" 
                :key="tag"
                class="book-tag"
            >
                {{ tag }}
            </span>
            <span v-if="book.tags.length > 3" class="book-tag">
                +{{ book.tags.length - 3 }}
            </span>
        </div>
        
        <div class="book-note-footer">
            <div class="book-date">
                📅 {{ formatDate(book.createdAt) }}
            </div>
            <div class="book-actions">
                <button class="btn-sm" @click="editBookNote(book.id)" style="background:linear-gradient(90deg, #4a9fff, #2d73cc); padding:5px 15px;">
                    编辑
                </button>
                <button class="btn-sm" @click="deleteBookNote(book.id)" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d); padding:5px 15px;">
                    删除
                </button>
            </div>
        </div>
    </div>
</div>
                        
                        <!-- 空状态提示 -->
                       <<div v-if="filteredBookNotes.length === 0 && !showBookForm" class="book-empty-state">
    <div class="book-empty-icon">📚</div>
    <p style="font-weight:bold; font-size:1.3em; margin-bottom:10px;">还没有读书笔记</p>
    <p>开始记录你的阅读旅程吧！</p>
    <button class="btn" @click="showBookForm = true" style="margin-top:20px; background:linear-gradient(90deg, #4ecdc4, #2ba69b);">
        📖 添加第一本读书笔记
    </button>
</div>
                        
                        <!-- 显示/隐藏表单按钮 -->
                        <div v-if="!showBookForm" style="text-align:center; margin-top:30px;">
                            <button class="btn" @click="showBookForm = true" style="background:linear-gradient(90deg, #4ecdc4, #2ba69b);">
                                📖 添加读书笔记
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 智能笔记系统（简化版） -->
            <div class="note-section">
                <div class="card">
                    <h2>
                        📝 笔记系统
                        <button class="collapse-btn" @click="collapseNotes = !collapseNotes">
                            {{ collapseNotes ? '展开' : '折叠' }}
                        </button>
                    </h2>
                    
                    <div v-if="!collapseNotes">
                        <!-- 笔记筛选器（简化版） -->
                        <div class="note-filters" v-if="activeNoteTab !== 'editor' && notes.length > 0">
                            <div class="filter-group">
                                <label>📅 时间范围</label>
                                <select v-model="noteFilter.timeRange">
                                    <option value="all">全部时间</option>
                                    <option value="today">今天</option>
                                    <option value="week">本周</option>
                                    <option value="month">本月</option>
                                    <option value="year">今年</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label>🏷️ 标签筛选</label>
                                <select v-model="noteFilter.selectedTag">
                                    <option value="">所有标签</option>
                                    <option v-for="tag in allNoteTags" :value="tag">{{ tag }}</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label>📁 分类筛选</label>
                                <select v-model="noteFilter.selectedCategory">
                                    <option value="">所有分类</option>
                                    <option v-for="cat in noteCategories.filter(c => c !== 'all' && c !== 'editor')" :value="cat">
                                        {{ getCategoryDisplayName(cat) }}
                                    </option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label>🔍 关键词搜索</label>
                                <input type="text" v-model="noteFilter.keyword" placeholder="搜索标题或内容...">
                            </div>
                            
                            <button class="btn-sm" @click="resetNoteFilters" style="align-self: flex-end; background:linear-gradient(90deg, #a3a3a3, #7a7a7a);">
                                重置筛选
                            </button>
                        </div>
                        
                        <!-- 笔记分类标签页（简化版） -->
                        <div class="note-tabs">
                            <div class="note-tab" :class="{active: activeNoteTab === 'all'}" @click="activeNoteTab = 'all'">📚 全部笔记</div>
                            <div class="note-tab" :class="{active: activeNoteTab === 'editor'}" @click="activeNoteTab = 'editor'">✍️ 新建笔记</div>
                            <div v-for="cat in noteCategories.filter(c => c !== 'all' && c !== 'editor')" :key="cat" 
                                 class="note-tab" 
                                 :class="{active: activeNoteTab === cat}" 
                                 @click="activeNoteTab = cat">
                                {{ getCategoryDisplayName(cat) }}
                            </div>
                        </div>
                        
                        <!-- 普通文本编辑器 -->
                        <div v-if="activeNoteTab === 'editor'" class="note-editor">
                            <input type="text" class="note-input" v-model="newNote.title" placeholder="笔记标题...">
                            
                            <textarea 
                                class="note-textarea" 
                                v-model="newNote.content" 
                                placeholder="笔记内容..."
                                rows="15"
                            ></textarea>
                            
                            <input type="text" class="tag-input" v-model="newNote.tagsInput" placeholder="添加标签，用逗号分隔 (例如: 学习, 复盘, 灵感)">
                            
                            <!-- 图片上传区域 -->
                            <div class="image-upload-area">
                                <label style="display: block; margin-bottom: 12px; font-weight: bold; font-size:1.1em;">📸 添加图片</label>
                                <input type="file" accept="image/*" @change="handleImageUpload" style="display: block; margin: 0 auto 15px; padding:10px; border:2px dashed #ff9a8b; border-radius:10px; background:#fffaf9; cursor:pointer;">
                                <p style="font-size: 0.95em; color: #7a6a62; margin-bottom: 10px; font-weight:bold;">支持 JPG, PNG, GIF 格式，最大 2MB</p>
                                
                                <div v-if="newNote.imageData" class="image-preview">
                                    <p style="font-weight:bold; margin-bottom:10px;">图片预览：</p>
                                    <img :src="newNote.imageData" alt="预览">
                                    <button class="btn-sm" @click="clearUploadedImage" style="background: #ffd6cc; color: #5a4a42; margin-top: 15px; border:2px solid #ff9a8b;">
                                        清除图片
                                    </button>
                                </div>
                            </div>
                            
                            <div style="display:flex; gap:15px; margin-top:25px;">
                                <button class="btn" @click="saveNote" style="width:auto; padding:14px 45px; border-radius:50px 15px 50px 15px;">
                                    💾 保存笔记
                                </button>
                                <button class="btn" @click="clearNoteEditor" 
                                        style="width:auto; padding:14px 35px; background:linear-gradient(90deg, #a3a3a3, #7a7a7a); border-radius:50px 15px 50px 15px;">
                                    清空重写
                                </button>
                            </div>
                        </div>
                        
                        <!-- 笔记列表：其他标签页时显示 -->
                        <div v-if="activeNoteTab !== 'editor'" class="note-list">
                            <div v-for="note in filteredAndSortedNotes" :key="note.id" class="note-card">
                                <h3 style="margin-bottom:18px; color:#5a4a42; font-family:'Gochi Hand'; font-size:1.6em;">{{ note.title }}</h3>
                                <div class="note-tags">
                                    <span class="note-tag" v-for="tag in note.tags" :key="tag">{{ tag }}</span>
                                </div>
                                
                                <!-- 普通文本内容显示 -->
                                <div class="note-content-plain">
                                    {{ note.content }}
                                </div>
                                
                                <!-- 显示图片 -->
                                <div v-if="note.imageData || note.imageUrl" style="margin-top:25px;">
                                    <img :src="note.imageData || note.imageUrl" alt="笔记图片" class="note-image" @error="handleImageError">
                                </div>
                                
                                <!-- 笔记操作区 -->
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:30px; padding-top:25px; border-top:3px dotted #e0c9b8;">
                                    <div style="font-size:0.95em; color:#7a6a62; font-weight:bold;">
                                        📅 {{ formatDate(note.createdAt) }}
                                        <span style="margin-left:15px; background:#ffd6cc; padding:3px 10px; border-radius:10px; border:1px dashed #ff9a8b;">
                                            {{ getCategoryDisplayName(note.category) }}
                                        </span>
                                    </div>
                                    <div style="display:flex; gap:10px;">
                                        <button class="btn-sm" @click="editNote(note.id)" style="background:linear-gradient(90deg, #4a9fff, #2d73cc);">
                                            编辑
                                        </button>
                                        <button class="btn-sm" @click="deleteNote(note.id)" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d);">
                                            删除
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 空状态提示 -->
                            <div v-if="filteredAndSortedNotes.length === 0" style="text-align:center; padding:50px 20px; color:#c9b8a7; grid-column: 1 / -1;">
                                <div style="font-size:4em; margin-bottom:20px; transform:rotate(-5deg);">📝</div>
                                <p style="font-weight:bold; font-size:1.3em; margin-bottom:10px;">没有找到符合条件的笔记</p>
                                <p>尝试调整筛选条件或切换到其他标签开始记录吧！</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 成长概览 -->
            <div class="card" style="margin-top: 50px;">
                <h2>📈 成长概览</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">{{ totalXpEarned }}</div>
                        <div class="stat-label">累计获得经验</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{ totalSkills }}</div>
                        <div class="stat-label">技能数量</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{ totalNotes }}</div>
                        <div class="stat-label">笔记数量</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{ completedAchievementsCount }}</div>
                        <div class="stat-label">成就达成</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{ bookNotes.length }}</div>
                        <div class="stat-label">读书笔记</div>
                    </div>
                </div>
                <p style="text-align:center; margin-top:35px; padding-top:30px; border-top:3px dotted #ffc8a3; color:#7a6a62; font-size:1em; font-weight:bold;">
                    所有数据通过GitHub API同步至你的私有仓库。
                </p>
            </div>
        </div>
    </div>

    <script>
        // Vue 3 应用 - 简化版智能手账系统
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                // ==================== 状态与配置 ====================
                const isConfigured = ref(false);
                const showConfig = ref(false);
                const showImport = ref(false);
                const isSaving = ref(false);
                const isLoading = ref(false);
                const configError = ref('');
                const lastSyncTime = ref('');
                const statusMessage = ref(null);
                
                // 用户配置
                const config = ref({
                    username: '',
                    repo: '',
                    token: ''
                });

                // 核心游戏数据
                const player = ref({ level: 1, xp: 0, nextLevelXp: 100, streak: 1 });
                const skills = ref([]);
                const notes = ref([]);
                const activeAchievementTab = ref('all');
                const activeNoteTab = ref('editor');
                const noteCategories = ref(['all', 'editor']);
                const newNote = ref({ 
                    title: '', 
                    content: '', 
                    tagsInput: '', 
                    imageData: null,
                    category: 'general' 
                });
                
                // 新增：折叠状态
                const collapseStatus = ref(false);
                const collapseSkills = ref(false);
                const collapseAchievements = ref(false);
                const collapseNotes = ref(false);
                const collapseBookNotes = ref(false);
                const showBatchAdd = ref(false);
                const batchAchievementInput = ref('');
                
                // 新增：读书笔记状态
                const bookNotes = ref([]);
                const showBookForm = ref(false);
                const editingBookNote = ref(null);
                const newBookNote = ref({
                    title: '',
                    author: '',
                    note: '',
                    reflection: '',
                    rating: 3,
                    tags: [],
                    createdAt: new Date().toISOString()
                });
                const newBookTagInput = ref('');
                const bookSearchQuery = ref('');
                const filteredBookNotes = ref([]);
                
                // 常用读书标签
                const commonBookTags = ref([
                    '小说', '文学', '心理学', '哲学', '历史', '传记', 
                    '科幻', '悬疑', '成长', '教育', '技术', '管理',
                    '理财', '健康', '艺术', '科普', '经典', '畅销',
                    '已完成', '在读中', '待阅读', '五星推荐', '值得重读'
                ]);
                
                // 笔记筛选器（简化版）
                const noteFilter = ref({
                    timeRange: 'all',
                    selectedTag: '',
                    selectedCategory: '',
                    keyword: ''
                });
                
                // 成就系统数据
                const achievements = ref([
                    { id: 1, category: 'yixue', name: '八字入门', icon: '🌌', description: '完成10次八字学习', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 2, category: 'yixue', name: '六爻初探', icon: '☯️', description: '完成10次六爻学习', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 3, category: 'yixue', name: '风水基础', icon: '🏞️', description: '完成10次风水学习', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 4, category: 'yixue', name: '奇门入门', icon: '🌀', description: '完成10次奇门学习', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 5, category: 'yixue', name: '择日初学', icon: '📅', description: '完成10次择日学习', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 6, category: 'english', name: '高中水平', icon: '🎓', description: '掌握3000个英语单词', requirement: 3000, current: 0, unlocked: false, reward: 150 },
                    { id: 7, category: 'english', name: '四级水平', icon: '📘', description: '掌握5000个英语单词', requirement: 5000, current: 0, unlocked: false, reward: 250 },
                    { id: 8, category: 'english', name: '六级水平', icon: '📗', description: '掌握6500个英语单词', requirement: 6500, current: 0, unlocked: false, reward: 400 },
                    { id: 9, category: 'fitness', name: '运动新手', icon: '💪', description: '完成30次健身运动', requirement: 30, current: 0, unlocked: false, reward: 120 },
                    { id: 10, category: 'fitness', name: '健身达人', icon: '🏋️', description: '完成100次健身运动', requirement: 100, current: 0, unlocked: false, reward: 300 },
                    { id: 11, category: 'meditation', name: '冥想初体验', icon: '🧘', description: '完成20次冥想练习', requirement: 20, current: 0, unlocked: false, reward: 80 },
                    { id: 12, category: 'meditation', name: '心灵平静', icon: '🌿', description: '完成50次冥想练习', requirement: 50, current: 0, unlocked: false, reward: 200 },
                    { id: 13, category: 'skill', name: '多面手', icon: '🔧', description: '拥有5个不同技能', requirement: 5, current: 0, unlocked: false, reward: 150 },
                    { id: 14, category: 'skill', name: '技能大师', icon: '👑', description: '拥有3个达到5级的技能', requirement: 3, current: 0, unlocked: false, reward: 500 }
                ]);

                // ==================== 智能分类配置 ====================
                const categoryRules = {
                    'bazi': ['八字', '命理', '十神', '干支', '五行'],
                    'stock': ['股票', 'k线', '炒股', '大盘', 'A股'],
                    'fitness': ['健身', '运动', '跑步', '撸铁', '增肌', '减脂'],
                    'daily': ['每日', '日记', '总结', '反思', '计划', '日常'],
                    'work': ['工作', '项目', '任务', '汇报', '会议', '职场'],
                    'study': ['学习', '读书', '课程', '考试', '论文', '知识'],
                    'book': ['读书', '阅读', '书籍', '书评', '读后感']
                };

                const categoryDisplayNames = {
                    'all': '全部',
                    'editor': '新建笔记',
                    'bazi': '八字复盘',
                    'stock': '股票复盘',
                    'fitness': '健身记录',
                    'english': '英语学习',
                    'daily': '每日复盘',
                    'work': '工作笔记',
                    'study': '学习笔记',
                    'general': '一般笔记',
                    'custom': '自定义成就',
                    'book': '读书笔记'
                };

                // ==================== 计算属性 ====================
                const totalXpEarned = computed(() => {
                    let total = player.value.xp;
                    skills.value.forEach(skill => total += skill.xp);
                    achievements.value.forEach(ach => {
                        if (ach.unlocked) total += ach.reward;
                    });
                    return total;
                });

                const totalSkills = computed(() => skills.value.length);
                const totalNotes = computed(() => notes.value.length);
                const completedAchievementsCount = computed(() => 
                    achievements.value.filter(a => a.unlocked).length
                );

                // 所有笔记标签
                const allNoteTags = computed(() => {
                    const tags = new Set();
                    notes.value.forEach(note => {
                        if (note.tags && Array.isArray(note.tags)) {
                            note.tags.forEach(tag => tags.add(tag));
                        }
                    });
                    return Array.from(tags).sort();
                });

                // 过滤后的成就
                const filteredAchievements = computed(() => {
                    if (activeAchievementTab.value === 'all') return achievements.value;
                    return achievements.value.filter(a => a.category === activeAchievementTab.value);
                });

                // 过滤和排序后的笔记
                const filteredAndSortedNotes = computed(() => {
                    let filtered = notes.value;
                    
                    if (activeNoteTab.value !== 'all' && activeNoteTab.value !== 'editor') {
                        filtered = filtered.filter(note => {
                            if (note.category === activeNoteTab.value) return true;
                            const keywords = categoryRules[activeNoteTab.value];
                            if (keywords && note.tags) {
                                return note.tags.some(tag => 
                                    keywords.some(keyword => tag.toLowerCase().includes(keyword.toLowerCase()))
                                );
                            }
                            return false;
                        });
                    }
                    
                    const filter = noteFilter.value;
                    
                    if (filter.timeRange !== 'all') {
                        const now = new Date();
                        filtered = filtered.filter(note => {
                            const noteDate = new Date(note.createdAt);
                            switch(filter.timeRange) {
                                case 'today':
                                    return noteDate.toDateString() === now.toDateString();
                                case 'week':
                                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                                    return noteDate >= weekAgo;
                                case 'month':
                                    const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                                    return noteDate >= monthAgo;
                                case 'year':
                                    const yearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                                    return noteDate >= yearAgo;
                                default:
                                    return true;
                            }
                        });
                    }
                    
                    if (filter.selectedTag) {
                        filtered = filtered.filter(note => 
                            note.tags && note.tags.includes(filter.selectedTag)
                        );
                    }
                    
                    if (filter.selectedCategory) {
                        filtered = filtered.filter(note => note.category === filter.selectedCategory);
                    }
                    
                    if (filter.keyword) {
                        const keyword = filter.keyword.toLowerCase();
                        filtered = filtered.filter(note => 
                            note.title.toLowerCase().includes(keyword) || 
                            note.content.toLowerCase().includes(keyword) ||
                            (note.tags && note.tags.some(tag => tag.toLowerCase().includes(keyword)))
                        );
                    }
                    
                    return filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                });

                // 新增：读书笔记相关计算属性
                const averageBookRating = computed(() => {
                    if (bookNotes.value.length === 0) return 0;
                    const total = bookNotes.value.reduce((sum, book) => sum + book.rating, 0);
                    return total / bookNotes.value.length;
                });

                const favoriteBooksCount = computed(() => {
                    return bookNotes.value.filter(book => book.rating >= 4).length;
                });

                const totalBookTags = computed(() => {
                    const allTags = new Set();
                    bookNotes.value.forEach(book => {
                        if (book.tags && Array.isArray(book.tags)) {
                            book.tags.forEach(tag => allTags.add(tag));
                        }
                    });
                    return allTags.size;
                });

                // ==================== 辅助函数 ====================
                const showStatusMessage = (text, type = 'info', duration = 5000) => {
                    statusMessage.value = { text, type };
                    if (duration > 0) {
                        setTimeout(() => {
                            statusMessage.value = null;
                        }, duration);
                    }
                };

                const getCategoryDisplayName = (cat) => {
                    return categoryDisplayNames[cat] || cat;
                };

                // 根据ID获取笔记
                const getNoteById = (id) => {
                    return notes.value.find(note => note.id == id) || {};
                };

                // 从现有笔记中提取所有分类，更新分类列表
                const updateNoteCategoriesFromNotes = () => {
                    const categories = new Set(['all', 'editor']);
                    notes.value.forEach(note => {
                        if (note.category && note.category !== 'general') {
                            categories.add(note.category);
                        }
                    });
                    Object.keys(categoryRules).forEach(cat => {
                        if (notes.value.some(n => n.category === cat) || 
                            notes.value.some(n => n.tags && n.tags.some(t => categoryRules[cat].some(k => t.includes(k))))) {
                            categories.add(cat);
                        }
                    });
                    noteCategories.value = Array.from(categories);
                };

                // 根据标签智能判断分类
                const determineCategoryFromTags = (tags) => {
    // 将标签转为小写便于比较
    const tagSet = new Set(tags.map(tag => tag.toLowerCase().trim()));
    
    // 精确匹配：标签完全等于关键词
    for (const [category, keywords] of Object.entries(categoryRules)) {
        const keywordSet = keywords.map(k => k.toLowerCase());
        if (keywordSet.some(keyword => tagSet.has(keyword))) {
            return category;
        }
    }
    
    // 如果精确匹配失败，尝试部分匹配（但更严格）
    for (const tag of tags) {
        const lowerTag = tag.toLowerCase();
        for (const [category, keywords] of Object.entries(categoryRules)) {
            // 只有当标签明显包含关键词时才匹配
            if (keywords.some(keyword => 
                lowerTag === keyword.toLowerCase() ||  // 精确相等
                lowerTag.startsWith(keyword.toLowerCase()) ||  // 以关键词开头
                lowerTag.endsWith(keyword.toLowerCase())  // 以关键词结尾
            )) {
                return category;
            }
        }
    }
    
    return 'general';
};

                // 重置笔记筛选器
                const resetNoteFilters = () => {
                    noteFilter.value = {
                        timeRange: 'all',
                        selectedTag: '',
                        selectedCategory: '',
                        keyword: ''
                    };
                };

                // 搜索读书笔记
                const searchBooks = () => {
                    if (!bookSearchQuery.value.trim()) {
                        filteredBookNotes.value = [...bookNotes.value];
                        return;
                    }
                    
                    const query = bookSearchQuery.value.toLowerCase().trim();
                    filteredBookNotes.value = bookNotes.value.filter(book => {
                        return (
                            book.title.toLowerCase().includes(query) ||
                            book.author.toLowerCase().includes(query) ||
                            book.note.toLowerCase().includes(query) ||
                            book.reflection.toLowerCase().includes(query) ||
                            (book.tags && book.tags.some(tag => tag.toLowerCase().includes(query)))
                        );
                    });
                };

                // ==================== 读书笔记功能 ====================
                // 切换标签选择
                const toggleBookTag = (tag) => {
                    const index = newBookNote.value.tags.indexOf(tag);
                    if (index === -1) {
                        newBookNote.value.tags.push(tag);
                    } else {
                        newBookNote.value.tags.splice(index, 1);
                    }
                };

                // 添加自定义标签
                const addCustomBookTag = () => {
                    const tag = newBookTagInput.value.trim();
                    if (tag && !newBookNote.value.tags.includes(tag)) {
                        newBookNote.value.tags.push(tag);
                        newBookTagInput.value = '';
                        
                        if (!commonBookTags.value.includes(tag)) {
                            commonBookTags.value.push(tag);
                        }
                    }
                };

                // 保存读书笔记
                const saveBookNote = async () => {
                    if (!newBookNote.value.title.trim()) {
                        showStatusMessage('请输入书名', 'error');
                        return;
                    }
                    
                    if (!newBookNote.value.author.trim()) {
                        showStatusMessage('请输入作者', 'error');
                        return;
                    }
                    
                    const bookToSave = {
                        ...newBookNote.value,
                        id: editingBookNote.value || Date.now(),
                        createdAt: editingBookNote.value ? newBookNote.value.createdAt : new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    if (editingBookNote.value) {
                        // 更新现有笔记
                        const index = bookNotes.value.findIndex(b => b.id === editingBookNote.value);
                        if (index !== -1) {
                            bookNotes.value[index] = bookToSave;
                        }
                    } else {
                        // 添加新笔记
                        bookNotes.value.unshift(bookToSave);
                    }
                    
                    // 重置表单
                    cancelBookNote();
                    
                    // 更新搜索过滤
                    searchBooks();
                    
                    // 保存到GitHub
                    const saveSuccess = await saveGameDataToGitHub();
                    if (saveSuccess) {
                        showStatusMessage(
                            editingBookNote.value ? '读书笔记更新成功！' : '读书笔记添加成功！',
                            'success'
                        );
                    }
                };

                // 编辑读书笔记
                const editBookNote = (id) => {
                    const book = bookNotes.value.find(b => b.id === id);
                    if (!book) return;
                    
                    editingBookNote.value = id;
                    newBookNote.value = { ...book };
                    showBookForm.value = true;
                };

                // 删除读书笔记
                const deleteBookNote = async (id) => {
                    if (!confirm('确定要删除这条读书笔记吗？')) return;
                    
                    const index = bookNotes.value.findIndex(b => b.id === id);
                    if (index === -1) return;
                    
                    const deletedBook = bookNotes.value[index];
                    bookNotes.value.splice(index, 1);
                    
                    // 更新搜索过滤
                    searchBooks();
                    
                    // 保存到GitHub
                    const saveSuccess = await saveGameDataToGitHub();
                    if (saveSuccess) {
                        showStatusMessage(`已删除读书笔记"${deletedBook.title}"`, 'success');
                    }
                };

                // 取消编辑/添加
                const cancelBookNote = () => {
                    newBookNote.value = {
                        title: '',
                        author: '',
                        note: '',
                        reflection: '',
                        rating: 3,
                        tags: [],
                        createdAt: new Date().toISOString()
                    };
                    newBookTagInput.value = '';
                    editingBookNote.value = null;
                    showBookForm.value = false;
                };

                // 初始化过滤的读书笔记
                onMounted(() => {
                    filteredBookNotes.value = [...bookNotes.value];
                });

                // ==================== GitHub API 函数 ====================
               const loadGameDataFromGitHub = async () => {
    const { username, repo, token } = config.value;
    if (!username || !repo) return;
    
    isLoading.value = true;
    configError.value = '';
    
    try {
        // 方案1：优先使用GitHub API（支持私有仓库）
        const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/growth_data.json`;
        const headers = {
            'Accept': 'application/vnd.github.v3+json'
        };
        
        // 如果有token，添加到请求头
        if (token) {
            headers['Authorization'] = `token ${token}`;
        }
        
        const response = await fetch(apiUrl, { 
            headers: headers,
            timeout: 15000 
        });
        
        if (!response.ok) {
            // 如果认证失败或文件不存在，尝试备用方案
            if (response.status === 401 || response.status === 403) {
                throw new Error('认证失败，请检查Token是否有效且有repo权限');
            } else if (response.status === 404) {
                // 文件不存在，返回空数据
                console.log('数据文件不存在，将使用空数据');
                lastSyncTime.value = new Date().toLocaleTimeString();
                showStatusMessage('数据文件不存在，已创建初始数据', 'info');
                return;
            } else {
                throw new Error(`GitHub API错误: ${response.status}`);
            }
        }
        
        const fileInfo = await response.json();
        
        // 解码base64内容
        const decodedContent = decodeURIComponent(escape(atob(fileInfo.content)));
        const gameData = JSON.parse(decodedContent);
        
        if (gameData.player) player.value = gameData.player;
        if (gameData.skills) skills.value = gameData.skills;
        if (gameData.achievements) achievements.value = gameData.achievements;
        if (gameData.notes) notes.value = gameData.notes;
        // 新增：加载读书笔记数据
        if (gameData.bookNotes) bookNotes.value = gameData.bookNotes;
        
        updateNoteCategoriesFromNotes();
        // 初始化过滤的读书笔记
        filteredBookNotes.value = [...bookNotes.value];
        
        lastSyncTime.value = new Date().toLocaleTimeString();
        showStatusMessage('手账数据加载成功！', 'success');
    } catch (error) {
        console.error('加载数据失败:', error);
        
        // 尝试备用方案：使用CDN（仅适用于公开仓库）
        if (token) {
            // 如果有token，再尝试一次带认证的raw请求
            try {
                const rawUrl = `https://raw.githubusercontent.com/${username}/${repo}/main/growth_data.json`;
                const rawResponse = await fetch(rawUrl, {
                    headers: { 'Authorization': `token ${token}` },
                    timeout: 10000
                });
                
                if (rawResponse.ok) {
                    const gameData = await rawResponse.json();
                    // 处理数据...
                    showStatusMessage('通过Raw方式加载成功！', 'success');
                    return;
                }
            } catch (rawError) {
                console.error('Raw方式也失败:', rawError);
            }
        }
        
        configError.value = `加载失败: ${error.message}`;
        showStatusMessage(`加载失败: ${error.message}，请检查配置或网络`, 'error');
        
        // 如果所有方式都失败，尝试从本地缓存加载
        try {
            const cachedData = localStorage.getItem('growth_system_cache');
            if (cachedData) {
                const gameData = JSON.parse(cachedData);
                if (gameData.player) player.value = gameData.player;
                if (gameData.skills) skills.value = gameData.skills;
                if (gameData.achievements) achievements.value = gameData.achievements;
                if (gameData.notes) notes.value = gameData.notes;
                if (gameData.bookNotes) bookNotes.value = gameData.bookNotes;
                
                showStatusMessage('已从本地缓存加载数据', 'warning');
            }
        } catch (cacheError) {
            console.log('本地缓存不可用');
        }
    } finally {
        isLoading.value = false;
    }
};

                // 保存数据到GitHub
                const saveGameDataToGitHub = async () => {
                    if (isSaving.value) return;
                    if (!config.value.token) {
                        showStatusMessage('未提供Token，无法保存到GitHub。请在配置中设置Token。', 'warning');
                        return false;
                    }
                    
                    isSaving.value = true;
                    const { username, repo, token } = config.value;
                    
                    try {
                        const getUrl = `https://api.github.com/repos/${username}/${repo}/contents/growth_data.json`;
                        let sha = null;
                        try {
                            const getRes = await fetch(getUrl, {
                                headers: { 'Authorization': `token ${token}` }
                            });
                            if (getRes.ok) {
                                const info = await getRes.json();
                                sha = info.sha;
                            }
                        } catch (e) { /* 文件可能不存在 */ }
                        
                        const gameData = {
                            version: '7.0', // 版本更新
                            player: player.value,
                            skills: skills.value,
                            achievements: achievements.value,
                            notes: notes.value,
                            bookNotes: bookNotes.value, // 新增：保存读书笔记数据
                            savedAt: new Date().toISOString()
                        };
                        
                        const content = btoa(unescape(encodeURIComponent(JSON.stringify(gameData, null, 2))));
                        
                        const updateUrl = `https://api.github.com/repos/${username}/${repo}/contents/growth_data.json`;
                        const updateRes = await fetch(updateUrl, {
                            method: 'PUT',
                            headers: {
                                'Accept': 'application/vnd.github.v3+json',
                                'Authorization': `token ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: `手账更新 @ ${new Date().toLocaleString()}`,
                                content: content,
                                sha: sha
                            })
                        });
                        
                        if (!updateRes.ok) {
                            const err = await updateRes.json().catch(() => ({}));
                            throw new Error(err.message || '保存失败');
                        }
                        
                        lastSyncTime.value = new Date().toLocaleTimeString();
                        showStatusMessage('💾 数据已保存至GitHub！', 'success', 4000);
                        console.log('💾 数据已保存至GitHub！');
                        return true;
                    } catch (error) {
                        console.error('保存数据失败:', error);
                        showStatusMessage(`保存失败: ${error.message}`, 'error', 6000);
                        return false;
                    } finally {
                        isSaving.value = false;
                    }
                };

                // 手动触发保存函数
                const forceSaveToGitHub = async () => {
                    showStatusMessage('正在保存数据到GitHub...', 'info');
                    await saveGameDataToGitHub();
                };

                // ==================== 配置管理 ====================
                const saveConfigAndLoad = async () => {
                    configError.value = '';
                    if (!config.value.username || !config.value.repo) {
                        configError.value = '请填写用户名和仓库名。';
                        return;
                    }
                    
                    localStorage.setItem('growth_system_config', JSON.stringify({
                        username: config.value.username,
                        repo: config.value.repo
                    }));
                    
                    isConfigured.value = true;
                    showConfig.value = false;
                    
                    await loadGameDataFromGitHub();
                };

                const loadDemoData = () => {
                    if (!confirm('加载演示数据将替换当前所有数据。是否继续？')) return;
                    
                    player.value = { level: 3, xp: 240, nextLevelXp: 500, streak: 7 };
                    skills.value = [
                        { id: 1, name: "八字命理", icon: "🌌", category: "易学", level: 2, xp: 80, maxXp: 200, xpPerPractice: 15, practiceCount: 12 },
                        { id: 2, name: "英语词汇", icon: "📘", category: "英语", level: 3, xp: 180, maxXp: 300, xpPerPractice: 10, practiceCount: 25 },
                        { id: 3, name: "健身训练", icon: "💪", category: "健身", level: 4, xp: 320, maxXp: 400, xpPerPractice: 20, practiceCount: 18 }
                    ];
                    notes.value = [
                        { 
                            id: 1, 
                            title: "八字入门心得", 
                            content: '今天学习了八字的基本排盘方法。\n\n重点：子午卯酉为四正，力量最强。\n\n命理学博大精深，需要长期学习', 
                            tags: ["八字", "入门", "心得"], 
                            category: "bazi",
                            createdAt: new Date(Date.now() - 86400000).toISOString()
                        },
                        { 
                            id: 2, 
                            title: "今日健身记录", 
                            content: '胸肌训练：\n1. 平板卧推 4组×12次\n2. 上斜哑铃推举 3组×10次\n3. 双杠臂屈伸 3组×力竭\n\n感觉不错，继续坚持！', 
                            tags: ["健身", "胸肌", "计划"], 
                            category: "fitness",
                            createdAt: new Date().toISOString()
                        }
                    ];
                    
                    // 新增：演示读书笔记数据
                    bookNotes.value = [
                        {
                            id: 1,
                            title: "活着",
                            author: "余华",
                            note: "这是一部关于中国农民苦难生活的史诗小说，通过福贵的一生，展现了二十世纪中国农村的变迁。\n\n重点摘录：\n1. 人是为了活着本身而活着，而不是为了活着之外的任何事物而活着。\n2. 生活是属于每个人自己的感受，不属于任何别人的看法。",
                            reflection: "读完这本书，让我深刻体会到生命的坚韧和珍贵。福贵经历了无数的苦难，但依然坚强地活着，这种精神值得敬佩。",
                            rating: 5,
                            tags: ["小说", "文学", "经典", "五星推荐"],
                            createdAt: new Date(Date.now() - 172800000).toISOString(),
                            updatedAt: new Date(Date.now() - 172800000).toISOString()
                        },
                        {
                            id: 2,
                            title: "思考，快与慢",
                            author: "丹尼尔·卡尼曼",
                            note: "这本书详细介绍了人类思维的两种系统：\n1. 系统1：快速、直觉、情绪化的思维\n2. 系统2：缓慢、理性、逻辑化的思维\n\n关键概念：\n- 认知偏差\n- 锚定效应\n- 可得性启发法",
                            reflection: "这本书让我更加了解自己的思维模式，认识到很多决策其实受到了系统1的影响。在今后的决策中，我需要更多调用系统2进行理性思考。",
                            rating: 4,
                            tags: ["心理学", "思维", "成长", "值得重读"],
                            createdAt: new Date(Date.now() - 86400000).toISOString(),
                            updatedAt: new Date(Date.now() - 86400000).toISOString()
                        }
                    ];
                    filteredBookNotes.value = [...bookNotes.value];
                    
                    updateNoteCategoriesFromNotes();
                    
                    isConfigured.value = true;
                    showConfig.value = false;
                    showStatusMessage('已加载演示数据！', 'success');
                };

                const openRepoInGitHub = () => {
                    window.open(`https://github.com/${config.value.username}/${config.value.repo}`, '_blank');
                };

                const forceLoadFromGitHub = async () => {
                    await loadGameDataFromGitHub();
                };

                // ==================== 数据导入/导出 ====================
                const exportLocalData = () => {
                    const gameData = {
                        player: player.value,
                        skills: skills.value,
                        achievements: achievements.value,
                        notes: notes.value,
                        bookNotes: bookNotes.value, // 新增：导出读书笔记数据
                        exportedAt: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(gameData, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `成长手账备份_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    showStatusMessage('数据已导出为JSON文件', 'success');
                };

                const importLocalData = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (confirm("导入数据将覆盖当前所有数据，确定继续吗？")) {
                                if (importedData.player) player.value = importedData.player;
                                if (importedData.skills) skills.value = importedData.skills;
                                if (importedData.achievements) achievements.value = importedData.achievements;
                                if (importedData.notes) {
                                    notes.value = importedData.notes;
                                    updateNoteCategoriesFromNotes();
                                }
                                // 新增：导入读书笔记数据
                                if (importedData.bookNotes) {
                                    bookNotes.value = importedData.bookNotes;
                                    filteredBookNotes.value = [...bookNotes.value];
                                }
                                
                                await saveGameDataToGitHub();
                                showStatusMessage('数据导入成功！', 'success');
                            }
                        } catch (error) {
                            console.error(error);
                            showStatusMessage('文件格式错误，导入失败。', 'error');
                        }
                    };
                    reader.readAsText(file);
                    event.target.value = '';
                };

                // ==================== 笔记系统 ====================
                const handleImageUpload = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    if (!file.type.startsWith('image/')) {
                        showStatusMessage('请选择图片文件！', 'error');
                        return;
                    }
                    if (file.size > 2 * 1024 * 1024) {
                        showStatusMessage('图片大小不能超过2MB', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newNote.value.imageData = e.target.result;
                        showStatusMessage('图片已加载', 'success');
                    };
                    reader.readAsDataURL(file);
                };

                const clearUploadedImage = () => {
                    newNote.value.imageData = null;
                };

                const handleImageError = (event) => {
                    event.target.style.display = 'none';
                };

                // 保存笔记
                const saveNote = async () => {
                    if (!newNote.value.title.trim() || !newNote.value.content.trim()) {
                        showStatusMessage("请填写标题和内容", "error");
                        return;
                    }

                    const tags = newNote.value.tagsInput
                        .split(',')
                        .map(tag => tag.trim())
                        .filter(tag => tag.length > 0);

                    let finalCategory = 'general';
                    if (tags.length > 0) {
                        finalCategory = determineCategoryFromTags(tags);
                    }

                    const noteToSave = {
                        id: Date.now(),
                        title: newNote.value.title,
                        content: newNote.value.content,
                        tags: tags,
                        category: finalCategory,
                        createdAt: new Date().toISOString()
                    };

                    if (newNote.value.imageData) {
                        noteToSave.imageData = newNote.value.imageData;
                    }

                    notes.value.unshift(noteToSave);
                    
                    if (!noteCategories.value.includes(finalCategory) && finalCategory !== 'general') {
                        noteCategories.value.push(finalCategory);
                        showStatusMessage(`📁 已创建新分类: ${getCategoryDisplayName(finalCategory)}`, 'success');
                    }

                    const saveSuccess = await saveGameDataToGitHub();
                    if (saveSuccess) {
                        clearNoteEditor();
                        showStatusMessage(`📒 笔记"${noteToSave.title}"保存成功！`, "success", 5000);
                    }
                };

                const clearNoteEditor = () => {
                    newNote.value = {
                        title: '', 
                        content: '', 
                        tagsInput: '', 
                        imageData: null,
                        category: 'general'
                    };
                };

                const editNote = (noteId) => {
                    const note = getNoteById(noteId);
                    if (!note) return;
                    
                    activeNoteTab.value = 'editor';
                    setTimeout(() => {
                        newNote.value = {
                            title: note.title,
                            content: note.content || '',
                            tagsInput: note.tags ? note.tags.join(', ') : '',
                            imageData: note.imageData || null,
                            category: note.category
                        };
                        
                        const noteIndex = notes.value.findIndex(n => n.id === noteId);
                        if (noteIndex !== -1) {
                            notes.value.splice(noteIndex, 1);
                        }
                    }, 100);
                };

                const deleteNote = async (noteId) => {
                    if (!confirm("确定要删除这条笔记吗？")) return;
                    const noteIndex = notes.value.findIndex(n => n.id === noteId);
                    if (noteIndex === -1) return;
                    
                    const deletedNote = notes.value[noteIndex];
                    notes.value.splice(noteIndex, 1);
                    
                    updateNoteCategoriesFromNotes();
                    await saveGameDataToGitHub();
                    showStatusMessage(`已删除笔记"${deletedNote.title}"`, 'success');
                };

                const formatDate = (dateString) => {
                    const date = new Date(dateString);
                    return `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                };

                // ==================== 技能系统 ====================
                const getSkillXpPerPractice = (skill) => {
                    return skill.xpPerPractice || 10;
                };

                const addNewSkill = async () => {
                    const name = prompt("请输入新技能名称：", "例如：Python编程");
                    if (!name || !name.trim()) return;
                    
                    const category = prompt("选择技能类别 (易学/英语/健身/冥想/其他)：", "其他");
                    const icon = prompt("选一个表情图标：", "🌟");
                    const xpPerPractice = parseInt(prompt("每次练习可获得多少经验值？", "10")) || 10;
                    
                    skills.value.push({
                        id: Date.now(),
                        name: name.trim(),
                        category: category || "其他",
                        icon: icon || "🌟",
                        level: 1,
                        xp: 0,
                        maxXp: 100,
                        xpPerPractice: xpPerPractice,
                        practiceCount: 0,
                        createdAt: new Date().toISOString()
                    });
                    
                    const saveSuccess = await saveGameDataToGitHub();
                    if (saveSuccess) {
                        showStatusMessage(`技能"${name.trim()}"添加成功！`, 'success');
                    }
                };

                const practiceSkill = async (skillId) => {
                    const skill = skills.value.find(s => s.id === skillId);
                    if (!skill) return;
                    
                    skill.xp += getSkillXpPerPractice(skill);
                    skill.practiceCount++;
                    player.value.xp += Math.floor(getSkillXpPerPractice(skill) * 0.5);
                    
                    if (skill.xp >= skill.maxXp) {
                        skill.level++;
                        skill.xp = 0;
                        skill.maxXp = Math.floor(skill.maxXp * 1.8);
                        showStatusMessage(`🎯 【${skill.name}】提升到 ${skill.level} 级！`, 'success');
                    }
                    
                    checkLevelUp();
                    await saveGameDataToGitHub();
                };

                const deleteSkill = async (skillId) => {
                    if (!confirm("确定要删除这个技能吗？")) return;
                    const skillIndex = skills.value.findIndex(s => s.id === skillId);
                    if (skillIndex === -1) return;
                    
                    const deletedSkill = skills.value[skillIndex];
                    skills.value.splice(skillIndex, 1);
                    
                    await saveGameDataToGitHub();
                    showStatusMessage(`已删除技能"${deletedSkill.name}"`, 'success');
                };

                // ==================== 成就系统 ====================
                // 加载示例成就
                const loadExampleAchievements = () => {
                    batchAchievementInput.value = `[
  {
    "category": "custom",
    "name": "早起达人",
    "icon": "🌅",
    "description": "连续30天早上6点前起床",
    "requirement": 30,
    "reward": 150
  },
  {
    "category": "reading",
    "name": "读书破万卷",
    "icon": "📚",
    "description": "阅读100本书",
    "requirement": 100,
    "reward": 300
  }
]`;
                    showStatusMessage('已加载示例成就数据，请检查并修改后添加', 'info');
                };

                // 清空批量输入
                const clearBatchInput = () => {
                    batchAchievementInput.value = '';
                };

                // 批量添加成就
                const addBatchAchievements = async () => {
                    if (!batchAchievementInput.value.trim()) {
                        showStatusMessage('请输入成就数据', 'error');
                        return;
                    }
                    
                    try {
                        const newAchievements = JSON.parse(batchAchievementInput.value);
                        if (!Array.isArray(newAchievements)) {
                            throw new Error('成就数据必须是数组格式');
                        }
                        
                        let maxId = achievements.value.reduce((max, ach) => Math.max(max, ach.id), 0);
                        
                        const addedCount = newAchievements.length;
                        newAchievements.forEach(ach => {
                            maxId++;
                            
                            const exists = achievements.value.some(a => a.name === ach.name);
                            if (exists) {
                                showStatusMessage(`成就"${ach.name}"已存在，跳过添加`, 'warning');
                                return;
                            }
                            
                            achievements.value.push({
                                id: maxId,
                                category: ach.category || 'custom',
                                name: ach.name || '新成就',
                                icon: ach.icon || '🏆',
                                description: ach.description || '',
                                requirement: ach.requirement || 1,
                                current: ach.current || 0,
                                unlocked: ach.unlocked || false,
                                reward: ach.reward || 0
                            });
                        });
                        
                        const saveSuccess = await saveGameDataToGitHub();
                        if (saveSuccess) {
                            batchAchievementInput.value = '';
                            showBatchAdd.value = false;
                            showStatusMessage(`成功添加${addedCount}个新成就！`, 'success');
                        }
                    } catch (error) {
                        console.error('添加成就失败:', error);
                        showStatusMessage(`添加失败: ${error.message}，请检查JSON格式`, 'error');
                    }
                };

                // 删除成就
                const deleteAchievement = async (achievementId) => {
                    if (!confirm("确定要删除这个成就吗？此操作不可撤销！")) return;
                    
                    const index = achievements.value.findIndex(a => a.id === achievementId);
                    if (index !== -1) {
                        const deletedName = achievements.value[index].name;
                        achievements.value.splice(index, 1);
                        
                        await saveGameDataToGitHub();
                        showStatusMessage(`已删除成就"${deletedName}"`, 'success');
                    }
                };

                // ==================== 游戏逻辑 ====================
                const calculateNextLevelXp = (level) => {
                    return Math.floor(100 * Math.pow(1.5, level - 1));
                };

                const checkLevelUp = () => {
                    while (player.value.xp >= player.value.nextLevelXp) {
                        player.value.level++;
                        player.value.xp -= player.value.nextLevelXp;
                        player.value.nextLevelXp = calculateNextLevelXp(player.value.level);
                        showStatusMessage(`🎉 恭喜升级！现在是 ${player.value.level} 级！`, 'success');
                    }
                };

                const resetData = async () => {
                    if (!confirm("⚠️ 警告：重置将永久清除所有技能、笔记、读书笔记和成就数据，此操作不可撤销！确定继续吗？")) return;
                    
                    player.value = { level: 1, xp: 0, nextLevelXp: calculateNextLevelXp(1), streak: 1 };
                    skills.value = [];
                    notes.value = [];
                    bookNotes.value = [];
                    filteredBookNotes.value = [];
                    noteCategories.value = ['all', 'editor'];
                    achievements.value.forEach(ach => {
                        ach.current = 0;
                        ach.unlocked = false;
                    });
                    
                    if (config.value.token) {
                        const saveSuccess = await saveGameDataToGitHub();
                        if (saveSuccess) {
                            showStatusMessage('数据已重置并同步到云端', 'success');
                        }
                    } else {
                        showStatusMessage('数据已重置（本地）', 'success');
                    }
                };

                // ==================== 初始化 ====================
                onMounted(() => {
                    const savedConfig = localStorage.getItem('growth_system_config');
                    if (savedConfig) {
                        try {
                            const { username, repo } = JSON.parse(savedConfig);
                            config.value.username = username;
                            config.value.repo = repo;
                            isConfigured.value = true;
                        } catch (e) {
                            console.log('本地配置读取失败');
                        }
                    }
                    player.value.nextLevelXp = calculateNextLevelXp(player.value.level);
                    console.log('✏️ 智能成长手账系统已启动！');
                });

                // ==================== 暴露给模板 ====================
                return {
                    isConfigured, showConfig, showImport, isSaving, isLoading, 
                    configError, lastSyncTime, statusMessage,
                    config, player, skills, achievements, notes, newNote,
                    activeAchievementTab, activeNoteTab, noteCategories,
                    
                    // 折叠状态和批量添加
                    collapseStatus, collapseSkills, collapseAchievements, collapseNotes, collapseBookNotes,
                    showBatchAdd, batchAchievementInput, noteFilter,
                    
                    // 读书笔记相关
                    bookNotes, showBookForm, editingBookNote, newBookNote, newBookTagInput,
                    bookSearchQuery, filteredBookNotes, commonBookTags,
                    
                    // 计算属性
                    totalXpEarned, totalSkills, totalNotes, completedAchievementsCount,
                    filteredAchievements, filteredAndSortedNotes, allNoteTags,
                    averageBookRating, favoriteBooksCount, totalBookTags,
                    
                    // 配置和GitHub操作
                    saveConfigAndLoad, loadDemoData, 
                    openRepoInGitHub, forceLoadFromGitHub, forceSaveToGitHub,
                    exportLocalData, importLocalData,
                    
                    // 读书笔记功能
                    toggleBookTag, addCustomBookTag, saveBookNote, editBookNote,
                    deleteBookNote, cancelBookNote, searchBooks,
                    
                    // 笔记系统
                    handleImageUpload, clearUploadedImage, handleImageError,
                    getCategoryDisplayName, resetNoteFilters, getNoteById,
                    
                    // 技能系统
                    getSkillXpPerPractice, addNewSkill, practiceSkill, deleteSkill,
                    
                    // 笔记系统
                    saveNote, clearNoteEditor, editNote, deleteNote, formatDate,
                    
                    // 成就系统
                    loadExampleAchievements, clearBatchInput, addBatchAchievements, deleteAchievement,
                    
                    // 其他
                    resetData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>



