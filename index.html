<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººç³»ç»Ÿ | GitHubæ™ºèƒ½åŒæ­¥ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* ====== å…¨å±€æ ·å¼ ====== */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }

        /* ====== æ ‡é¢˜ä¸å¯¼èˆª ====== */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(106, 17, 203, 0.2);
        }
        .header h1 { font-size: 2.8em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; max-width: 700px; margin: 0 auto; }

        /* ====== ç½‘æ ¼å¸ƒå±€ ====== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        /* ====== å¡ç‰‡è®¾è®¡ ====== */
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 28px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        .card h2 {
            margin-bottom: 22px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(106, 17, 203, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            color: #2d3436;
            font-size: 1.5em;
        }

        /* ====== ç©å®¶ç­‰çº§æ˜¾ç¤º ====== */
        .level-display {
            font-size: 4.5em;
            font-weight: 800;
            text-align: center;
            margin: 25px 0;
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
        }
        .xp-progress { height: 22px; background: #e9ecef; border-radius: 12px; margin: 18px 0; overflow: hidden; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, #00b09b, #96c93d); border-radius: 12px; transition: width 0.7s ease; }

        /* ====== ä»»åŠ¡ä¸æŠ€èƒ½é¡¹ ====== */
        .task-item, .skill-item {
            padding: 18px;
            background: rgba(245, 247, 250, 0.8);
            border-radius: 14px;
            margin: 14px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        .task-item:hover, .skill-item:hover {
            background: rgba(255, 255, 255, 1);
            border-left-color: #6a11cb;
        }
        .task-item.completed { opacity: 0.7; background: rgba(0, 176, 155, 0.07); }
        .xp-badge {
            background: linear-gradient(45deg, #ff9a00, #ff5e00);
            color: white;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        /* ====== æŒ‰é’®æ ·å¼ ====== */
        .btn {
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            border: none;
            padding: 14px 30px;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: block;
            width: 100%;
            margin-top: 18px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(106, 17, 203, 0.25);
        }
        .btn-sm {
            padding: 8px 22px;
            font-size: 0.9em;
            width: auto;
            border-radius: 30px;
            background: linear-gradient(90deg, #00b09b, #96c93d);
        }

        /* ====== é…ç½®é¢æ¿ ====== */
        .config-panel {
            max-width: 600px;
            margin: 30px auto;
        }
        .config-info {
            padding: 15px;
            background: #fff8e1;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .config-info a {
            color: #6a11cb;
            font-weight: bold;
            text-decoration: none;
        }
        .config-info a:hover {
            text-decoration: underline;
        }

        /* ====== ç¬”è®°ç³»ç»Ÿ ====== */
        .note-section {
            margin-top: 40px;
        }
        .note-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .note-tab {
            padding: 12px 28px;
            background: #f8f9fa;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .note-tab.active {
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            color: white;
            border-color: #6a11cb;
        }
        .note-editor {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
            margin-bottom: 30px;
        }
        .note-input, .tag-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border 0.3s;
        }
        .note-input:focus, .tag-input:focus {
            outline: none;
            border-color: #6a11cb;
        }
        .note-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }
        .note-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            border: 1px solid #e9ecef;
        }
        .note-tags { display: flex; gap: 8px; flex-wrap: wrap; margin: 15px 0; }
        .note-tag {
            background: rgba(106, 17, 203, 0.1);
            color: #6a11cb;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .note-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: block;
        }

        /* ====== å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ ====== */
        .image-upload-area {
            margin: 15px 0;
            padding: 20px;
            border: 2px dashed #74b9ff;
            border-radius: 12px;
            background: rgba(116, 185, 255, 0.05);
            text-align: center;
        }
        .image-preview {
            margin-top: 15px;
        }
        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        /* ====== çŠ¶æ€æç¤º ====== */
        .status-message {
            padding: 12px 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
        }
        .status-success {
            background: rgba(46, 204, 113, 0.2);
            color: #27ae60;
            border-left: 4px solid #27ae60;
        }
        .status-error {
            background: rgba(231, 76, 60, 0.2);
            color: #c0392b;
            border-left: 4px solid #c0392b;
        }
        .status-warning {
            background: rgba(241, 196, 15, 0.2);
            color: #f39c12;
            border-left: 4px solid #f39c12;
        }

        /* ====== åŠ è½½åŠ¨ç”» ====== */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(106, 17, 203, 0.3);
            border-radius: 50%;
            border-top-color: #6a11cb;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <!-- === é…ç½®é¢æ¿ === -->
        <div v-if="!isConfigured" class="config-panel">
            <div class="card">
                <h2>ğŸ”§ é…ç½®GitHubåŒæ­¥</h2>
                <div class="config-info">
                    <p><strong>éœ€è¦æå‰å‡†å¤‡ï¼š</strong></p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>ä¸€ä¸ªGitHubè´¦å·</li>
                        <li>ä¸€ä¸ª<strong>ç§æœ‰ä»“åº“</strong>ç”¨äºå­˜å‚¨æ•°æ®</li>
                        <li>ä¸€ä¸ª<strong>ä¸ªäººè®¿é—®ä»¤ç‰Œ (Token)</strong>ï¼Œéœ€æœ‰ <code>repo</code> æƒé™
                            <br><a href="https://github.com/settings/tokens" target="_blank">ç‚¹å‡»è¿™é‡Œåˆ›å»ºToken</a>
                        </li>
                    </ol>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">GitHub ç”¨æˆ·å</label>
                    <input type="text" v-model="config.username" class="note-input" placeholder="ä¾‹å¦‚ï¼šzhangsan">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">æ•°æ®ä»“åº“åç§°</label>
                    <input type="text" v-model="config.repo" class="note-input" placeholder="ä¾‹å¦‚ï¼šmy-growth-data">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">ä¸ªäººè®¿é—®ä»¤ç‰Œ (Token)</label>
                    <input type="password" v-model="config.token" class="note-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                    <p style="font-size: 0.9em; color: #888; margin-top: 5px;">
                        âš ï¸ Tokenä»…ç”¨äºä¸ä½ çš„ä»“åº“é€šä¿¡ï¼Œæœ¬é¡µé¢ä¸ä¼šå­˜å‚¨å®ƒï¼ˆåˆ·æ–°é¡µé¢åéœ€é‡æ–°è¾“å…¥ï¼‰ã€‚
                    </p>
                </div>
                
                <div style="display: flex; gap: 15px;">
                    <button class="btn" @click="saveConfigAndLoad" style="flex: 1;">
                        <span v-if="isLoading">âŒ› è¿æ¥ä¸­...</span>
                        <span v-else>âœ… è¿æ¥å¹¶åŠ è½½æ•°æ®</span>
                    </button>
                    <button class="btn" @click="loadDemoData" style="flex: 1; background: #95a5a6;" :disabled="isLoading">
                        ğŸ® è¯•ç”¨æ¼”ç¤ºæ•°æ®
                    </button>
                </div>
                
                <div v-if="configError" class="status-error status-message">
                    {{ configError }}
                </div>
            </div>
        </div>

        <!-- === ä¸»åº”ç”¨ç•Œé¢ === -->
        <div v-else>
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="header" style="position: relative;">
                <h1>ğŸ§  ä¸ªäººç³»ç»Ÿ</h1>
                <p>æ•°æ®åŒæ­¥è‡³: <strong>{{ config.username }}/{{ config.repo }}</strong></p>
                
                <div style="position: absolute; top: 30px; right: 30px; display: flex; gap: 10px;">
                    <button class="btn-sm" @click="forceLoadFromGitHub" :disabled="isLoading">
                        <span v-if="isLoading">âŒ› åŠ è½½ä¸­...</span>
                        <span v-else>ğŸ”„ æ‰‹åŠ¨åŒæ­¥</span>
                    </button>
                    <button class="btn-sm" @click="showConfig=!showConfig" style="background: #636e72;">
                        âš™ï¸ {{ showConfig ? 'éšè—é…ç½®' : 'æ˜¾ç¤ºé…ç½®' }}
                    </button>
                </div>
                
                <div style="font-size: 0.9em; opacity: 0.9; margin-top: 10px;">
                    <span>æœ€ååŒæ­¥: {{ lastSyncTime || 'ä»æœªåŒæ­¥' }}</span>
                    <span v-if="isSaving" style="color: #00b894; margin-left: 15px;">
                        <span class="loading-spinner" style="margin-right: 5px;"></span> ä¿å­˜ä¸­...
                    </span>
                </div>
            </div>

            <!-- é…ç½®æŠ½å±‰ -->
            <div v-if="showConfig" class="card" style="margin-bottom: 20px;">
                <h3>âš™ï¸ åŒæ­¥é…ç½®</h3>
                <p>å½“å‰ä»“åº“: <code>{{ config.username }}/{{ config.repo }}</code></p>
                <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                    Token: {{ config.token ? 'å·²è®¾ç½® (' + config.token.substring(0, 8) + '...)' : 'æœªè®¾ç½®' }}
                </p>
                <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                    <button class="btn-sm" @click="openRepoInGitHub" style="background: #0984e3;">ğŸ“‚ æ‰“å¼€ä»“åº“</button>
                    <button class="btn-sm" @click="exportLocalData" style="background: #00b894;">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
                    <button class="btn-sm" @click="showImport=!showImport" style="background: #fdcb6e; color: #2d3436;">ğŸ“‚ å¯¼å…¥æ•°æ®</button>
                    <button class="btn-sm" @click="isConfigured=false" style="background: #dfe6e9; color:#2d3436;">âœï¸ ä¿®æ”¹é…ç½®</button>
                </div>
                
                <!-- å¯¼å…¥æ•°æ®åŒºåŸŸ -->
                <div v-if="showImport" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <h4>å¯¼å…¥å¤‡ä»½æ•°æ®</h4>
                    <input type="file" accept=".json" @change="importLocalData" style="margin: 10px 0;">
                    <p style="font-size: 0.9em; color: #666;">é€‰æ‹©ä¹‹å‰å¯¼å‡ºçš„JSONå¤‡ä»½æ–‡ä»¶</p>
                </div>
            </div>
            
            <!-- çŠ¶æ€æ¶ˆæ¯ -->
            <div v-if="statusMessage" :class="['status-message', statusMessage.type === 'success' ? 'status-success' : statusMessage.type === 'error' ? 'status-error' : 'status-warning']">
                {{ statusMessage.text }}
            </div>

            <!-- ä¸»ç½‘æ ¼å¸ƒå±€ -->
            <div class="grid">
                <!-- æ·»åŠ åˆ°ç°æœ‰æŒ‰é’®ä¹‹å‰ -->
<button class="btn" @click="forceSaveToGitHub" style="background:linear-gradient(90deg, #3498db, #2ecc71); margin-top:15px;">
    ğŸ’¾ ç«‹å³ä¿å­˜åˆ°äº‘ç«¯
</button>
<button class="btn" @click="resetData" style="background:linear-gradient(90deg, #ff416c, #ff4b2b); margin-top:15px;">
    ğŸ”„ é‡ç½®æ‰€æœ‰æ•°æ®
</button>
                <!-- ç©å®¶çŠ¶æ€é¢æ¿ -->
                <div class="card">
                    <h2>ğŸ“Š æˆé•¿çŠ¶æ€</h2>
                    <div class="level-display">Lv. {{ player.level }}</div>
                    <div style="margin: 25px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>ç»éªŒå€¼ (XP):</span>
                            <span><strong>{{ player.xp }}</strong> / {{ player.nextLevelXp }}</span>
                        </div>
                        <div class="xp-progress">
                            <div class="xp-fill" :style="{ width: (player.xp / player.nextLevelXp * 100) + '%' }"></div>
                        </div>
                        <div style="text-align: center; margin-top: 15px; font-size: 1em; color: #6c757d;">
                            è¿˜éœ€ {{ player.nextLevelXp - player.xp }} XP å‡çº§
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid rgba(0,0,0,0.05);">
                        <div class="stats-grid" style="grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <div style="font-size: 2em; font-weight: bold; color: #6a11cb;">{{ totalSkills }}</div>
                                <div style="color: #6c757d;">æŠ€èƒ½æ•°é‡</div>
                            </div>
                            <div>
                                <div style="font-size: 2em; font-weight: bold; color: #00b09b;">{{ completedAchievementsCount }}</div>
                                <div style="color: #6c757d;">æˆå°±è¾¾æˆ</div>
                            </div>
                        </div>
                        <button class="btn" @click="resetData" style="background:linear-gradient(90deg, #ff416c, #ff4b2b); margin-top:25px;">
                            ğŸ”„ é‡ç½®æ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ï¼ï¼‰
                        </button>
                    </div>
                </div>

                <!-- æŠ€èƒ½æ ‘ -->
                <div class="card">
                    <h2>ğŸŒ± æˆ‘çš„æŠ€èƒ½æ ‘</h2>
                    <p style="margin-bottom:20px; color:#6c757d;">ä»é›¶å¼€å§‹ï¼Œè‡ªç”±æ·»åŠ ä½ æƒ³åŸ¹å…»çš„ä»»ä½•æŠ€èƒ½</p>
                    
                    <div v-if="skills.length === 0" style="text-align:center; padding:40px 20px; color:#adb5bd;">
                        <div style="font-size:3em; margin-bottom:15px;">ğŸŒ±</div>
                        <p>æŠ€èƒ½æ ‘ç©ºç©ºå¦‚ä¹Ÿ</p>
                        <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªæŠ€èƒ½å§ï¼</p>
                    </div>
                    
                    <div v-for="skill in skills" :key="skill.id" class="skill-item">
                        <div style="flex-grow:1;">
                            <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
                                <span style="font-size:1.8em;">{{ skill.icon }}</span>
                                <div>
                                    <strong style="font-size:1.2em; color:#2d3436;">{{ skill.name }}</strong>
                                    <div style="font-size:0.9em; color:#6c757d;">ç±»åˆ«: {{ skill.category }} Â· ç­‰çº§ {{ skill.level }}</div>
                                </div>
                            </div>
                            <div class="xp-progress" style="height:12px; margin:10px 0;">
                                <div class="xp-fill" :style="{ width: (skill.xp / skill.maxXp * 100) + '%' }"></div>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:0.9em; color:#6c757d;">
                                <span>{{ skill.xp }} / {{ skill.maxXp }} XP</span>
                                <span>{{ Math.round(skill.xp / skill.maxXp * 100) }}%</span>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn-sm" @click="practiceSkill(skill.id)" style="background:linear-gradient(90deg, #6a11cb, #2575fc);">
                                ç»ƒä¹  +{{ getSkillXpPerPractice(skill) }}
                            </button>
                            <button class="btn-sm" @click="deleteSkill(skill.id)" style="background:#e9ecef; color:#6c757d;">
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn" @click="addNewSkill" style="background:linear-gradient(90deg, #00b09b, #96c93d);">
                        ğŸŒŸ æ·»åŠ æ–°æŠ€èƒ½
                    </button>
                </div>

                <!-- æˆå°±ç³»ç»Ÿ -->
                <div class="card">
                    <h2>ğŸ† æˆå°±ç³»ç»Ÿ</h2>
                    <div class="note-tabs" style="margin-bottom:20px;">
                        <div class="note-tab" :class="{active: activeAchievementTab === 'all'}" @click="activeAchievementTab = 'all'">å…¨éƒ¨</div>
                        <div class="note-tab" :class="{active: activeAchievementTab === 'yixue'}" @click="activeAchievementTab = 'yixue'">æ˜“å­¦</div>
                        <div class="note-tab" :class="{active: activeAchievementTab === 'english'}" @click="activeAchievementTab = 'english'">è‹±è¯­</div>
                        <div class="note-tab" :class="{active: activeAchievementTab === 'fitness'}" @click="activeAchievementTab = 'fitness'">å¥èº«</div>
                    </div>
                    
                    <div class="achievement-grid">
                        <div v-for="achievement in filteredAchievements" :key="achievement.id" 
                             class="achievement-card" :class="{locked: !achievement.unlocked}">
                            <div class="achievement-icon">{{ achievement.icon }}</div>
                            <h3 style="margin-bottom:10px; color:#2d3436;">{{ achievement.name }}</h3>
                            <p style="font-size:0.95em; color:#6c757d; margin-bottom:15px; min-height:40px;">{{ achievement.description }}</p>
                            
                            <div v-if="!achievement.unlocked">
                                <div class="achievement-progress">
                                    <div class="achievement-progress-fill" 
                                         :style="{ width: Math.min(100, (achievement.current / achievement.requirement * 100)) + '%' }"></div>
                                </div>
                                <div style="display:flex; justify-content:space-between; font-size:0.9em; color:#6c757d;">
                                    <span>è¿›åº¦: {{ achievement.current }} / {{ achievement.requirement }}</span>
                                    <span>{{ Math.round(achievement.current / achievement.requirement * 100) }}%</span>
                                </div>
                            </div>
                            
                            <div v-if="achievement.unlocked" 
                                 style="text-align:center; padding:10px; background:rgba(0,176,155,0.1); border-radius:10px; margin-top:15px;">
                                <span style="color:#00b09b; font-weight:bold;">ğŸ‰ å·²è§£é”</span>
                                <div style="font-size:0.9em; color:#6c757d; margin-top:5px;">
                                    {{ achievement.reward }} XP
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¤ç›˜ä¸ç¬”è®°ç³»ç»Ÿ -->
            <div class="note-section">
                <div class="card">
                    <h2>ğŸ“ å¤ç›˜ä¸ç¬”è®°</h2>
                    
                    <div class="note-tabs">
                        <div class="note-tab" :class="{active: activeNoteTab === 'all'}" @click="activeNoteTab = 'all'">å…¨éƒ¨</div>
                        <div class="note-tab" :class="{active: activeNoteTab === 'editor'}" @click="activeNoteTab = 'editor'">å†™ç¬”è®°</div>
                        <div v-for="cat in noteCategories" :key="cat" 
                             class="note-tab" 
                             :class="{active: activeNoteTab === cat}" 
                             @click="activeNoteTab = cat">
                            {{ getCategoryDisplayName(cat) }}
                        </div>
                    </div>
                    
                    <!-- ç¬”è®°ç¼–è¾‘å™¨ -->
                    <div v-if="activeNoteTab === 'editor'" class="note-editor">
                        <input type="text" class="note-input" v-model="newNote.title" placeholder="ç¬”è®°æ ‡é¢˜">
                        <textarea class="note-input" v-model="newNote.content" placeholder="è®°å½•ä½ çš„æ€è€ƒã€å¤ç›˜å†…å®¹..." rows="6"></textarea>
                        <input type="text" class="tag-input" v-model="newNote.tagsInput" placeholder="æ·»åŠ æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš” (ä¾‹å¦‚: å…«å­—, å¤ç›˜, æ„Ÿæ‚Ÿ)">
                        
                        <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
                        <div class="image-upload-area">
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">ğŸ“¸ æ·»åŠ å›¾ç‰‡</label>
                            <input type="file" accept="image/*" @change="handleImageUpload" style="display: block; margin: 0 auto 15px;">
                            <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">æ”¯æŒ JPG, PNG, GIF æ ¼å¼ï¼Œæœ€å¤§ 2MB</p>
                            
                            <div v-if="newNote.imageData" class="image-preview">
                                <p>å›¾ç‰‡é¢„è§ˆï¼š</p>
                                <img :src="newNote.imageData" alt="é¢„è§ˆ">
                                <button class="btn-sm" @click="clearUploadedImage" style="background: #ffeaa7; color: #2d3436; margin-top: 10px;">
                                    æ¸…é™¤å›¾ç‰‡
                                </button>
                            </div>
                        </div>
                        
                        <div style="display:flex; gap:15px; margin-top:20px;">
                            <button class="btn" @click="saveNote" style="width:auto; padding:12px 40px;">
                                ä¿å­˜ç¬”è®°
                            </button>
                            <button class="btn" @click="clearNoteEditor" 
                                    style="width:auto; padding:12px 30px; background:#6c757d;">
                                æ¸…ç©º
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç¬”è®°åˆ—è¡¨ -->
                    <div v-if="activeNoteTab !== 'editor'" class="note-list">
                        <div v-for="note in filteredNotes" :key="note.id" class="note-card">
                            <h3 style="margin-bottom:15px; color:#2d3436;">{{ note.title }}</h3>
                            <div class="note-tags">
                                <span class="note-tag" v-for="tag in note.tags" :key="tag">{{ tag }}</span>
                            </div>
                            <div style="color:#495057; line-height:1.7; margin:20px 0; white-space: pre-line;">{{ note.content }}</div>
                            
                            <!-- æ˜¾ç¤ºå›¾ç‰‡ï¼ˆæ”¯æŒBase64å’ŒURLï¼‰ -->
                            <div v-if="note.imageData || note.imageUrl" style="margin-top:20px;">
                                <img :src="note.imageData || note.imageUrl" alt="ç¬”è®°å›¾ç‰‡" class="note-image" @error="handleImageError">
                            </div>
                            
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:25px; padding-top:20px; border-top:1px solid #e9ecef;">
                                <div style="font-size:0.9em; color:#6c757d;">
                                    {{ formatDate(note.createdAt) }}
                                </div>
                                <button class="btn-sm" @click="deleteNote(note.id)" style="background:#f8d7da; color:#dc3545;">
                                    åˆ é™¤
                                </button>
                            </div>
                        </div>
                        
                        <div v-if="filteredNotes.length === 0" style="text-align:center; padding:40px 20px; color:#adb5bd; grid-column: 1 / -1;">
                            <div style="font-size:3em; margin-bottom:15px;">ğŸ“</div>
                            <p>æš‚æ— ç¬”è®°</p>
                            <p>åˆ‡æ¢åˆ°"å†™ç¬”è®°"æ ‡ç­¾å¼€å§‹è®°å½•å§ï¼</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ•°æ®æ¦‚è§ˆ -->
            <div class="card" style="margin-top: 40px;">
                <h2>ğŸ“ˆ æˆé•¿æ¦‚è§ˆ</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">{{ totalXpEarned }}</div>
                        <div class="stat-label">ç´¯è®¡è·å¾—ç»éªŒ</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{ totalSkills }}</div>
                        <div class="stat-label">æŠ€èƒ½æ•°é‡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{ totalNotes }}</div>
                        <div class="stat-label">ç¬”è®°æ•°é‡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{ completedAchievementsCount }}</div>
                        <div class="stat-label">æˆå°±è¾¾æˆ</div>
                    </div>
                </div>
                <p style="text-align:center; margin-top:30px; padding-top:25px; border-top:1px solid rgba(0,0,0,0.05); color:#6c757d; font-size:0.95em;">
                    æ‰€æœ‰æ•°æ®é€šè¿‡GitHub APIåŒæ­¥è‡³ä½ çš„ç§æœ‰ä»“åº“ï¼Œåˆ·æ–°é¡µé¢Tokenä¼šå¤±æ•ˆéœ€é‡æ–°è¾“å…¥ã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                // ==================== çŠ¶æ€ä¸é…ç½® ====================
                const isConfigured = ref(false);
                const showConfig = ref(false);
                const showImport = ref(false);
                const isSaving = ref(false);
                const isLoading = ref(false);
                const configError = ref('');
                const lastSyncTime = ref('');
                const statusMessage = ref(null);
                
                // ç”¨æˆ·é…ç½®ï¼ˆé¦–æ¬¡éœ€è¦å¡«å†™ï¼‰
                const config = ref({
                    username: '',
                    repo: '',
                    token: ''
                });

                // æ ¸å¿ƒæ¸¸æˆæ•°æ®ï¼ˆåˆå§‹ä¸ºç©ºï¼‰
                const player = ref({ level: 1, xp: 0, nextLevelXp: 100, streak: 1 });
                const skills = ref([]);
                const notes = ref([]);
                const activeAchievementTab = ref('all');
                const activeNoteTab = ref('editor');
                const noteCategories = ref(['all', 'editor', 'bazi', 'stock', 'fitness', 'english']); // åŠ¨æ€åˆ†ç±»åˆ—è¡¨
                const newNote = ref({ 
                    title: '', 
                    content: '', 
                    tagsInput: '', 
                    imageData: null,
                    category: 'general' 
                });
                
                // æˆå°±ç³»ç»Ÿæ•°æ®
                const achievements = ref([
                    // æ˜“å­¦ç±»æˆå°±
                    { id: 1, category: 'yixue', name: 'å…«å­—å…¥é—¨', icon: 'ğŸŒŒ', description: 'å®Œæˆ10æ¬¡å…«å­—å­¦ä¹ ', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 2, category: 'yixue', name: 'å…­çˆ»åˆæ¢', icon: 'â˜¯ï¸', description: 'å®Œæˆ10æ¬¡å…­çˆ»å­¦ä¹ ', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 3, category: 'yixue', name: 'é£æ°´åŸºç¡€', icon: 'ğŸï¸', description: 'å®Œæˆ10æ¬¡é£æ°´å­¦ä¹ ', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 4, category: 'yixue', name: 'å¥‡é—¨å…¥é—¨', icon: 'ğŸŒ€', description: 'å®Œæˆ10æ¬¡å¥‡é—¨å­¦ä¹ ', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    { id: 5, category: 'yixue', name: 'æ‹©æ—¥åˆå­¦', icon: 'ğŸ“…', description: 'å®Œæˆ10æ¬¡æ‹©æ—¥å­¦ä¹ ', requirement: 10, current: 0, unlocked: false, reward: 100 },
                    
                    // è‹±è¯­ç±»æˆå°±
                    { id: 6, category: 'english', name: 'é«˜ä¸­æ°´å¹³', icon: 'ğŸ“', description: 'æŒæ¡3000ä¸ªè‹±è¯­å•è¯', requirement: 3000, current: 0, unlocked: false, reward: 150 },
                    { id: 7, category: 'english', name: 'å››çº§æ°´å¹³', icon: 'ğŸ“˜', description: 'æŒæ¡5000ä¸ªè‹±è¯­å•è¯', requirement: 5000, current: 0, unlocked: false, reward: 250 },
                    { id: 8, category: 'english', name: 'å…­çº§æ°´å¹³', icon: 'ğŸ“—', description: 'æŒæ¡6500ä¸ªè‹±è¯­å•è¯', requirement: 6500, current: 0, unlocked: false, reward: 400 },
                    
                    // å¥èº«ç±»æˆå°±
                    { id: 9, category: 'fitness', name: 'è¿åŠ¨æ–°æ‰‹', icon: 'ğŸ’ª', description: 'å®Œæˆ30æ¬¡å¥èº«è¿åŠ¨', requirement: 30, current: 0, unlocked: false, reward: 120 },
                    { id: 10, category: 'fitness', name: 'å¥èº«è¾¾äºº', icon: 'ğŸ‹ï¸', description: 'å®Œæˆ100æ¬¡å¥èº«è¿åŠ¨', requirement: 100, current: 0, unlocked: false, reward: 300 },
                    
                    // å†¥æƒ³ç±»æˆå°±
                    { id: 11, category: 'meditation', name: 'å†¥æƒ³åˆä½“éªŒ', icon: 'ğŸ§˜', description: 'å®Œæˆ20æ¬¡å†¥æƒ³ç»ƒä¹ ', requirement: 20, current: 0, unlocked: false, reward: 80 },
                    { id: 12, category: 'meditation', name: 'å¿ƒçµå¹³é™', icon: 'ğŸŒ¿', description: 'å®Œæˆ50æ¬¡å†¥æƒ³ç»ƒä¹ ', requirement: 50, current: 0, unlocked: false, reward: 200 },
                    
                    // ä¸ªäººæŠ€èƒ½ç±»
                    { id: 13, category: 'skill', name: 'å¤šé¢æ‰‹', icon: 'ğŸ”§', description: 'æ‹¥æœ‰5ä¸ªä¸åŒæŠ€èƒ½', requirement: 5, current: 0, unlocked: false, reward: 150 },
                    { id: 14, category: 'skill', name: 'æŠ€èƒ½å¤§å¸ˆ', icon: 'ğŸ‘‘', description: 'æ‹¥æœ‰3ä¸ªè¾¾åˆ°5çº§çš„æŠ€èƒ½', requirement: 3, current: 0, unlocked: false, reward: 500 }
                ]);

                // ==================== æ™ºèƒ½åˆ†ç±»é…ç½® ====================
                // æ ‡ç­¾å…³é”®è¯åˆ°åˆ†ç±»çš„æ˜ å°„è§„åˆ™ (å¯è‡ªç”±æ‰©å±•)
                const categoryRules = {
                    'bazi': ['å…«å­—', 'å‘½ç†', 'åç¥', 'å¹²æ”¯', 'äº”è¡Œ'],
                    'stock': ['è‚¡ç¥¨', 'å¤ç›˜', 'kçº¿', 'ç‚’è‚¡', 'å¤§ç›˜', 'Aè‚¡'],
                    'fitness': ['å¥èº«', 'è¿åŠ¨', 'è·‘æ­¥', 'æ’¸é“', 'å¢è‚Œ', 'å‡è„‚'],
                    'english': ['è‹±è¯­', 'å•è¯', 'é˜…è¯»', 'å¬åŠ›', 'å£è¯­', 'é›…æ€'],
                    'daily': ['æ¯æ—¥', 'æ—¥è®°', 'æ€»ç»“', 'åæ€', 'è®¡åˆ’'],
                    'work': ['å·¥ä½œ', 'é¡¹ç›®', 'ä»»åŠ¡', 'æ±‡æŠ¥', 'ä¼šè®®'],
                    'study': ['å­¦ä¹ ', 'è¯»ä¹¦', 'è¯¾ç¨‹', 'è€ƒè¯•', 'è®ºæ–‡']
                };

                // åˆ†ç±»æ˜¾ç¤ºåç§°æ˜ å°„
                const categoryDisplayNames = {
                    'all': 'å…¨éƒ¨',
                    'editor': 'å†™ç¬”è®°',
                    'bazi': 'å…«å­—å¤ç›˜',
                    'stock': 'è‚¡ç¥¨å¤ç›˜',
                    'fitness': 'å¥èº«è®°å½•',
                    'english': 'è‹±è¯­å­¦ä¹ ',
                    'daily': 'æ¯æ—¥å¤ç›˜',
                    'work': 'å·¥ä½œç¬”è®°',
                    'study': 'å­¦ä¹ ç¬”è®°'
                };

                // ==================== è®¡ç®—å±æ€§ ====================
                const totalXpEarned = computed(() => {
                    let total = player.value.xp;
                    skills.value.forEach(skill => total += skill.xp);
                    achievements.value.forEach(ach => {
                        if (ach.unlocked) total += ach.reward;
                    });
                    return total;
                });

                const totalSkills = computed(() => skills.value.length);
                const totalNotes = computed(() => notes.value.length);
                const completedAchievementsCount = computed(() => 
                    achievements.value.filter(a => a.unlocked).length
                );

                const filteredAchievements = computed(() => {
                    if (activeAchievementTab.value === 'all') return achievements.value;
                    return achievements.value.filter(a => a.category === activeAchievementTab.value);
                });

                // æ™ºèƒ½ç¬”è®°è¿‡æ»¤ï¼šæ”¯æŒåˆ†ç±»åŒ¹é…å’Œæ ‡ç­¾å…³é”®è¯åŒ¹é…
                const filteredNotes = computed(() => {
                    const activeTab = activeNoteTab.value;
                    if (activeTab === 'all') return notes.value;
                    if (activeTab === 'editor') return [];

                    return notes.value.filter(note => {
                        // 1. ç›´æ¥åˆ†ç±»åŒ¹é…
                        if (note.category === activeTab) return true;

                        // 2. æ ‡ç­¾å…³é”®è¯åŒ¹é…
                        const keywords = categoryRules[activeTab];
                        if (keywords && note.tags) {
                            return note.tags.some(tag => 
                                keywords.some(keyword => tag.toLowerCase().includes(keyword.toLowerCase()))
                            );
                        }
                        return false;
                    });
                });

                // ==================== GitHub API å‡½æ•° ====================
                const showStatusMessage = (text, type = 'info', duration = 5000) => {
                    statusMessage.value = { text, type };
                    if (duration > 0) {
                        setTimeout(() => {
                            statusMessage.value = null;
                        }, duration);
                    }
                };

                // åŠ è½½æ•°æ® (ä½¿ç”¨jsDelivr CDNåŠ é€Ÿ)
                const loadGameDataFromGitHub = async () => {
                    const { username, repo } = config.value;
                    if (!username || !repo) return;
                    
                    isLoading.value = true;
                    configError.value = '';
                    
                    try {
                        // ä¼˜å…ˆä½¿ç”¨jsDelivr CDNåŠ é€Ÿ
                        const cdnUrl = `https://cdn.jsdelivr.net/gh/${username}/${repo}/main/growth_data.json`;
                        // å¤‡ç”¨æºï¼šGitHub Raw
                        const rawUrl = `https://raw.githubusercontent.com/${username}/${repo}/main/growth_data.json`;
                        
                        let response;
                        try {
                            response = await fetch(cdnUrl, { timeout: 8000 });
                            if (!response.ok) throw new Error('CDN failed');
                            console.log('é€šè¿‡jsDelivr CDNåŠ è½½æ•°æ®');
                        } catch (cdnError) {
                            console.warn('CDNåŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°GitHub Raw', cdnError);
                            response = await fetch(rawUrl, { timeout: 15000 });
                            if (!response.ok) throw new Error('Raw failed: ' + response.status);
                            console.log('é€šè¿‡GitHub RawåŠ è½½æ•°æ®');
                        }
                        
                        const gameData = await response.json();
                        
                        // æ¢å¤æ•°æ®
                        if (gameData.player) player.value = gameData.player;
                        if (gameData.skills) skills.value = gameData.skills;
                        if (gameData.achievements) achievements.value = gameData.achievements;
                        if (gameData.notes) notes.value = gameData.notes;
                        
                        // ä»ç°æœ‰ç¬”è®°ä¸­æå–æ‰€æœ‰åˆ†ç±»ï¼Œæ›´æ–°åˆ†ç±»åˆ—è¡¨
                        updateNoteCategoriesFromNotes();
                        
                        lastSyncTime.value = new Date().toLocaleTimeString();
                        showStatusMessage('æ•°æ®åŠ è½½æˆåŠŸï¼', 'success');
                    } catch (error) {
                        console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                        configError.value = `åŠ è½½å¤±è´¥: ${error.message}`;
                        showStatusMessage(`åŠ è½½å¤±è´¥: ${error.message}ï¼Œè¯·æ£€æŸ¥é…ç½®æˆ–ç½‘ç»œ`, 'error');
                    } finally {
                        isLoading.value = false;
                    }
                };

                // ä¿å­˜æ•°æ®åˆ°GitHub
                const saveGameDataToGitHub = async () => {
                    if (isSaving.value) return;
                    if (!config.value.token) {
                        showStatusMessage('æœªæä¾›Tokenï¼Œæ— æ³•ä¿å­˜åˆ°GitHubã€‚è¯·åœ¨é…ç½®ä¸­è®¾ç½®Tokenã€‚', 'warning');
                        return;
                    }
                    
                    isSaving.value = true;
                    const { username, repo, token } = config.value;
                    
                    try {
                        // 1. è·å–æ–‡ä»¶SHAï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                        const getUrl = `https://api.github.com/repos/${username}/${repo}/contents/growth_data.json`;
                        let sha = null;
                        try {
                            const getRes = await fetch(getUrl, {
                                headers: { 'Authorization': `token ${token}` }
                            });
                            if (getRes.ok) {
                                const info = await getRes.json();
                                sha = info.sha;
                            }
                        } catch (e) { /* æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ */ }
                        
                        // 2. æ„å»ºè¦ä¿å­˜çš„æ•°æ®
                        const gameData = {
                            version: '4.0',
                            player: player.value,
                            skills: skills.value,
                            achievements: achievements.value,
                            notes: notes.value,
                            savedAt: new Date().toISOString()
                        };
                        
                        // 3. ç¼–ç å†…å®¹
                        const content = btoa(unescape(encodeURIComponent(JSON.stringify(gameData, null, 2))));
                        
                        // 4. æ¨é€æ›´æ–°
                        const updateUrl = `https://api.github.com/repos/${username}/${repo}/contents/growth_data.json`;
                        const updateRes = await fetch(updateUrl, {
                            method: 'PUT',
                            headers: {
                                'Accept': 'application/vnd.github.v3+json',
                                'Authorization': `token ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: `æˆé•¿ç³»ç»Ÿæ•°æ®æ›´æ–° @ ${new Date().toLocaleString()}`,
                                content: content,
                                sha: sha
                            })
                        });
                        
                        if (!updateRes.ok) {
                            const err = await updateRes.json().catch(() => ({}));
                            throw new Error(err.message || 'ä¿å­˜å¤±è´¥');
                        }
                        
                        lastSyncTime.value = new Date().toLocaleTimeString();
                        showStatusMessage('æ•°æ®å·²ä¿å­˜è‡³GitHubï¼', 'success');
                        console.log('ğŸ’¾ æ•°æ®å·²ä¿å­˜è‡³GitHubï¼');
                    } catch (error) {
                        console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                        showStatusMessage(`ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
                    } finally {
                        isSaving.value = false;
                    }
                };

                // ==================== é…ç½®ç®¡ç† ====================
                const saveConfigAndLoad = async () => {
                    configError.value = '';
                    if (!config.value.username || !config.value.repo) {
                        configError.value = 'è¯·å¡«å†™ç”¨æˆ·åå’Œä»“åº“åã€‚';
                        return;
                    }
                    
                    // ä¿å­˜é…ç½®åˆ°æœ¬åœ°ï¼ˆä»…ç”¨æˆ·åå’Œä»“åº“ï¼Œä¸å­˜Tokenï¼‰
                    localStorage.setItem('growth_system_config', JSON.stringify({
                        username: config.value.username,
                        repo: config.value.repo
                    }));
                    
                    isConfigured.value = true;
                    showConfig.value = false;
                    
                    // å°è¯•åŠ è½½æ•°æ®
                    await loadGameDataFromGitHub();
                };

                const loadDemoData = () => {
                    if (!confirm('åŠ è½½æ¼”ç¤ºæ•°æ®å°†æ›¿æ¢å½“å‰æ‰€æœ‰æ•°æ®ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ')) return;
                    
                    // æ¼”ç¤ºæ•°æ®
                    player.value = { level: 3, xp: 240, nextLevelXp: 500, streak: 7 };
                    skills.value = [
                        { id: 1, name: "å…«å­—å‘½ç†", icon: "ğŸŒŒ", category: "æ˜“å­¦", level: 2, xp: 80, maxXp: 200, xpPerPractice: 15, practiceCount: 12 },
                        { id: 2, name: "è‹±è¯­è¯æ±‡", icon: "ğŸ“˜", category: "è‹±è¯­", level: 3, xp: 180, maxXp: 300, xpPerPractice: 10, practiceCount: 25 },
                        { id: 3, name: "å¥èº«è®­ç»ƒ", icon: "ğŸ’ª", category: "å¥èº«", level: 4, xp: 320, maxXp: 400, xpPerPractice: 20, practiceCount: 18 }
                    ];
                    notes.value = [
                        { 
                            id: 1, 
                            title: "å…«å­—å…¥é—¨å¿ƒå¾—", 
                            content: "ä»Šå¤©å­¦ä¹ äº†å…«å­—çš„åŸºæœ¬æ’ç›˜æ–¹æ³•ã€‚\né‡ç‚¹ï¼šå­åˆå¯é…‰ä¸ºå››æ­£ï¼ŒåŠ›é‡æœ€å¼ºã€‚", 
                            tags: ["å…«å­—", "å…¥é—¨", "å¿ƒå¾—"], 
                            category: "bazi",
                            createdAt: new Date(Date.now() - 86400000).toISOString()
                        }
                    ];
                    
                    // æ›´æ–°åˆ†ç±»åˆ—è¡¨
                    updateNoteCategoriesFromNotes();
                    
                    isConfigured.value = true;
                    showConfig.value = false;
                    showStatusMessage('å·²åŠ è½½æ¼”ç¤ºæ•°æ®ï¼', 'success');
                };

                const openRepoInGitHub = () => {
                    window.open(`https://github.com/${config.value.username}/${config.value.repo}`, '_blank');
                };

                const forceLoadFromGitHub = async () => {
                    await loadGameDataFromGitHub();
                };

                // ==================== æ•°æ®å¯¼å…¥/å¯¼å‡º ====================
                const exportLocalData = () => {
                    const gameData = {
                        player: player.value,
                        skills: skills.value,
                        achievements: achievements.value,
                        notes: notes.value,
                        exportedAt: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(gameData, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `æˆé•¿ç³»ç»Ÿå¤‡ä»½_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    showStatusMessage('æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶', 'success');
                };

                const importLocalData = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (confirm("å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ")) {
                                if (importedData.player) player.value = importedData.player;
                                if (importedData.skills) skills.value = importedData.skills;
                                if (importedData.achievements) achievements.value = importedData.achievements;
                                if (importedData.notes) {
                                    notes.value = importedData.notes;
                                    updateNoteCategoriesFromNotes();
                                }
                                
                                await saveGameDataToGitHub();
                                showStatusMessage('æ•°æ®å¯¼å…¥æˆåŠŸï¼', 'success');
                            }
                        } catch (error) {
                            console.error(error);
                            showStatusMessage('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œå¯¼å…¥å¤±è´¥ã€‚', 'error');
                        }
                    };
                    reader.readAsText(file);
                    event.target.value = '';
                };

                // ==================== ç¬”è®°åˆ†ç±»ç®¡ç† ====================
                // æ ¹æ®æ ‡ç­¾æ™ºèƒ½åˆ¤æ–­åˆ†ç±»
                const determineCategoryFromTags = (tags) => {
                    for (const tag of tags) {
                        for (const [category, keywords] of Object.entries(categoryRules)) {
                            if (keywords.some(keyword => tag.toLowerCase().includes(keyword.toLowerCase()))) {
                                return category;
                            }
                        }
                    }
                    return 'general'; // é»˜è®¤åˆ†ç±»
                };

                // ä»ç°æœ‰ç¬”è®°ä¸­æå–æ‰€æœ‰åˆ†ç±»ï¼Œæ›´æ–°åˆ†ç±»åˆ—è¡¨
                const updateNoteCategoriesFromNotes = () => {
                    const categories = new Set(['all', 'editor']);
                    notes.value.forEach(note => {
                        if (note.category && note.category !== 'general' && note.category !== 'editor') {
                            categories.add(note.category);
                        }
                    });
                    noteCategories.value = Array.from(categories);
                };

                // è·å–åˆ†ç±»æ˜¾ç¤ºåç§°
                const getCategoryDisplayName = (cat) => {
                    return categoryDisplayNames[cat] || cat;
                };

                // ==================== ç¬”è®°ç³»ç»Ÿ ====================
                const handleImageUpload = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    if (!file.type.startsWith('image/')) {
                        showStatusMessage('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼', 'error');
                        return;
                    }
                    if (file.size > 2 * 1024 * 1024) {
                        showStatusMessage('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newNote.value.imageData = e.target.result;
                        showStatusMessage('å›¾ç‰‡å·²åŠ è½½', 'success');
                    };
                    reader.readAsDataURL(file);
                };

                const clearUploadedImage = () => {
                    newNote.value.imageData = null;
                };

                const handleImageError = (event) => {
                    event.target.style.display = 'none';
                };

                // ä¿å­˜ç¬”è®°ï¼ˆæ ¸å¿ƒï¼šæ™ºèƒ½åˆ†ç±»ï¼‰
                const saveNote = async () => {
                    if (!newNote.value.title.trim() || !newNote.value.content.trim()) {
                        showStatusMessage("è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹", "error");
                        return;
                    }

                    const tags = newNote.value.tagsInput
                        .split(',')
                        .map(tag => tag.trim())
                        .filter(tag => tag.length > 0);

                    // æ™ºèƒ½åˆ¤æ–­åˆ†ç±»
                    let finalCategory = 'general';
                    if (tags.length > 0) {
                        finalCategory = determineCategoryFromTags(tags);
                    }

                    // æ„å»ºç¬”è®°å¯¹è±¡
                    const noteToSave = {
                        id: Date.now(),
                        title: newNote.value.title,
                        content: newNote.value.content,
                        tags: tags,
                        category: finalCategory,
                        createdAt: new Date().toISOString()
                    };

                    // å¤„ç†å›¾ç‰‡
                    if (newNote.value.imageData) {
                        noteToSave.imageData = newNote.value.imageData;
                    }

                    // ä¿å­˜ç¬”è®°
                    notes.value.unshift(noteToSave);
                    
                    // å¦‚æœè¿™æ˜¯ä¸€ä¸ªæ–°åˆ†ç±»ï¼Œæ·»åŠ åˆ°åˆ†ç±»åˆ—è¡¨
                    if (!noteCategories.value.includes(finalCategory) && finalCategory !== 'general') {
                        noteCategories.value.push(finalCategory);
                        showStatusMessage(`å·²åˆ›å»ºæ–°åˆ†ç±»: ${getCategoryDisplayName(finalCategory)}`, 'success');
                    }

                    await saveGameDataToGitHub();
                    clearNoteEditor();
                    showStatusMessage(`ç¬”è®°ä¿å­˜æˆåŠŸï¼åˆ†ç±»: ${getCategoryDisplayName(finalCategory)}`, "success");
                };

                const clearNoteEditor = () => {
                    newNote.value = {
                        title: '', 
                        content: '', 
                        tagsInput: '', 
                        imageData: null,
                        category: 'general'
                    };
                };

                const deleteNote = async (noteId) => {
                    if (!confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ")) return;
                    notes.value = notes.value.filter(n => n.id !== noteId);
                    updateNoteCategoriesFromNotes(); // æ›´æ–°åˆ†ç±»åˆ—è¡¨
                    await saveGameDataToGitHub();
                    showStatusMessage('ç¬”è®°åˆ é™¤æˆåŠŸï¼', 'success');
                };

                const formatDate = (dateString) => {
                    const date = new Date(dateString);
                    return `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                };

                // ==================== æŠ€èƒ½ç³»ç»Ÿ ====================
                const getSkillXpPerPractice = (skill) => {
                    return skill.xpPerPractice || 10;
                };

                const addNewSkill = async () => {
                    const name = prompt("è¯·è¾“å…¥æ–°æŠ€èƒ½åç§°ï¼š", "ä¾‹å¦‚ï¼šPythonç¼–ç¨‹");
                    if (!name || !name.trim()) return;
                    
                    const category = prompt("é€‰æ‹©æŠ€èƒ½ç±»åˆ« (æ˜“å­¦/è‹±è¯­/å¥èº«/å†¥æƒ³/å…¶ä»–)ï¼š", "å…¶ä»–");
                    const icon = prompt("é€‰ä¸€ä¸ªè¡¨æƒ…å›¾æ ‡ï¼š", "ğŸŒŸ");
                    const xpPerPractice = parseInt(prompt("æ¯æ¬¡ç»ƒä¹ å¯è·å¾—å¤šå°‘ç»éªŒå€¼ï¼Ÿ", "10")) || 10;
                    
                    skills.value.push({
                        id: Date.now(),
                        name: name.trim(),
                        category: category || "å…¶ä»–",
                        icon: icon || "ğŸŒŸ",
                        level: 1,
                        xp: 0,
                        maxXp: 100,
                        xpPerPractice: xpPerPractice,
                        practiceCount: 0,
                        createdAt: new Date().toISOString()
                    });
                    
                    await saveGameDataToGitHub();
                    showStatusMessage('æŠ€èƒ½æ·»åŠ æˆåŠŸï¼', 'success');
                };

                const practiceSkill = async (skillId) => {
                    const skill = skills.value.find(s => s.id === skillId);
                    if (!skill) return;
                    
                    skill.xp += getSkillXpPerPractice(skill);
                    skill.practiceCount++;
                    player.value.xp += Math.floor(getSkillXpPerPractice(skill) * 0.5);
                    
                    if (skill.xp >= skill.maxXp) {
                        skill.level++;
                        skill.xp = 0;
                        skill.maxXp = Math.floor(skill.maxXp * 1.8);
                        showStatusMessage(`ğŸ¯ ã€${skill.name}ã€‘æå‡åˆ° ${skill.level} çº§ï¼`, 'success');
                    }
                    
                    checkLevelUp();
                    await saveGameDataToGitHub();
                };

                const deleteSkill = async (skillId) => {
                    if (!confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæŠ€èƒ½å—ï¼Ÿ")) return;
                    skills.value = skills.value.filter(s => s.id !== skillId);
                    await saveGameDataToGitHub();
                    showStatusMessage('æŠ€èƒ½åˆ é™¤æˆåŠŸ', 'success');
                };

                // ==================== æˆå°±ç³»ç»Ÿ ====================
                const updateAchievementProgress = (category, amount) => {
                    achievements.value.forEach(achievement => {
                        if (achievement.category === category && !achievement.unlocked) {
                            achievement.current += amount;
                            
                            if (achievement.current >= achievement.requirement) {
                                achievement.unlocked = true;
                                player.value.xp += achievement.reward;
                                showStatusMessage(`ğŸ† æˆå°±è§£é”ï¼šã€${achievement.name}ã€‘ï¼è·å¾— ${achievement.reward} XPï¼`, 'success');
                                checkLevelUp();
                            }
                        }
                    });
                };

                // ==================== æ¸¸æˆé€»è¾‘ ====================
                const calculateNextLevelXp = (level) => {
                    return Math.floor(100 * Math.pow(1.5, level - 1));
                };

                const checkLevelUp = () => {
                    while (player.value.xp >= player.value.nextLevelXp) {
                        player.value.level++;
                        player.value.xp -= player.value.nextLevelXp;
                        player.value.nextLevelXp = calculateNextLevelXp(player.value.level);
                        showStatusMessage(`ğŸ‰ å‡çº§ï¼ç°åœ¨æ˜¯ç­‰çº§ ${player.value.level}ï¼`, 'success');
                    }
                };

                const resetData = async () => {
                    if (!confirm("âš ï¸ é‡ç½®å°†æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ")) return;
                    
                    player.value = { level: 1, xp: 0, nextLevelXp: calculateNextLevelXp(1), streak: 1 };
                    skills.value = [];
                    notes.value = [];
                    noteCategories.value = ['all', 'editor', 'bazi', 'stock', 'fitness', 'english'];
                    achievements.value.forEach(ach => {
                        ach.current = 0;
                        ach.unlocked = false;
                    });
                    
                    if (config.value.token) {
                        await saveGameDataToGitHub();
                        showStatusMessage('æ•°æ®å·²é‡ç½®å¹¶åŒæ­¥åˆ°äº‘ç«¯', 'success');
                    } else {
                        showStatusMessage('æ•°æ®å·²é‡ç½®ï¼ˆæœ¬åœ°ï¼‰', 'success');
                    }
                };

                // ==================== åˆå§‹åŒ– ====================
                onMounted(() => {
                    const savedConfig = localStorage.getItem('growth_system_config');
                    if (savedConfig) {
                        try {
                            const { username, repo } = JSON.parse(savedConfig);
                            config.value.username = username;
                            config.value.repo = repo;
                            isConfigured.value = true;
                        } catch (e) {
                            console.log('æœ¬åœ°é…ç½®è¯»å–å¤±è´¥');
                        }
                    }
                    player.value.nextLevelXp = calculateNextLevelXp(player.value.level);
                });

                // ==================== æš´éœ²ç»™æ¨¡æ¿ ====================
                return {
                    isConfigured, showConfig, showImport, isSaving, isLoading, 
                    configError, lastSyncTime, statusMessage,
                    config, player, skills, achievements, notes, newNote,
                    activeAchievementTab, activeNoteTab, noteCategories,
                    
                    totalXpEarned, totalSkills, totalNotes, completedAchievementsCount,
                    filteredAchievements, filteredNotes,
                    
                    saveConfigAndLoad, loadDemoData, 
                    openRepoInGitHub, forceLoadFromGitHub,
                    exportLocalData, importLocalData,
                    
                    handleImageUpload, clearUploadedImage, handleImageError,
                    getCategoryDisplayName,
                    
                    getSkillXpPerPractice, addNewSkill, practiceSkill, deleteSkill,
                    saveNote, clearNoteEditor, deleteNote, formatDate, resetData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
