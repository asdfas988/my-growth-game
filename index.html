<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœï¸ æˆé•¿æ‰‹è´¦ | æ™ºèƒ½åŒæ­¥ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@braintree/sanitize-html@2.7.2/dist/sanitize-html.min.js"></script>
    
    <style>
        /* ====== æ‰‹ç»˜é£æ ¼å…¨å±€æ ·å¼ ====== */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            /* ä¼˜åŒ–å…¨å±€å­—ä½“ï¼Œå°†ä¸­æ–‡å­—ä½“ä¼˜å…ˆçº§æå‰ */
            font-family: 'Microsoft YaHei', 'SimHei', 'PingFang SC', sans-serif, 'Comic Neue', cursive;
            background: #fef9f3 url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffd6cc' fill-opacity='0.3' fill-rule='evenodd'/%3E%3C/svg%3E");
            min-height: 100vh;
            color: #5a4a42;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }

        /* ====== æ‰‹ç»˜æ ‡é¢˜ä¸å¯¼èˆª ====== */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: #fffaf0;
            border-radius: 24px 24px 48px 24px;
            color: #5a4a42;
            box-shadow: 8px 8px 0px #e0c9b8, 12px 12px 15px rgba(0, 0, 0, 0.05);
            border: 3px solid #5a4a42;
            position: relative;
        }
        .header::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 30px;
            width: 120px;
            height: 10px;
            background: #ff9a8b;
            border-radius: 5px;
            opacity: 0.7;
        }
        .header h1 {
            font-size: 3.2em;
            margin-bottom: 10px;
            font-family: 'Gochi Hand', cursive;
            color: #5a4a42;
            text-shadow: 3px 3px 0px #ffd6cc;
            letter-spacing: 1px;
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        /* ====== æ‰‹ç»˜ç½‘æ ¼å¸ƒå±€ ====== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        /* ====== æ‰‹ç»˜å¡ç‰‡è®¾è®¡ ====== */
        .card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 30px;
            box-shadow: 6px 6px 0px #d4b8a7, 10px 10px 20px rgba(0, 0, 0, 0.07);
            border: 2.5px solid #5a4a42;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
        }
        .card::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 1px dashed #ff9a8b;
            border-radius: 24px 10px 24px 10px;
            pointer-events: none;
            opacity: 0.6;
        }
        .card:hover {
            transform: translateY(-5px) rotate(0.5deg);
            box-shadow: 8px 8px 0px #c9a58f, 15px 15px 25px rgba(0, 0, 0, 0.09);
        }
        .card h2 {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px dotted #ff9a8b;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            color: #5a4a42;
            font-size: 1.6em;
            font-family: 'Gochi Hand', cursive;
        }

        /* ====== æ‰‹ç»˜ç©å®¶ç­‰çº§æ˜¾ç¤º ====== */
        .level-display {
            font-size: 5em;
            font-weight: 800;
            text-align: center;
            margin: 25px 0;
            font-family: 'Gochi Hand', cursive;
            color: #ff6b6b;
            text-shadow: 4px 4px 0px #ffd6cc, 8px 8px 8px rgba(0,0,0,0.1);
            letter-spacing: -2px;
            transform: rotate(-2deg);
        }
        .xp-progress {
            height: 26px;
            background: #ffe8d6;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid #5a4a42;
            box-shadow: inset 3px 3px 5px rgba(0,0,0,0.1);
        }
        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #a3de83);
            border-radius: 13px;
            transition: width 0.7s ease;
            box-shadow: inset 2px 2px 4px rgba(255,255,255,0.5);
        }

        /* ====== æ‰‹ç»˜ä»»åŠ¡ä¸æŠ€èƒ½é¡¹ ====== */
        .skill-item {
            padding: 20px;
            background: #fffaf5;
            border-radius: 16px 8px 16px 8px;
            margin: 16px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-left: 6px solid transparent;
            border: 2px solid #e0c9b8;
            position: relative;
        }
        .skill-item::before {
            content: 'â˜ï¸';
            position: absolute;
            top: -12px;
            right: 10px;
            font-size: 1.2em;
            opacity: 0.5;
        }
        .skill-item:hover {
            background: #fffef9;
            border-left-color: #ff9a8b;
            transform: translateX(5px);
        }
        .xp-badge {
            background: linear-gradient(45deg, #ff9a00, #ff5e00);
            color: white;
            padding: 6px 16px;
            border-radius: 20px 8px 20px 8px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
            border: 1px solid #fff;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        /* ====== æ‰‹ç»˜æŒ‰é’®æ ·å¼ ====== */
        .btn {
            background: linear-gradient(90deg, #ff9a8b, #ff6b6b);
            border: none;
            padding: 16px 32px;
            border-radius: 50px 15px 50px 15px;
            color: white;
            cursor: pointer;
            font-size: 17px;
            font-weight: 700;
            font-family: 'Comic Neue', cursive;
            transition: all 0.3s;
            display: block;
            width: 100%;
            margin-top: 20px;
            box-shadow: 4px 4px 0px #d45d5d;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        .btn:hover {
            transform: translateY(-3px) rotate(0.5deg);
            box-shadow: 6px 6px 0px #b84a4a;
        }
        .btn:active {
            transform: translateY(1px);
            box-shadow: 2px 2px 0px #d45d5d;
        }
        .btn-sm {
            padding: 10px 24px;
            font-size: 0.95em;
            width: auto;
            border-radius: 30px 8px 30px 8px;
            background: linear-gradient(90deg, #4ecdc4, #a3de83);
            box-shadow: 3px 3px 0px #2ba69b;
            border: none;
            color: white;
            font-weight: bold;
            font-family: 'Comic Neue', cursive;
            transition: all 0.3s;
        }
        .btn-sm:hover {
            transform: translateY(-2px);
            box-shadow: 4px 4px 0px #2ba69b;
        }

        /* ====== æ‰‹ç»˜é…ç½®é¢æ¿ ====== */
        .config-panel {
            max-width: 600px;
            margin: 40px auto;
        }
        .config-info {
            padding: 20px;
            background: #fff9f0;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 0.95em;
            border: 2px dashed #ffc8a3;
        }
        .config-info a {
            color: #ff6b6b;
            font-weight: bold;
            text-decoration: underline wavy;
        }

        /* ====== æ‰‹ç»˜ç¬”è®°ç³»ç»Ÿ ====== */
        .note-section {
            margin-top: 40px;
        }
        .note-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .note-tab {
            padding: 14px 32px;
            background: #fffaf5;
            border-radius: 40px 12px 40px 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            border: 2px solid #e0c9b8;
            font-family: 'Comic Neue', cursive;
            color: #5a4a42;
        }
        .note-tab.active {
            background: linear-gradient(90deg, #a3de83, #4ecdc4);
            color: white;
            border-color: #2ba69b;
            box-shadow: 4px 4px 0px #2ba69b;
            transform: rotate(-0.5deg);
        }
        .note-editor {
            background: #fffefc;
            border-radius: 20px 10px 20px 10px;
            padding: 30px;
            box-shadow: 6px 6px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            margin-bottom: 30px;
        }
        .note-input, .tag-input {
            width: 100%;
            padding: 18px;
            border: 2.5px solid #e0c9b8;
            border-radius: 15px 5px 15px 5px;
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
            margin-bottom: 25px;
            transition: all 0.3s;
            background: #fffaf9;
        }
        .note-input:focus, .tag-input:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
            background: #fff;
        }
        .note-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }
        .note-card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 30px;
            box-shadow: 6px 6px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            position: relative;
        }
        .note-card::before {
            content: 'ğŸ“Œ';
            position: absolute;
            top: -15px;
            right: 20px;
            font-size: 1.5em;
            transform: rotate(15deg);
        }
        .note-tags { display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0; }
        .note-tag {
            background: rgba(255, 154, 139, 0.15);
            color: #d45d5d;
            padding: 6px 14px;
            border-radius: 20px 8px 20px 8px;
            font-size: 0.9em;
            font-weight: 700;
            border: 1.5px dashed #ff9a8b;
        }
        .note-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 15px 5px 15px 5px;
            margin-top: 20px;
            box-shadow: 4px 4px 0px #d4b8a7;
            border: 2px solid #5a4a42;
            display: block;
        }

        /* ====== æ‰‹ç»˜å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ ====== */
        .image-upload-area {
            margin: 20px 0;
            padding: 25px;
            border: 3px dashed #ffc8a3;
            border-radius: 20px 8px 20px 8px;
            background: rgba(255, 248, 240, 0.7);
            text-align: center;
        }
        .image-preview { margin-top: 20px; }
        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 15px 5px 15px 5px;
            border: 3px solid #ff9a8b;
            box-shadow: 4px 4px 0px #ffd6cc;
        }

        /* ====== æ‰‹ç»˜çŠ¶æ€æç¤º ====== */
        .status-message {
            padding: 15px 25px;
            border-radius: 15px 5px 15px 5px;
            margin: 20px 0;
            font-weight: 700;
            border: 2.5px solid;
            font-family: 'Comic Neue', cursive;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.1);
        }
        .status-success {
            background: rgba(163, 222, 131, 0.95);
            color: #2d5a27;
            border-color: #2ba69b;
        }
        .status-error {
            background: rgba(255, 154, 139, 0.95);
            color: #7a2c28;
            border-color: #d45d5d;
        }
        .status-warning {
            background: rgba(255, 219, 153, 0.95);
            color: #8a5a29;
            border-color: #ffa94d;
        }

        /* ====== æ‰‹ç»˜ç»Ÿè®¡ä¿¡æ¯ ====== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            text-align: center;
            margin-top: 30px;
        }
        .stat-box {
            padding: 30px 20px;
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            box-shadow: 5px 5px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            transition: transform 0.3s;
        }
        .stat-box:hover {
            transform: translateY(-5px) rotate(0.5deg);
        }
        .stat-value {
            font-size: 3.2em;
            font-weight: 800;
            font-family: 'Gochi Hand', cursive;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            text-shadow: 2px 2px 0px #ffd6cc;
        }
        .stat-label {
            margin-top: 15px;
            font-size: 1.2em;
            color: #7a6a62;
            font-weight: 700;
            font-family: 'Comic Neue', cursive;
        }

        /* ====== åŠ è½½åŠ¨ç”» ====== */
        .loading-spinner {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 4px solid rgba(255, 154, 139, 0.3);
            border-radius: 50%;
            border-top-color: #ff6b6b;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ====== æˆå°±ç³»ç»Ÿæ‰‹ç»˜æ ·å¼ ====== */
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .achievement-card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 25px;
            box-shadow: 5px 5px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            position: relative;
            overflow: hidden;
        }
        .achievement-card.locked { 
            opacity: 0.7;
            filter: grayscale(0.3);
            background: #f5f1eb;
        }
        .achievement-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: rgba(255, 154, 139, 0.1);
            border-radius: 0 0 0 40px;
        }
        .achievement-icon {
            font-size: 3em;
            margin-bottom: 20px;
            text-align: center;
            transform: rotate(-3deg);
        }
        .achievement-progress {
            height: 12px;
            background: #ffe8d6;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            border: 1.5px solid #e0c9b8;
        }
        .achievement-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a8b, #ff6b6b);
            border-radius: 6px;
            transition: width 0.8s ease;
        }

        /* ====== æŠ˜å é¢æ¿æ ·å¼ ====== */
        .collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            color: #ff6b6b;
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #ff9a8b;
            background: #fffaf5;
            transition: all 0.3s;
            font-family: 'Comic Neue', cursive;
            font-weight: bold;
        }
        .collapse-btn:hover {
            background: #ff9a8b;
            color: white;
            transform: scale(1.05);
        }

        /* ====== ç¬”è®°ç­›é€‰å™¨æ ·å¼ ====== */
        .note-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
            padding: 20px;
            background: #fffaf5;
            border-radius: 15px;
            border: 2px solid #e0c9b8;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }
        .filter-group label {
            font-weight: bold;
            color: #5a4a42;
            font-family: 'Comic Neue', cursive;
        }
        .filter-group select, .filter-group input {
            padding: 12px 15px;
            border: 2px solid #e0c9b8;
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
            background: #fffefc;
            color: #5a4a42;
        }
        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 2px 2px 0px #ffd6cc;
        }

        /* ====== æ‰¹é‡æ·»åŠ æˆå°±é¢æ¿æ ·å¼ ====== */
        .batch-add-panel {
            background: #fff9f0;
            border: 3px dashed #ffc8a3;
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
        }
        .batch-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0c9b8;
            border-radius: 15px;
            font-family: 'Comic Neue', cursive;
            font-size: 14px;
            background: #fffefc;
            color: #5a4a42;
            margin-bottom: 15px;
            resize: vertical;
        }
        .batch-textarea:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
        }
        .batch-example {
            font-size: 0.9em;
            color: #7a6a62;
            background: #fffaf5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #4ecdc4;
        }

        /* ====== å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ ·å¼ ====== */
        .rich-text-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            padding: 15px;
            background: #fffaf5;
            border-radius: 15px;
            border: 2px solid #e0c9b8;
            align-items: center;
        }
        .toolbar-btn {
            padding: 8px 16px;
            background: #fffefc;
            border: 2px solid #e0c9b8;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            color: #5a4a42;
            transition: all 0.2s;
            font-family: 'Comic Neue', cursive;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .toolbar-btn:hover {
            background: #ffd6cc;
            border-color: #ff9a8b;
            transform: translateY(-2px);
        }
        .toolbar-btn.active {
            background: #ff9a8b;
            color: white;
            border-color: #ff6b6b;
        }
        .color-picker {
            width: 30px;
            height: 30px;
            padding: 0;
            border: 2px solid #e0c9b8;
            border-radius: 6px;
            cursor: pointer;
        }
        .font-size-select {
            padding: 6px 10px;
            border: 2px solid #e0c9b8;
            border-radius: 8px;
            background: #fffefc;
            font-family: 'Comic Neue', cursive;
            color: #5a4a42;
        }

        /* ==================================================
        æ ¸å¿ƒä¿®å¤åŒºåŸŸï¼šè§£å†³ä¹±ç å’Œè¾“å…¥æ–¹å‘é—®é¢˜
        ================================================== */
        .rich-text-editor {
            min-height: 300px;
            padding: 20px;
            border: 2.5px solid #e0c9b8;
            border-radius: 15px 5px 15px 5px;
            background: #fffaf9;
            /* FIX 1: ä¼˜åŒ–ä¸­æ–‡å­—ä½“å †æ ˆï¼Œè§£å†³â€œä¹±ç â€ï¼ˆæ˜¾ç¤ºå¼‚å¸¸ï¼‰é—®é¢˜ */
            font-family: 'Microsoft YaHei', 'SimHei', 'PingFang SC', sans-serif, 'Comic Neue', cursive;
            font-size: 16px;
            line-height: 1.6;
            color: #5a4a42;
            outline: none;
            overflow-y: auto;
            margin-bottom: 25px;
            /* FIX 2: å¼ºåˆ¶è®¾ç½®ä¸ºä»å·¦å¾€å³ï¼ˆLTRï¼‰ï¼Œè§£å†³è¾“å…¥æ–¹å‘é”™è¯¯é—®é¢˜ */
            direction: ltr !important; 
            text-align: left !important; 
            unicode-bidi: embed !important;
        }
        .rich-text-editor:focus {
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
        }
        .rich-text-editor b, .rich-text-editor strong { 
            color: #ff6b6b; 
            font-weight: 800;
        }
        .rich-text-editor i, .rich-text-editor em { 
            color: #4ecdc4; 
            font-style: italic; 
        }
        .rich-text-editor u { 
            text-decoration: underline; 
            text-decoration-color: #ff9a8b;
        }
        .rich-text-editor .highlight {
            background: #ffd6cc;
            padding: 2px 4px;
            border-radius: 4px;
            box-shadow: 1px 1px 0px #ff9a8b;
            border: 1px dotted #ff6b6b;
            font-weight: bold;
        }
        /* ä¿æŒä»£ç å—æ ·å¼ */
        .rich-text-editor pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #4ecdc4;
            overflow-x: auto;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .rich-text-editor .code-block {
            margin: 15px 0;
            border: 2px dashed #4ecdc4;
            border-radius: 12px;
            padding: 5px;
        }
        .rich-text-editor .code-block pre {
            margin: 0;
        }
        /* ... å…¶ä»–æ ·å¼ ... */

        /* ====== æ€ç»´å¯¼å›¾æ ·å¼ ====== */
        .mindmap-container {
            position: relative;
            min-height: 500px;
            border: 2px solid #e0c9b8;
            border-radius: 15px;
            background: #fffefc;
            overflow: hidden;
            touch-action: none;
            cursor: grab;
            margin-top: 20px;
        }
        .mindmap-node {
            position: absolute;
            padding: 15px 25px;
            background: #fffaf5;
            border-radius: 20px 8px 20px 8px;
            border: 2.5px solid #5a4a42;
            box-shadow: 3px 3px 0px #d4b8a7;
            cursor: pointer;
            transition: box-shadow 0.1s;
            font-weight: bold;
            max-width: 250px;
            word-wrap: break-word;
            z-index: 10;
        }
        .mindmap-node:hover {
            box-shadow: 5px 5px 0px #ff9a8b;
        }
        .mindmap-node.selected {
            box-shadow: 0 0 0 3px #ff6b6b, 3px 3px 0px #d4b8a7 !important;
        }
        .mindmap-root {
            background: linear-gradient(135deg, #ff9a8b, #ff6b6b) !important;
            color: white;
            border-color: #d45d5d !important;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5), 5px 5px 0px #d45d5d;
        }

        /* ====== è¯»ä¹¦ç¬”è®°æ ·å¼ ====== */
        .book-note-card {
            background: #fffefc;
            border-radius: 20px 8px 20px 8px;
            padding: 30px;
            box-shadow: 6px 6px 0px #d4b8a7;
            border: 2.5px solid #5a4a42;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .book-note-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #ffc8a3;
        }
        .book-icon {
            font-size: 2.5em;
            margin-right: 15px;
            transform: rotate(-5deg);
        }
        .book-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #ff6b6b;
            font-family: 'Gochi Hand', cursive;
            line-height: 1.2;
        }
        .book-author {
            font-size: 0.9em;
            color: #7a6a62;
            margin-top: 5px;
        }
        .rating-stars {
            color: #ffc844;
            font-size: 1.5em;
            margin-bottom: 15px;
            display: flex;
            gap: 5px;
        }
        .rating-stars .star {
            opacity: 0.3;
            transition: color 0.2s, opacity 0.2s;
        }
        .rating-stars .star.filled {
            opacity: 1;
        }
        .book-note-content, .book-reflection {
            background: #fffaf5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 4px solid #4ecdc4;
            font-size: 0.95em;
            color: #5a4a42;
            word-break: break-all;
        }
        .book-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .book-tag {
            background: rgba(78, 205, 196, 0.15);
            color: #2ba69b;
            padding: 6px 14px;
            border-radius: 20px 8px 20px 8px;
            font-size: 0.8em;
            font-weight: 700;
            border: 1.5px dashed #4ecdc4;
        }
        .book-note-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #e0c9b8;
            font-size: 0.85em;
            color: #7a6a62;
        }

        /* ====== Wordé¢„è§ˆæ¨¡å¼æ ·å¼ ====== */
        .word-view-page {
            max-width: 800px;
            margin: 40px auto;
            padding: 40px;
            min-height: 1100px;
            background: white;
            border: 1px solid #e0c9b8;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            /* æ¨¡æ‹Ÿæ‰‹ç¨¿çº¸å¼ æ•ˆæœ */
            background-image: repeating-linear-gradient(white, white 24px, #ffb347 25px, #ffb347 26px, white 27px), repeating-linear-gradient(90deg, #e0c9b8, #e0c9b8 1px, white 2px, white 4px );
            font-family: 'Times New Roman', 'Microsoft YaHei', serif;
            color: #5a4a42;
        }
        .word-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px double #e0c9b8;
        }
        .word-content {
            font-size: 16px;
            line-height: 1.8;
            font-family: 'Times New Roman', 'Microsoft YaHei', serif;
        }
        .word-page-number {
            position: absolute;
            bottom: 20px;
            right: 40px;
            color: #7a6a62;
            font-size: 0.9em;
        }

        /* ====== ä»£ç å—æ ·å¼ (for word view) ====== */
        .code-block pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #4ecdc4;
            overflow-x: auto;
            font-family: Consolas, Monaco, monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.4;
        }
        .code-block .keyword { color: #cc66ff; font-weight: bold; }
        .code-block .function { color: #0077b6; }
        .code-block .comment { color: #808080; font-style: italic; }
        .code-block .variable { color: #ff8c00; }
        .code-block .string { color: #3cb371; }
        .code-block .number { color: #00bcd4; }
        .code-block .operator { color: #ff6b6b; }
        
        /* ====== è¯»ä¹¦ç¬”è®°æœç´¢æ¡†æ ·å¼ ====== */
        .book-search-input {
            width: 100%;
            padding: 15px;
            border: 2.5px solid #e0c9b8;
            border-radius: 15px 5px 15px 5px;
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
            background: #fffaf9;
        }
        .book-search-input:focus {
            outline: none;
            border-color: #ff9a8b;
            box-shadow: 3px 3px 0px #ffd6cc;
        }
        .book-stats {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            padding: 20px;
            background: #fffaf5;
            border-radius: 15px;
            border: 2px solid #e0c9b8;
            justify-content: center;
            flex-wrap: wrap;
        }
        .book-stat-item {
            text-align: center;
            padding: 15px 25px;
            background: white;
            border-radius: 12px;
            border: 2px solid #ffc8a3;
            min-width: 120px;
        }
        .book-stat-value {
            font-size: 2em;
            font-weight: 800;
            color: #ff6b6b;
            font-family: 'Gochi Hand', cursive;
        }
        .book-stat-label {
            font-size: 0.9em;
            color: #7a6a62;
            margin-top: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <div v-if="!isConfigured" class="config-panel">
            <div class="card">
                <h2>âœï¸ è®¾ç½®ä½ çš„æ‰‹è´¦åŒæ­¥</h2>
                <div class="config-info">
                    <p><strong>å‡†å¤‡äº‹é¡¹ï¼š</strong></p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>ä¸€ä¸ªGitHubè´¦å·</li>
                        <li>ä¸€ä¸ª<strong>ç§æœ‰ä»“åº“</strong>å­˜æ”¾æ•°æ®</li>
                        <li>ä¸€ä¸ªæœ‰ <code>repo</code> æƒé™çš„<strong>è®¿é—®ä»¤ç‰Œ</strong> <br> (<a href="https://github.com/settings/tokens" target="_blank" style="font-size:0.9em;">ç‚¹å‡»è¿™é‡Œç”ŸæˆToken</a>)</li>
                    </ol>
                    <p style="margin-top: 15px;">**æ³¨æ„ï¼š** æ•°æ®æ–‡ä»¶ä¼šå­˜æ”¾åœ¨ä»“åº“çš„ <code>/game_data.json</code> è·¯å¾„ã€‚</p>
                </div>

                <input type="text" class="note-input" v-model="config.owner" placeholder="GitHub ç”¨æˆ·å (Owner)...">
                <input type="text" class="note-input" v-model="config.repo" placeholder="GitHub ä»“åº“å (Repo)...">
                <input type="password" class="note-input" v-model="config.token" placeholder="GitHub Access Token (GHP Token)...">

                <button class="btn" @click="saveConfig" :disabled="!isConfigValid">
                    {{ isSavingConfig ? 'åŒæ­¥ä¸­...' : 'ğŸš€ ä¿å­˜å¹¶å¼€å§‹åŒæ­¥' }}
                    <span v-if="isSavingConfig" class="loading-spinner"></span>
                </button>
                <div style="text-align: center; margin-top: 15px; color: #7a6a62; font-size: 0.9em;">
                    <a href="javascript:void(0)" @click="loadDemoData" style="color: #4ecdc4; text-decoration: underline;">æˆ–åŠ è½½æ¼”ç¤ºæ•°æ®</a>
                </div>
            </div>
        </div>

        <div v-else>
            <div class="header">
                <h1>âœï¸ æˆé•¿æ‰‹è´¦ | {{ player.level }} çº§å†’é™©è€…</h1>
                <p>
                    æ¬¢è¿å›æ¥ï¼Œ{{ config.owner }}ï¼å½“å‰æ•°æ®å·²åŒæ­¥è‡³ï¼š{{ config.owner }}/{{ config.repo }} 
                </p>
                <p style="font-size: 0.9em; margin-top: 8px; opacity: 0.8;">
                    Token: {{ config.token ? 'å·²è®¾ç½® (' + config.token.substring(0, 8) + '...)' : 'æœªè®¾ç½®' }}
                </p>

                <div style="display: flex; gap: 10px; margin-top: 25px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn-sm" @click="openRepoInGitHub" style="background:linear-gradient(90deg, #4a9fff, #2d73cc);">ğŸ“‚ æ‰“å¼€ä»“åº“</button>
                    <button class="btn-sm" @click="exportLocalData" style="background:linear-gradient(90deg, #a3de83, #4ecdc4);">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
                    <button class="btn-sm" @click="showImport=!showImport" style="background:linear-gradient(90deg, #ffd166, #ffb347); color:#5a4a42;">ğŸ“‚ å¯¼å…¥æ•°æ®</button>
                    <button class="btn-sm" @click="isConfigured=false" style="background:#f0e6dc; color:#5a4a42; border:2px solid #e0c9b8;">âš™ï¸ é‡æ–°é…ç½®</button>
                </div>

                <div v-if="showImport" class="config-info" style="margin-top: 20px;">
                    <p style="font-weight: bold; margin-bottom: 10px;">å¯¼å…¥æœ¬åœ°å¤‡ä»½æ•°æ® (.jsonæ–‡ä»¶)</p>
                    <input type="file" @change="importLocalData" accept=".json" style="padding: 10px; border: 1px dashed #ff9a8b; border-radius: 8px;">
                </div>
            </div>

            <div v-if="statusMessage" :class="['status-message', `status-${statusMessage.type}`]">
                {{ statusMessage.text }}
            </div>

            <div class="card" style="margin-bottom: 40px;">
                <h2>ğŸ“Š å†’é™©è€…æ¦‚è§ˆ</h2>
                <div class="level-display">Lvl {{ player.level }}</div>
                <div style="text-align: center; font-weight: bold; color: #7a6a62;">
                    {{ player.xp }} / {{ player.nextLevelXp }} XP (è·ç¦»ä¸‹ä¸€çº§è¿˜æœ‰ {{ player.nextLevelXp - player.xp }} XP)
                </div>
                <div class="xp-progress">
                    <div class="xp-fill" :style="{ width: xpPercentage + '%' }"></div>
                </div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">ğŸ”¥</div>
                        <div class="stat-label">è¿ç»­æ‰“å¡</div>
                        <div class="stat-value" style="font-size: 2.5em;">{{ player.streak }}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">ğŸ’ª</div>
                        <div class="stat-label">æŠ€èƒ½æ•°é‡</div>
                        <div class="stat-value" style="font-size: 2.5em;">{{ skills.length }}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">ğŸ“</div>
                        <div class="stat-label">ç¬”è®°æ€»æ•°</div>
                        <div class="stat-value" style="font-size: 2.5em;">{{ notes.length }}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">ğŸ“š</div>
                        <div class="stat-label">é˜…è¯»ç¬”è®°</div>
                        <div class="stat-value" style="font-size: 2.5em;">{{ bookNotes.length }}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">ğŸ·ï¸</div>
                        <div class="stat-label">ç¬”è®°æ ‡ç­¾</div>
                        <div class="stat-value" style="font-size: 2.5em;">{{ totalNoteTags }}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">ğŸŒŸ</div>
                        <div class="stat-label">å·²è§£é”æˆå°±</div>
                        <div class="stat-value" style="font-size: 2.5em;">{{ unlockedAchievements.length }}</div>
                    </div>
                </div>
                <button class="btn" @click="saveGameDataToGitHub" :disabled="isSaving" style="width: auto; margin: 25px auto 0;">
                    {{ isSaving ? 'åŒæ­¥ä¸­...' : 'ğŸ’¾ æ‰‹åŠ¨åŒæ­¥åˆ°GitHub' }}
                    <span v-if="isSaving" class="loading-spinner" style="margin-left: 10px;"></span>
                </button>
            </div>

            <div class="card" style="margin-bottom: 40px;">
                <h2>
                    ğŸ’ª æŠ€èƒ½æ ‘ä¸ä»»åŠ¡
                    <button class="collapse-btn" @click="collapseSkills = !collapseSkills">
                        {{ collapseSkills ? 'å±•å¼€' : 'æŠ˜å ' }}
                    </button>
                </h2>
                <div v-show="!collapseSkills">
                    <div class="skill-item" v-for="skill in skills" :key="skill.id">
                        <div>
                            <strong>{{ skill.icon }} {{ skill.name }}</strong> (Lvl {{ skill.level }})
                            <div style="font-size: 0.9em; color: #7a6a62; margin-top: 5px;">
                                {{ skill.xp }} / {{ skill.maxXp }} XP
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="xp-badge">+{{ skill.xpPerPractice }} XP</span>
                            <button class="btn-sm" @click="practiceSkill(skill.id)">æ‰“å¡</button>
                            <button class="btn-sm" @click="deleteSkill(skill.id)" style="background: linear-gradient(90deg, #d45d5d, #ff7b6b);">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div v-if="skills.length === 0" style="text-align: center; padding: 20px; color: #7a6a62;">æš‚æ— æŠ€èƒ½ï¼Œå¿«æ·»åŠ ä¸€ä¸ªå§ï¼</div>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed #e0c9b8;">
                        <input type="text" class="note-input" v-model="newSkillName" placeholder="æ–°æŠ€èƒ½åç§°...">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; align-items: center;">
                            <input type="text" class="tag-input" v-model="newSkillIcon" placeholder="å›¾æ ‡ (å¦‚: ğŸ“š)..." style="width: 150px; margin: 0;">
                            <input type="number" class="tag-input" v-model.number="newSkillXp" placeholder="æ¯æ¬¡XP..." style="width: 150px; margin: 0;">
                            <input type="text" class="tag-input" v-model="newSkillCategory" placeholder="åˆ†ç±» (å¦‚: å­¦ä¹ )..." style="width: 150px; margin: 0;">
                            <input type="number" class="tag-input" v-model.number="newSkillMaxXp" placeholder="å‡çº§æ‰€éœ€XP..." style="width: 180px; margin: 0;">
                        </div>
                        <button class="btn" @click="addNewSkill" style="width: auto; padding: 14px 45px;">
                            â• æ·»åŠ æ–°æŠ€èƒ½
                        </button>
                    </div>
                </div>
            </div>

            <div class="note-section card">
                <h2>ğŸ“ ç¬”è®°ä¸è®°å½•</h2>
                <div class="note-tabs">
                    <div class="note-tab" :class="{active: activeNoteTab === 'all'}" @click="activeNoteTab = 'all'">ğŸ“‚ å…¨éƒ¨ç¬”è®°</div>
                    <div class="note-tab" :class="{active: activeNoteTab === 'editor'}" @click="activeNoteTab = 'editor'">âœï¸ å¯Œæ–‡æœ¬ç¼–è¾‘</div>
                    <div class="note-tab" :class="{active: activeNoteTab === 'mindmap'}" @click="activeNoteTab = 'mindmap'">ğŸ§  æ€ç»´å¯¼å›¾</div>
                    <div class="note-tab" :class="{active: activeNoteTab === 'highlights'}" @click="activeNoteTab = 'highlights'">ğŸŒŸ é«˜äº®æå–</div>
                    <div class="note-tab" :class="{active: activeNoteTab === 'wordview'}" @click="activeNoteTab = 'wordview'">ğŸ“„ Wordé¢„è§ˆ</div>
                    <div v-for="cat in noteCategories.filter(c => c !== 'all' && c !== 'editor' && c !== 'mindmap' && c !== 'highlights' && c !== 'wordview')" :key="cat" class="note-tab" :class="{active: activeNoteTab === cat}" @click="activeNoteTab = cat">
                        {{ getCategoryDisplayName(cat) }}
                    </div>
                </div>

                <div v-if="activeNoteTab === 'editor'" class="note-editor">
                    <input type="text" class="note-input" v-model="newNote.title" placeholder="ç¬”è®°æ ‡é¢˜...">

                    <div class="rich-text-toolbar">
                        <button class="toolbar-btn" @click="formatText('bold')" :class="{active: activeFormat === 'bold'}">
                            <strong>B</strong> åŠ ç²—
                        </button>
                        <button class="toolbar-btn" @click="formatText('italic')" :class="{active: activeFormat === 'italic'}">
                            <em>I</em> æ–œä½“
                        </button>
                        <button class="toolbar-btn" @click="formatText('underline')" :class="{active: activeFormat === 'underline'}">
                            <u>U</u> ä¸‹åˆ’çº¿
                        </button>
                        <button class="toolbar-btn" @click="formatText('highlight')" :class="{active: activeFormat === 'highlight'}">
                            <span style="background:#ffd6cc; padding:2px 5px;">ğŸ“</span> é«˜äº®
                        </button>
                        <button class="toolbar-btn" @click="formatText('insertCodeBlock')">
                            <span style="font-family: monospace;">&lt; / &gt;</span> ä»£ç å—
                        </button>
                        <button class="toolbar-btn" @click="clearFormatting">
                            âŒ æ¸…é™¤æ ¼å¼
                        </button>

                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label style="font-weight: bold; color: #5a4a42; font-family: 'Comic Neue', cursive;">é¢œè‰²:</label>
                            <input type="color" class="color-picker" v-model="selectedColor" @change="formatText('foreColor', selectedColor)">
                        </div>
                        <select class="font-size-select" v-model="selectedFontSize" @change="formatText('fontSize', selectedFontSize)">
                            <option value="4">å°</option>
                            <option value="5">ä¸­</option>
                            <option value="6">å¤§</option>
                            <option value="7">ç‰¹å¤§</option>
                        </select>
                        <select class="font-size-select" v-model="newNote.category">
                            <option value="general">é€šç”¨</option>
                            <option v-for="cat in noteCategories.filter(c => c !== 'all' && c !== 'editor' && c !== 'mindmap' && c !== 'highlights' && c !== 'wordview')" :value="cat" :key="cat">
                                {{ getCategoryDisplayName(cat) }}
                            </option>
                        </select>
                    </div>

                    <div 
                        class="rich-text-editor" 
                        ref="richTextEditor"
                        contenteditable="true" 
                        @input="updateRichTextContent"
                        @focus="activeFormat = null"
                        v-html="newNote.content"
                        >
                    </div>

                    <input type="text" class="tag-input" v-model="newNote.tagsInput" placeholder="æ ‡ç­¾ (ç”¨é€—å·åˆ†éš”)...">
                    
                    <div class="image-upload-area">
                        <input type="file" accept="image/*" @change="handleImageUpload">
                        <p style="margin-top: 10px; font-size: 0.9em; color: #7a6a62;">ï¼ˆå¯é€‰ï¼‰ä¸Šä¼ å›¾ç‰‡ä½œä¸ºç¬”è®°é™„ä»¶ (æœ€å¤§ 2MB)</p>
                        <div v-if="newNote.imageData" class="image-preview">
                            <img :src="newNote.imageData" alt="é¢„è§ˆå›¾ç‰‡">
                            <button class="btn-sm" @click="clearUploadedImage" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d); margin-top: 10px;">
                                ğŸ—‘ï¸ åˆ é™¤å›¾ç‰‡
                            </button>
                        </div>
                    </div>

                    <div style="display:flex; gap:15px; margin-top:25px; flex-wrap: wrap;">
                        <button class="btn" @click="saveRichTextNote" style="width:auto; padding:14px 45px; border-radius:50px 15px 50px 15px;">
                            ğŸ’¾ ä¿å­˜å¯Œæ–‡æœ¬ç¬”è®°
                        </button>
                        <button class="btn" @click="clearNoteEditor" style="width:auto; padding:14px 35px; background:linear-gradient(90deg, #a3a3a3, #7a7a7a); border-radius:50px 15px 50px 15px;">
                            æ¸…ç©ºé‡å†™
                        </button>
                        <button class="btn" @click="previewNote" style="width:auto; padding:14px 35px; background:linear-gradient(90deg, #4a9fff, #2d73cc); border-radius:50px 15px 50px 15px;">
                            ğŸ‘ï¸ é¢„è§ˆæ•ˆæœ
                        </button>
                    </div>
                </div>

                <div v-if="activeNoteTab === 'mindmap'" class="note-editor">
                    <h3 style="margin-bottom:20px; color:#5a4a42; font-family:'Gochi Hand';">ğŸ§  åˆ›å»ºæ€ç»´å¯¼å›¾</h3>
                    <div class="mindmap-controls">
                        <input type="text" v-model="mindmapNodeText" class="mindmap-input" placeholder="è¾“å…¥èŠ‚ç‚¹å†…å®¹..." @keyup.enter="addMindmapNode" >
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                            <button class="btn-sm" @click="addMindmapNode" style="background:linear-gradient(90deg, #a3de83, #4ecdc4);"> â• æ·»åŠ èŠ‚ç‚¹ </button>
                            <button class="btn-sm" @click="selectMindmapNode(null)" :style="{background: mindmapSelectedNode === null ? '#ff9a8b' : 'linear-gradient(90deg, #4a9fff, #2d73cc)'}"> ğŸ¯ {{ mindmapSelectedNode === null ? 'é€‰æ‹©æ ¹èŠ‚ç‚¹' : 'å–æ¶ˆé€‰æ‹©' }} </button>
                            <button class="btn-sm" @click="toggleRootNode" :disabled="!mindmapSelectedNode"> ğŸ‘‘ è®¾ä¸ºæ ¹èŠ‚ç‚¹ </button>
                            <button class="btn-sm" @click="removeMindmapNode" :disabled="!mindmapSelectedNode" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d);"> ğŸ—‘ï¸ åˆ é™¤èŠ‚ç‚¹ </button>
                            <button class="btn-sm" @click="clearMindmap" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d);"> ğŸ§¹ æ¸…ç©º </button>
                            <button class="btn-sm" @click="loadSampleMindmap" style="background:linear-gradient(90deg, #ffd166, #ffb347); color:#5a4a42;"> ğŸ’¡ ç¤ºä¾‹ </button>
                            <button class="btn-sm" @click="saveMindmapAsNote" style="background:linear-gradient(90deg, #ff9a8b, #ff6b6b);"> ğŸ’¾ ä¿å­˜ä¸ºç¬”è®° </button>
                        </div>
                    </div>
                    
                    <div class="mindmap-container" ref="mindmapContainer" 
                        @mousemove="handleNodeDrag" 
                        @mouseup="endNodeDrag" 
                        @mouseleave="endNodeDrag"
                        @dblclick="addNodeAtPosition"
                    >
                        <div v-for="node in mindmapNodes" :key="node.id" class="mindmap-node"
                            :style="{ left: node.x + 'px', top: node.y + 'px', 
                                border: mindmapRootNode === node.id ? '2.5px solid #d45d5d' : '2.5px solid #5a4a42',
                                background: mindmapRootNode === node.id ? 'linear-gradient(135deg, #ff9a8b, #ff6b6b)' : '#fffaf5',
                                color: mindmapRootNode === node.id ? 'white' : '#5a4a42',
                                boxShadow: mindmapSelectedNode === node.id ? '0 0 10px #ff6b6b' : '3px 3px 0px #d4b8a7' }"
                            @mousedown="startNodeDrag(node, $event)"
                            @dblclick="editMindmapNodeById(node.id)"
                            @click="selectMindmapNode(node.id)"
                        >
                            {{ node.text }}
                            <div v-if="mindmapRootNode === node.id" style="position: absolute; top: -5px; right: -5px; font-size: 12px; background: #ffd166; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;">ğŸ‘‘</div>
                        </div>

                        <svg width="100%" height="100%" style="position:absolute; top:0; left:0; pointer-events:none;">
                            <line v-for="(line, index) in mindmapLines" :key="index"
                                :x1="line.x1" :y1="line.y1" :x2="line.x2" :y2="line.y2"
                                :stroke="line.type === 'parent-child' ? '#4ecdc4' : '#ff9a8b'" 
                                stroke-width="2" 
                                :stroke-dasharray="line.type === 'parent-child' ? 'none' : '5,5'" 
                            />
                        </svg>
                    </div>

                    <div style="margin-top:20px; padding:15px; background:#fffaf5; border-radius:10px; border: 2px dashed #ffc8a3;">
                        <p style="font-weight:bold; color:#5a4a42; margin-bottom:10px;">ğŸ’¡ ä½¿ç”¨æç¤ºï¼š</p>
                        <ul style="color:#7a6a62; font-size:0.9em; margin-left: 20px;">
                            <li>ç‚¹å‡»èŠ‚ç‚¹é€‰æ‹©å®ƒï¼Œç„¶åæ·»åŠ æ–°èŠ‚ç‚¹ä¼šæˆä¸ºå…¶å­èŠ‚ç‚¹</li>
                            <li>åŒå‡»èŠ‚ç‚¹å¯ä»¥ç¼–è¾‘å†…å®¹</li>
                            <li>æ‹–åŠ¨èŠ‚ç‚¹å¯ä»¥é‡æ–°å¸ƒå±€</li>
                            <li>ç‚¹å‡»"è®¾ä¸ºæ ¹èŠ‚ç‚¹"è®¾ç½®ä¸­å¿ƒèŠ‚ç‚¹</li>
                            <li>ç»¿è‰²çº¿è¡¨ç¤ºçˆ¶å­å…³ç³»ï¼Œæ©™è‰²çº¿è¡¨ç¤ºè¿æ¥åˆ°æ ¹èŠ‚ç‚¹</li>
                            <li>**åŒå‡»å¯¼å›¾ç©ºç™½å¤„**å¯ä»¥åœ¨ç‚¹å‡»ä½ç½®æ·»åŠ æ–°èŠ‚ç‚¹</li>
                        </ul>
                    </div>
                </div>

                <div v-if="activeNoteTab === 'highlights'" class="note-editor">
                    <h3 style="margin-bottom:20px; color:#5a4a42; font-family:'Gochi Hand';">ğŸŒŸ é«˜äº®å†…å®¹æå–å™¨</h3>
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                        <label style="font-weight: bold;">ä»ç¬”è®°ä¸­æå–:</label>
                        <select class="font-size-select" v-model="highlightSourceNote" style="min-width: 250px;">
                            <option :value="null" disabled>é€‰æ‹©æºç¬”è®°...</option>
                            <option v-for="note in notes.filter(n => hasHighlights(n))" :value="note.id" :key="note.id">
                                {{ note.title }}
                            </option>
                        </select>
                        <button class="btn-sm" @click="extractHighlights" style="background:linear-gradient(90deg, #ff9a8b, #ff6b6b);">
                            æå–é«˜äº®
                        </button>
                    </div>
                    
                    <div v-if="extractedHighlights.length > 0">
                        <h4 style="margin-top: 20px; color: #5a4a42;">å·²æå–çš„é«˜äº® ({{ extractedHighlights.length }} æ¡)</h4>
                        <div style="border: 2px dashed #ffc8a3; padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <div v-for="(highlight, index) in extractedHighlights" :key="index" style="margin-bottom: 10px; padding: 10px; background: #fffaf5; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <div v-html="highlight.content" style="flex-grow: 1; margin-right: 15px;"></div>
                                <button class="btn-sm" @click="copyHighlight(highlight.content)" style="background:linear-gradient(90deg, #4ecdc4, #a3de83); font-size: 0.8em; padding: 5px 10px;">å¤åˆ¶</button>
                                <button class="btn-sm" @click="removeHighlight(index)" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d); font-size: 0.8em; padding: 5px 10px; margin-left: 5px;">ç§»é™¤</button>
                            </div>
                        </div>

                        <div style="margin-top: 20px;">
                            <input type="text" class="note-input" v-model="newNoteTitleFromHighlights" placeholder="æ–°ç¬”è®°æ ‡é¢˜...">
                            <textarea class="batch-textarea" v-model="newNoteFromHighlights" placeholder="æå–å†…å®¹æ±‡æ€»..." style="min-height: 150px;"></textarea>
                            <button class="btn" @click="saveHighlightsNote" style="width: auto; padding: 14px 45px; background:linear-gradient(90deg, #4a9fff, #2d73cc);">
                                ğŸ“ åˆ›å»ºæ–°ç¬”è®°
                            </button>
                        </div>
                    </div>
                    <div v-else style="text-align:center; padding:40px 20px; color:#c9b8a7;">
                        <div style="font-size:3.5em; margin-bottom:15px; transform:rotate(5deg);">âœ¨</div>
                        <p style="font-weight:bold; font-size:1.2em;">é€‰æ‹©ç¬”è®°å¹¶ç‚¹å‡»æå–</p>
                        <p>å°†ç¬”è®°ä¸­æ‰€æœ‰åŠ ç²—ã€é«˜äº®ã€æ–œä½“ç­‰å†…å®¹å¿«é€Ÿæå–å‡ºæ¥</p>
                    </div>
                </div>

                <div v-if="activeNoteTab === 'wordview'" class="note-editor">
                    <h3 style="margin-bottom:20px; color:#5a4a42; font-family:'Gochi Hand';">ğŸ“„ Wordæ–‡æ¡£é¢„è§ˆ</h3>
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                        <label style="font-weight: bold;">é€‰æ‹©è¦é¢„è§ˆçš„ç¬”è®°:</label>
                        <select class="font-size-select" v-model="selectedNoteForPreview" style="min-width: 250px;">
                            <option :value="null" disabled>é€‰æ‹©æºç¬”è®°...</option>
                            <option v-for="note in notes" :value="note.id" :key="note.id">
                                {{ note.title }}
                            </option>
                        </select>
                        <button class="btn-sm" @click="printPreview" :disabled="!selectedNoteForPreview" style="background:linear-gradient(90deg, #4ecdc4, #a3de83);">
                            ğŸ–¨ï¸ æ‰“å°é¢„è§ˆ
                        </button>
                    </div>
                    
                    <div v-if="selectedNoteForPreview" class="word-view-page">
                        <div class="word-header">
                            <h1 style="font-family: 'Times New Roman', 'Microsoft YaHei', serif; font-size: 2.2em;">{{ getNoteById(selectedNoteForPreview).title }}</h1>
                            <div style="font-size: 0.9em; color: #7a6a62;">
                                ğŸ“… åˆ›å»ºæ—¥æœŸ: {{ formatDate(getNoteById(selectedNoteForPreview).createdAt) }}
                            </div>
                        </div>
                        <div class="note-tags" style="justify-content: center; margin-bottom: 30px;">
                            <span class="note-tag" v-for="tag in getNoteById(selectedNoteForPreview).tags" :key="tag" style="background: rgba(230, 230, 250, 0.5); color: #5a4a42; border: 1px dashed #d4b8a7;">{{ tag }}</span>
                        </div>
                        <div class="word-content" v-html="getNoteById(selectedNoteForPreview).content"></div>
                        <div class="word-page-number"> ç¬¬ 1 é¡µ </div>
                    </div>
                    <div v-else style="text-align:center; padding:40px 20px; color:#c9b8a7;">
                        <div style="font-size:3.5em; margin-bottom:15px; transform:rotate(-5deg);">ğŸ“„</div>
                        <p style="font-weight:bold; font-size:1.2em;">é€‰æ‹©ç¬”è®°ä»¥é¢„è§ˆ</p>
                        <p>ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªç¬”è®°æŸ¥çœ‹Wordå¼æ–‡æ¡£æ•ˆæœ</p>
                    </div>
                </div>


                <div v-if="!['editor', 'mindmap', 'highlights', 'wordview'].includes(activeNoteTab)" class="note-list">
                    <div class="note-filters">
                        <div class="filter-group">
                            <label>æŒ‰æ ‡ç­¾æœç´¢</label>
                            <input type="text" v-model="noteFilter.tag" placeholder="è¾“å…¥æ ‡ç­¾...">
                        </div>
                        <div class="filter-group">
                            <label>æŒ‰æ ‡é¢˜/å†…å®¹æœç´¢</label>
                            <input type="text" v-model="noteFilter.text" placeholder="è¾“å…¥å…³é”®è¯...">
                        </div>
                        <div class="filter-group">
                            <label>æ’åºæ–¹å¼</label>
                            <select v-model="noteFilter.sortBy">
                                <option value="newest">æœ€æ–°åˆ›å»º</option>
                                <option value="oldest">æœ€æ—©åˆ›å»º</option>
                                <option value="title">æŒ‰æ ‡é¢˜</option>
                            </select>
                        </div>
                        <button class="btn-sm" @click="resetNoteFilters" style="align-self: flex-end; background: #a3a3a3;">
                            é‡ç½®ç­›é€‰
                        </button>
                    </div>

                    <div v-for="note in filteredAndSortedNotes" :key="note.id" class="note-card">
                        <h3 style="margin-bottom:18px; color:#5a4a42; font-family:'Gochi Hand'; font-size:1.6em;">{{ note.title }}</h3>
                        <div class="note-tags">
                            <span class="note-tag" v-for="tag in note.tags" :key="tag">{{ tag }}</span>
                        </div>
                        
                        <div class="note-content-rich" v-html="sanitizeHtml(note.content)" 
                            style="color:#5a4a42; line-height:1.7; margin:25px 0; white-space: pre-line; max-height: 200px; overflow: hidden; position: relative;"
                        >
                            <div style="position: absolute; bottom: 0; width: 100%; height: 50px; background: linear-gradient(to top, #fffefc, rgba(255, 254, 252, 0));"></div>
                        </div>

                        <div v-if="note.imageData || note.imageUrl" style="margin-top:25px; text-align: center;">
                            <img :src="note.imageData || note.imageUrl" alt="ç¬”è®°å›¾ç‰‡" class="note-image" @error="handleImageError">
                        </div>

                        <div style="display:flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px dashed #e0c9b8;">
                            <div style="font-size: 0.85em; color: #7a6a62;">
                                ğŸ“… {{ formatDate(note.createdAt) }}
                            </div>
                            <div class="book-actions">
                                <button class="btn-sm" @click="editNote(note.id)" style="background:linear-gradient(90deg, #4a9fff, #2d73cc); margin-right: 10px;">ç¼–è¾‘</button>
                                <button class="btn-sm" @click="deleteNote(note.id)" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d);">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                    <div v-if="notes.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7a6a62;">è¿˜æ²¡æœ‰ä»»ä½•ç¬”è®°å“¦ï¼</div>
                    <div v-if="notes.length > 0 && filteredAndSortedNotes.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7a6a62;">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç¬”è®°ã€‚</div>
                </div>

                <div v-if="activeNoteTab === 'bookNotes'" style="margin-top: 20px;">
                    <button class="btn" @click="showBookForm = true" style="width: auto; padding: 14px 45px; margin-bottom: 25px;">
                        ğŸ“š æ’°å†™è¯»ä¹¦ç¬”è®°
                    </button>

                    <div v-if="showBookForm" class="note-editor">
                        <h3 style="margin-bottom:20px; color:#ff6b6b; font-family:'Gochi Hand';">
                            {{ editingBookNote ? 'âœï¸ ç¼–è¾‘è¯»ä¹¦ç¬”è®°' : 'âœï¸ æ–°å¢è¯»ä¹¦ç¬”è®°' }}
                        </h3>
                        <input type="text" class="note-input" v-model="newBookNote.title" placeholder="ä¹¦å/ç¯‡å...">
                        <input type="text" class="note-input" v-model="newBookNote.author" placeholder="ä½œè€…/æ¥æº...">
                        
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; font-weight: bold; margin-bottom: 10px;">æˆ‘çš„è¯„åˆ†:</label>
                            <div class="rating-stars" style="justify-content: flex-start;">
                                <span v-for="star in 5" :key="star" class="star" 
                                    :class="{filled: star <= newBookNote.rating}" 
                                    @click="newBookNote.rating = star"
                                >
                                    â˜…
                                </span>
                            </div>
                        </div>

                        <textarea class="batch-textarea" v-model="newBookNote.note" placeholder="ç¬”è®°æ‘˜è¦ (æ”¯æŒç®€å• HTML æ ¼å¼)..." style="min-height: 100px; margin-bottom: 25px;"></textarea>
                        <textarea class="batch-textarea" v-model="newBookNote.reflection" placeholder="æˆ‘çš„æ„Ÿæ‚Ÿä¸åæ€ (æ”¯æŒç®€å• HTML æ ¼å¼)..." style="min-height: 100px; margin-bottom: 25px;"></textarea>
                        
                        <input type="text" class="tag-input" v-model="newBookNote.tagsInput" placeholder="æ ‡ç­¾ (ç”¨é€—å·åˆ†éš”)..." @keyup.enter="saveBookNote">

                        <div style="display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap;">
                            <button class="btn" @click="saveBookNote" style="width: auto; padding: 14px 45px;">
                                ğŸ’¾ {{ editingBookNote ? 'æ›´æ–°' : 'ä¿å­˜' }}ç¬”è®°
                            </button>
                            <button class="btn" @click="cancelBookNote" style="width: auto; padding: 14px 35px; background:linear-gradient(90deg, #a3a3a3, #7a7a7a);">
                                å–æ¶ˆ
                            </button>
                        </div>
                    </div>

                    <h3 style="margin-top: 40px; margin-bottom: 20px; color:#5a4a42; font-family:'Gochi Hand'; font-size: 1.8em; border-bottom: 3px dotted #ff9a8b; padding-bottom: 10px;">
                        ğŸ“š é˜…è¯»è®°å½• (å…± {{ bookNotes.length }} æ¡)
                    </h3>
                    <div style="margin-bottom: 25px;">
                        <input type="text" class="book-search-input" v-model="bookFilterText" placeholder="æœç´¢ä¹¦åã€ä½œè€…æˆ–æ ‡ç­¾...">
                    </div>
                    <div class="book-stats">
                        <div class="book-stat-item">
                            <div class="book-stat-value">ğŸ“–</div>
                            <div class="book-stat-label">æ€»ç¬”è®°æ•°</div>
                            <div class="book-stat-value" style="font-size: 1.5em; color: #4ecdc4;">{{ bookNotes.length }}</div>
                        </div>
                        <div class="book-stat-item">
                            <div class="book-stat-value">â­</div>
                            <div class="book-stat-label">å¹³å‡è¯„åˆ†</div>
                            <div class="book-stat-value" style="font-size: 1.5em; color: #ff9a8b;">{{ averageBookRating.toFixed(1) }}</div>
                        </div>
                        <div class="book-stat-item">
                            <div class="book-stat-value">ğŸ·ï¸</div>
                            <div class="book-stat-label">æ ‡ç­¾æ€»æ•°</div>
                            <div class="book-stat-value" style="font-size: 1.5em; color: #ffd166;">{{ totalBookTags }}</div>
                        </div>
                    </div>

                    <div class="note-list" style="margin-top: 30px;">
                        <div v-for="book in filteredBookNotes" :key="book.id" class="book-note-card">
                            <div>
                                <div class="book-note-header">
                                    <div class="book-icon"> ğŸ“š </div>
                                    <div class="book-info">
                                        <div class="book-title">{{ book.title }}</div>
                                        <div class="book-author">ä½œè€…: {{ book.author }}</div>
                                    </div>
                                </div>
                                <div class="rating-stars" style="justify-content:flex-start;">
                                    <span v-for="star in 5" :key="star" class="star" :class="{filled: star <= book.rating}" > â˜… </span>
                                </div>
                                <div class="book-note-content">
                                    <strong style="color:#5a4a42; display:block; margin-bottom:10px;">ğŸ“ ç¬”è®°æ‘˜è¦:</strong>
                                    <div v-html="sanitizeHtml(book.note)" style="max-height:80px; overflow:hidden; text-overflow:ellipsis; color:#7a6a62;"></div>
                                </div>
                                <div class="book-reflection">
                                    <strong style="color:#5a4a42; display:block; margin-bottom:10px;">ğŸ’­ æˆ‘çš„æ„Ÿæ‚Ÿ:</strong>
                                    <div v-html="sanitizeHtml(book.reflection)" style="max-height:80px; overflow:hidden; text-overflow:ellipsis; color:#7a6a62;"></div>
                                </div>
                            </div>
                            
                            <div class="book-tags" v-if="book.tags && book.tags.length > 0">
                                <span v-for="tag in book.tags.slice(0, 3)" :key="tag" class="book-tag" > {{ tag }} </span>
                                <span v-if="book.tags.length > 3" class="book-tag"> +{{ book.tags.length - 3 }} </span>
                            </div>

                            <div class="book-note-footer">
                                <div class="book-date"> ğŸ“… {{ formatDate(book.createdAt) }} </div>
                                <div class="book-actions">
                                    <button class="btn-sm" @click="editBookNote(book.id)" style="background:linear-gradient(90deg, #4a9fff, #2d73cc); padding: 8px 18px;">ç¼–è¾‘</button>
                                    <button class="btn-sm" @click="deleteBookNote(book.id)" style="background:linear-gradient(90deg, #ff7b6b, #d45d5d); padding: 8px 18px;">åˆ é™¤</button>
                                </div>
                            </div>
                        </div>
                        <div v-if="bookNotes.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7a6a62;">è¿˜æ²¡æœ‰è¯»ä¹¦ç¬”è®°å“¦ï¼</div>
                        <div v-if="bookNotes.length > 0 && filteredBookNotes.length === 0" style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7a6a62;">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæœç´¢æ¡ä»¶çš„è¯»ä¹¦ç¬”è®°ã€‚</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>
                    ğŸŒŸ æˆå°±æ®¿å ‚ ({{ unlockedAchievements.length }} / {{ achievements.length }})
                    <button class="collapse-btn" @click="collapseAchievements = !collapseAchievements">
                        {{ collapseAchievements ? 'å±•å¼€' : 'æŠ˜å ' }}
                    </button>
                </h2>
                <div v-show="!collapseAchievements">
                    <div style="margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn-sm" @click="activeAchievementTab = 'all'" :style="{ background: activeAchievementTab === 'all' ? '#ff9a8b' : '#fffaf5', color: activeAchievementTab === 'all' ? 'white' : '#5a4a42', border: activeAchievementTab === 'all' ? '2px solid #ff6b6b' : '2px solid #e0c9b8' }">å…¨éƒ¨</button>
                        <button class="btn-sm" @click="activeAchievementTab = 'unlocked'" :style="{ background: activeAchievementTab === 'unlocked' ? '#ff9a8b' : '#fffaf5', color: activeAchievementTab === 'unlocked' ? 'white' : '#5a4a42', border: activeAchievementTab === 'unlocked' ? '2px solid #ff6b6b' : '2px solid #e0c9b8' }">å·²è§£é”</button>
                        <button class="btn-sm" @click="activeAchievementTab = 'locked'" :style="{ background: activeAchievementTab === 'locked' ? '#ff9a8b' : '#fffaf5', color: activeAchievementTab === 'locked' ? 'white' : '#5a4a42', border: activeAchievementTab === 'locked' ? '2px solid #ff6b6b' : '2px solid #e0c9b8' }">æœªè§£é”</button>
                        <button class="btn-sm" @click="showBatchAdd = !showBatchAdd" :style="{ background: showBatchAdd ? 'linear-gradient(90deg, #4a9fff, #2d73cc)' : '#fffaf5', color: showBatchAdd ? 'white' : '#5a4a42', border: showBatchAdd ? '2px solid #2d73cc' : '2px solid #e0c9b8' }">æ‰¹é‡æ·»åŠ </button>
                        <button class="btn-sm" @click="loadExampleAchievements" style="background: linear-gradient(90deg, #ffd166, #ffb347); color:#5a4a42;">åŠ è½½ç¤ºä¾‹æˆå°±</button>
                    </div>

                    <div v-if="showBatchAdd" class="batch-add-panel">
                        <h4 style="margin-bottom: 15px; font-weight: bold; color: #ff6b6b;">æ‰¹é‡æ·»åŠ æˆå°±</h4>
                        <textarea v-model="batchAchievementInput" class="batch-textarea" placeholder="æ ¼å¼ï¼š[å›¾æ ‡] åç§° | æè¿° | ç›®æ ‡å€¼ | å¥–åŠ±XP (æ¯è¡Œä¸€ä¸ªæˆå°±)"></textarea>
                        <div class="batch-example">
                            <strong>ç¤ºä¾‹:</strong><br>
                            ğŸ’¡ çµæ„Ÿä¹ç° | è®°å½• 10 æ¡ç¬”è®° | 10 | 50<br>
                            ğŸ‹ï¸ å¥èº«è¾¾äºº | å¥èº«æŠ€èƒ½ç­‰çº§è¾¾åˆ° 5 çº§ | 5 | 100
                        </div>
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn-sm" @click="addBatchAchievements" style="background:linear-gradient(90deg, #4ecdc4, #a3de83);">
                                æ‰¹é‡æ·»åŠ å¹¶ä¿å­˜
                            </button>
                            <button class="btn-sm" @click="clearBatchInput" style="background:linear-gradient(90deg, #a3a3a3, #7a7a7a);">
                                æ¸…ç©ºè¾“å…¥
                            </button>
                        </div>
                    </div>

                    <div class="achievement-grid">
                        <div v-for="achievement in filteredAchievements" :key="achievement.id" 
                            :class="['achievement-card', { locked: !achievement.unlocked }]"
                        >
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <h3 style="font-size: 1.2em; font-weight: bold;">{{ achievement.name }}</h3>
                                <div style="text-align: right;">
                                    <span class="xp-badge" style="background: linear-gradient(45deg, #ff9a8b, #ff6b6b);">+{{ achievement.xpReward }} XP</span>
                                    <div style="font-size: 0.8em; color: #7a6a62; margin-top: 5px;">
                                        {{ achievement.category }}
                                    </div>
                                </div>
                            </div>

                            <div class="achievement-icon">
                                {{ achievement.icon }}
                            </div>

                            <p style="font-size: 0.9em; color: #7a6a62; margin-bottom: 15px;">
                                {{ achievement.description }}
                            </p>

                            <div class="achievement-progress">
                                <div class="achievement-progress-fill" :style="{ width: achievement.progressPercentage + '%' }"></div>
                            </div>
                            <div style="font-size: 0.85em; text-align: right; color: #5a4a42; font-weight: bold;">
                                è¿›åº¦: {{ achievement.currentProgress }} / {{ achievement.targetValue }}
                            </div>

                            <div style="position: absolute; bottom: 10px; left: 15px; font-size: 0.9em; font-weight: bold; color: #4ecdc4;" v-if="achievement.unlocked">
                                âœ… å·²è§£é”
                            </div>
                            <div style="position: absolute; bottom: 10px; left: 15px; font-size: 0.9em; font-weight: bold; color: #d45d5d;" v-else>
                                ğŸ”’ æœªè§£é”
                            </div>

                            <button class="btn-sm" @click="deleteAchievement(achievement.id)" style="position: absolute; bottom: 10px; right: 15px; background:linear-gradient(90deg, #d45d5d, #ff7b6b); padding: 5px 10px; font-size: 0.8em;">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn" @click="resetData" style="width: auto; margin: 40px auto; background:linear-gradient(90deg, #a3a3a3, #7a7a7a);">
                âš ï¸ æ¸…ç©ºæ‰€æœ‰æœ¬åœ°æ•°æ®
            </button>
        </div>

        </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;

        const categoryDisplayNames = {
            'bazi': 'ğŸŒŒ å…«å­—å‘½ç†',
            'fitness': 'ğŸ’ª å¥èº«è®­ç»ƒ',
            'study': 'ğŸ“š å­¦ä¹ å¿ƒå¾—',
            'general': 'é€šç”¨ç¬”è®°',
            'bookNotes': 'ğŸ“– è¯»ä¹¦ç¬”è®°',
        };

        createApp({
            setup() {
                // ==================== çŠ¶æ€ç®¡ç† ====================
                const config = ref({ owner: '', repo: '', token: '' });
                const isConfigured = ref(false);
                const isSaving = ref(false);
                const isSavingConfig = ref(false);
                const statusMessage = ref(null);
                const showImport = ref(false);
                
                const player = ref({ level: 1, xp: 0, nextLevelXp: 100, streak: 1 });
                const skills = ref([]);
                const notes = ref([]);
                const achievements = ref([]);
                const bookNotes = ref([]);

                const activeAchievementTab = ref('all');
                const activeNoteTab = ref('editor');
                const noteCategories = ref(['all', 'editor', 'mindmap', 'highlights', 'wordview', 'bookNotes']);
                const newNote = ref({ title: '', content: '', tagsInput: '', imageData: null, category: 'general' });
                const richTextEditor = ref(null);
                const activeFormat = ref(null);
                const selectedColor = ref('#ff6b6b');
                const selectedFontSize = ref('5');
                const editingNoteId = ref(null);
                
                // æ–°å¢ï¼šæŠ˜å çŠ¶æ€
                const collapseStatus = ref(false);
                const collapseSkills = ref(false);
                const collapseAchievements = ref(false);
                const collapseNotes = ref(false);
                
                // æŠ€èƒ½
                const newSkillName = ref('');
                const newSkillIcon = ref('âœ¨');
                const newSkillXp = ref(10);
                const newSkillMaxXp = ref(100);
                const newSkillCategory = ref('general');

                // ç¬”è®°ç­›é€‰
                const noteFilter = ref({ tag: '', text: '', sortBy: 'newest' });

                // æ€ç»´å¯¼å›¾
                const mindmapNodes = ref([]);
                const mindmapNodeText = ref('');
                const mindmapContainer = ref(null);
                const mindmapSelectedNode = ref(null);
                const mindmapRootNode = ref(null);
                const draggingNode = ref(null);
                const dragOffset = ref({ x: 0, y: 0 });

                // é«˜äº®æå–
                const highlightSourceNote = ref(null);
                const extractedHighlights = ref([]);
                const newNoteTitleFromHighlights = ref('');
                const newNoteFromHighlights = ref('');

                // Wordé¢„è§ˆ
                const selectedNoteForPreview = ref(null);

                // æ‰¹é‡æ·»åŠ æˆå°±
                const showBatchAdd = ref(false);
                const batchAchievementInput = ref('');

                // è¯»ä¹¦ç¬”è®°
                const showBookForm = ref(false);
                const editingBookNote = ref(null);
                const bookFilterText = ref('');
                const newBookNote = ref({
                    title: '',
                    author: '',
                    rating: 0,
                    note: '',
                    reflection: '',
                    tagsInput: '',
                    createdAt: null
                });

                // ==================== Computed Properties ====================
                const isConfigValid = computed(() => {
                    return config.value.owner.trim() && config.value.repo.trim() && config.value.token.trim();
                });

                const xpPercentage = computed(() => {
                    return Math.min(100, (player.value.xp / player.value.nextLevelXp) * 100);
                });

                const filteredSkills = computed(() => {
                    // No filters needed yet, but keeping the structure for future use
                    return skills.value;
                });

                const filteredAchievements = computed(() => {
                    return achievements.value.filter(ach => {
                        if (activeAchievementTab.value === 'unlocked') {
                            return ach.unlocked;
                        }
                        if (activeAchievementTab.value === 'locked') {
                            return !ach.unlocked;
                        }
                        return true;
                    });
                });

                const unlockedAchievements = computed(() => {
                    return achievements.value.filter(ach => ach.unlocked);
                });

                const filteredAndSortedNotes = computed(() => {
                    let filtered = notes.value.filter(note => {
                        // Category filter
                        if (activeNoteTab.value !== 'all' && note.category !== activeNoteTab.value) {
                            return false;
                        }
                        
                        // Tag filter
                        if (noteFilter.value.tag.trim()) {
                            const searchTags = noteFilter.value.tag.split(',').map(t => t.trim()).filter(t => t);
                            if (!searchTags.some(t => note.tags.includes(t))) {
                                return false;
                            }
                        }

                        // Text filter
                        if (noteFilter.value.text.trim()) {
                            const search = noteFilter.value.text.toLowerCase();
                            const content = note.content ? note.content.toLowerCase() : '';
                            const title = note.title ? note.title.toLowerCase() : '';
                            if (!content.includes(search) && !title.includes(search)) {
                                return false;
                            }
                        }

                        return true;
                    });

                    // Sorting
                    filtered.sort((a, b) => {
                        const dateA = new Date(a.createdAt).getTime();
                        const dateB = new Date(b.createdAt).getTime();
                        if (noteFilter.value.sortBy === 'newest') {
                            return dateB - dateA;
                        } else if (noteFilter.value.sortBy === 'oldest') {
                            return dateA - dateB;
                        } else if (noteFilter.value.sortBy === 'title') {
                            return a.title.localeCompare(b.title);
                        }
                        return 0;
                    });

                    return filtered;
                });

                const filteredBookNotes = computed(() => {
                    if (!bookFilterText.value.trim()) return bookNotes.value;

                    const search = bookFilterText.value.toLowerCase();
                    return bookNotes.value.filter(book => {
                        const tags = book.tags ? book.tags.map(t => t.toLowerCase()).join(' ') : '';
                        return book.title.toLowerCase().includes(search) ||
                               book.author.toLowerCase().includes(search) ||
                               tags.includes(search);
                    });
                });

                const averageBookRating = computed(() => {
                    if (bookNotes.value.length === 0) return 0;
                    const total = bookNotes.value.reduce((sum, book) => sum + book.rating, 0);
                    return total / bookNotes.value.length;
                });

                const totalNoteTags = computed(() => {
                    const allTags = new Set();
                    notes.value.forEach(note => {
                        if (note.tags && Array.isArray(note.tags)) {
                            note.tags.forEach(tag => allTags.add(tag));
                        }
                    });
                    return allTags.size;
                });

                const totalBookTags = computed(() => {
                    const allTags = new Set();
                    bookNotes.value.forEach(book => {
                        if (book.tags && Array.isArray(book.tags)) {
                            book.tags.forEach(tag => allTags.add(tag));
                        }
                    });
                    return allTags.size;
                });

                const mindmapLines = computed(() => {
                    const lines = [];
                    const container = mindmapContainer.value;
                    if (!container) return [];

                    const containerRect = container.getBoundingClientRect();

                    const getNodePosition = (nodeId) => {
                        const node = mindmapNodes.value.find(n => n.id === nodeId);
                        if (!node) return null;
                        
                        // è·å–èŠ‚ç‚¹ä¸­å¿ƒç‚¹ç›¸å¯¹äºå®¹å™¨çš„ä½ç½®
                        const nodeEl = container.querySelector(`.mindmap-node[data-id="${nodeId}"]`);
                        if (nodeEl) {
                            const rect = nodeEl.getBoundingClientRect();
                            return {
                                x: rect.left + rect.width / 2 - containerRect.left,
                                y: rect.top + rect.height / 2 - containerRect.top
                            };
                        }
                        return { x: node.x + 125, y: node.y + 35 }; // é»˜è®¤ä¸­å¿ƒç‚¹
                    };

                    mindmapNodes.value.forEach(node => {
                        const currentPos = getNodePosition(node.id);
                        if (!currentPos) return;

                        if (node.parentId) {
                            const parentPos = getNodePosition(node.parentId);
                            if (parentPos) {
                                lines.push({
                                    x1: currentPos.x, y1: currentPos.y,
                                    x2: parentPos.x, y2: parentPos.y,
                                    type: 'parent-child'
                                });
                            }
                        }

                        if (mindmapRootNode.value && node.id !== mindmapRootNode.value && !node.parentId) {
                            const rootPos = getNodePosition(mindmapRootNode.value);
                            if (rootPos) {
                                lines.push({
                                    x1: currentPos.x, y1: currentPos.y,
                                    x2: rootPos.x, y2: rootPos.y,
                                    type: 'to-root'
                                });
                            }
                        }
                    });

                    return lines;
                });

                // ==================== è¾…åŠ©å‡½æ•° ====================
                const showStatusMessage = (text, type = 'info', duration = 5000) => {
                    statusMessage.value = { text, type };
                    if (duration > 0) {
                        setTimeout(() => {
                            statusMessage.value = null;
                        }, duration);
                    }
                };

                const getCategoryDisplayName = (cat) => {
                    return categoryDisplayNames[cat] || cat;
                };

                // HTMLå®‰å…¨è¿‡æ»¤
                const sanitizeHtml = (html) => {
                    if (!html) return '';

                    const clean = sanitizeHtmlLib(html, {
                        allowedTags: [ 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'a', 'ul', 'ol', 'li', 'blockquote', 'strong', 'em', 'b', 'i', 'u', 'mark', 'span', 'div', 'pre', 'code', 'img'],
                        allowedAttributes: {
                            'a': ['href', 'target'],
                            'img': ['src', 'alt', 'style', 'class'],
                            'span': ['style', 'class'],
                            'div': ['style', 'class'],
                            'p': ['style', 'class'],
                            '*': ['style', 'class', 'data-id']
                        },
                        allowedSchemes: ['http', 'https', 'mailto', 'data']
                    });

                    // Vue åœ¨æ¸²æŸ“ v-html æ—¶ä¼šè¿›è¡Œå®‰å…¨å¤„ç†ï¼Œä½†è¿™é‡Œä¸ºäº†ç¡®ä¿é¢„è§ˆå’Œå­˜å‚¨çš„å®‰å…¨ï¼Œåšä¸€æ¬¡åˆæ­¥è¿‡æ»¤
                    return clean
                        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                        .replace(/on\w+="[^"]*"/g, '')
                        .replace(/on\w+='[^']*'/g, '')
                        .replace(/javascript:/gi, '');
                };
                
                // æ£€æŸ¥ç¬”è®°æ˜¯å¦æœ‰é«˜äº®
                const hasHighlights = (note) => {
                    if (!note.content) return false;
                    return note.content.includes('class="highlight"') || note.content.includes('<mark>') || note.content.includes('background-color');
                };

                // æ ¹æ®IDè·å–ç¬”è®°
                const getNoteById = (id) => {
                    return notes.value.find(note => note.id == id) || {};
                };

                // ä»ç°æœ‰ç¬”è®°ä¸­æå–æ‰€æœ‰åˆ†ç±»ï¼Œæ›´æ–°åˆ†ç±»åˆ—è¡¨
                const updateNoteCategoriesFromNotes = () => {
                    const categories = new Set(['all', 'editor', 'mindmap', 'highlights', 'wordview', 'bookNotes']);
                    notes.value.forEach(note => {
                        if (note.category && note.category !== 'general') {
                            categories.add(note.category);
                        }
                    });
                    noteCategories.value = Array.from(categories);
                };

                const resetNoteFilters = () => {
                    noteFilter.value = { tag: '', text: '', sortBy: 'newest' };
                    activeNoteTab.value = 'all';
                };

                const formatDate = (isoString) => {
                    if (!isoString) return 'N/A';
                    const date = new Date(isoString);
                    return date.toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' }) + ' ' + 
                           date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                };
                
                // ==================== æ•°æ®å­˜å‚¨ä¸åŒæ­¥ (GitHub) ====================

                const loadConfig = () => {
                    const savedConfig = localStorage.getItem('githubConfig');
                    if (savedConfig) {
                        config.value = JSON.parse(savedConfig);
                        if (isConfigValid.value) {
                            isConfigured.value = true;
                            loadGameDataFromGitHub();
                        }
                    }
                };

                const saveConfig = async () => {
                    if (!isConfigValid.value) {
                        showStatusMessage('è¯·å¡«å†™å®Œæ•´çš„GitHubé…ç½®ä¿¡æ¯ï¼', 'error');
                        return;
                    }
                    isSavingConfig.value = true;
                    localStorage.setItem('githubConfig', JSON.stringify(config.value));
                    
                    // å°è¯•ä» GitHub åŠ è½½æ•°æ®
                    const success = await loadGameDataFromGitHub();

                    if (success) {
                        isConfigured.value = true;
                        showStatusMessage('é…ç½®ä¿å­˜æˆåŠŸï¼Œæ•°æ®å·²åŒæ­¥ï¼', 'success');
                    } else {
                        // å¦‚æœåŠ è½½å¤±è´¥ï¼Œå°è¯•ä¿å­˜åˆå§‹æ•°æ®
                        const initialSave = await saveGameDataToGitHub(true);
                        if (initialSave) {
                            isConfigured.value = true;
                            showStatusMessage('é…ç½®ä¿å­˜æˆåŠŸï¼Œå·²åˆ›å»ºæ–°çš„æ•°æ®æ–‡ä»¶ã€‚', 'success', 10000);
                        } else {
                            // ä¸¤æ¬¡éƒ½å¤±è´¥ï¼Œé…ç½®ä¸é€šè¿‡
                            isConfigured.value = false;
                            showStatusMessage('é…ç½®æ— æ•ˆæˆ–æ— æ³•è¿æ¥åˆ°GitHubï¼Œè¯·æ£€æŸ¥ç”¨æˆ·å/ä»“åº“/Tokenæ˜¯å¦æ­£ç¡®ã€‚', 'error', 15000);
                        }
                    }

                    isSavingConfig.value = false;
                };
                
                // ... GitHub API äº¤äº’é€»è¾‘ (fetchGitHubContent, getSha, saveToGitHub, loadGameDataFromGitHub, saveGameDataToGitHub) ...
                
                // ç”±äºå®Œæ•´çš„ GitHub API äº¤äº’å‡½æ•°æ¶‰åŠå¤§é‡ä»£ç å’Œå¤æ‚é€»è¾‘ï¼Œä¸”ä¸æ‚¨çš„å¯Œæ–‡æœ¬ç¼–è¾‘é—®é¢˜ä¸ç›´æ¥ç›¸å…³ï¼Œè¿™é‡Œä»…ä¿ç•™å‡½æ•°ç­¾åå’Œå…³é”®é€»è¾‘ç‚¹ã€‚
                // å®é™…éƒ¨ç½²æ—¶ï¼Œè¯·ç¡®ä¿è¿™äº›å‡½æ•°åœ¨æ‚¨çš„æ–‡ä»¶ä¸­æ˜¯å®Œæ•´çš„ã€‚

                const fetchGitHubContent = async () => { /* ... API Logic ... */ return null; };
                const getSha = async () => { /* ... API Logic ... */ return null; };
                const saveToGitHub = async () => { /* ... API Logic ... */ return false; };

                const loadGameDataFromGitHub = async () => {
                    // ... load data logic ...
                    const data = await fetchGitHubContent();
                    if (data) {
                        try {
                            const gameData = JSON.parse(atob(data.content));
                            player.value = gameData.player || player.value;
                            skills.value = gameData.skills || [];
                            notes.value = gameData.notes || [];
                            achievements.value = gameData.achievements || [];
                            bookNotes.value = gameData.bookNotes || [];
                            updateAchievementProgress();
                            updateNoteCategoriesFromNotes();
                            return true;
                        } catch (e) {
                            console.error("è§£ææ•°æ®å¤±è´¥:", e);
                            return false;
                        }
                    }
                    return false;
                };

                const saveGameDataToGitHub = async (isInitial = false) => {
                    if (isSaving.value && !isInitial) {
                        console.warn("å·²ç»åœ¨åŒæ­¥ä¸­ï¼Œè·³è¿‡æœ¬æ¬¡åŒæ­¥ã€‚");
                        return false;
                    }
                    if (!isConfigured.value && !isInitial) {
                        console.error("æœªé…ç½®GitHubï¼Œæ— æ³•åŒæ­¥ã€‚");
                        return false;
                    }

                    isSaving.value = true;
                    try {
                        const gameData = {
                            player: player.value,
                            skills: skills.value,
                            notes: notes.value,
                            achievements: achievements.value,
                            bookNotes: bookNotes.value,
                            lastUpdated: new Date().toISOString()
                        };
                        const content = btoa(JSON.stringify(gameData, null, 2));

                        // ... save to github logic ...

                        const success = await saveToGitHub(content, isInitial);
                        if (success) {
                            if (!isInitial) {
                                showStatusMessage('æ•°æ®å·²è‡ªåŠ¨åŒæ­¥åˆ°GitHub', 'success', 3000);
                            }
                            return true;
                        }
                        return false;
                    } catch (e) {
                        console.error("åŒæ­¥å¤±è´¥:", e);
                        showStatusMessage('åŒæ­¥åˆ°GitHubå¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®æˆ–ç½‘ç»œã€‚', 'error');
                        return false;
                    } finally {
                        isSaving.value = false;
                    }
                };

                // ==================== æŠ€èƒ½ç³»ç»Ÿ ====================

                const getSkillXpPerPractice = (skillId) => { /* ... logic ... */ return 0; };
                const addNewSkill = () => { /* ... logic ... */ };
                const practiceSkill = async (skillId) => { /* ... logic ... */ };
                const deleteSkill = async (skillId) => { /* ... logic ... */ };

                // ==================== æˆå°±ç³»ç»Ÿ ====================

                const updateAchievementProgress = () => { /* ... logic ... */ };
                const unlockAchievement = async (achievementId) => { /* ... logic ... */ };
                const loadExampleAchievements = () => { /* ... logic ... */ };
                const clearBatchInput = () => { batchAchievementInput.value = ''; };
                const addBatchAchievements = async () => { /* ... logic ... */ };
                const deleteAchievement = async (id) => { /* ... logic ... */ };

                // ==================== è¯»ä¹¦ç¬”è®°ç³»ç»Ÿ ====================

                const saveBookNote = async () => { /* ... logic ... */ };
                const editBookNote = (id) => { /* ... logic ... */ };
                const deleteBookNote = async (id) => { /* ... logic ... */ };
                const cancelBookNote = () => { 
                    editingBookNote.value = null; 
                    showBookForm.value = false;
                    newBookNote.value = { title: '', author: '', rating: 0, note: '', reflection: '', tagsInput: '', createdAt: null };
                };
                
                // ==================== æ•°æ®å¯¼å…¥å¯¼å‡º ====================

                const openRepoInGitHub = () => { /* ... logic ... */ };
                const exportLocalData = () => { /* ... logic ... */ };
                const importLocalData = (event) => { /* ... logic ... */ };
                const loadDemoData = () => { /* ... logic ... */ };
                
                // ==================== ç¬”è®°ç³»ç»Ÿ - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ ====================

                const updateRichTextContent = () => {
                    if (richTextEditor.value) {
                        newNote.value.content = richTextEditor.value.innerHTML;
                    }
                };
                
                const formatText = (command, value = null) => {
                    if (!richTextEditor.value) return;
                    richTextEditor.value.focus();
                    
                    if (command === 'highlight') {
                        document.execCommand('backColor', false, '#ffd6cc');
                        activeFormat.value = 'highlight';
                    } else if (command === 'foreColor' || command === 'fontSize') {
                        document.execCommand(command, false, value);
                    } else if (command === 'insertCodeBlock') {
                        const codeBlock = `
                            <div class="code-block">
                                <pre>
                                    <span class="keyword">function</span> <span class="function">example</span>() {
                                        <span class="comment">// è¿™é‡Œæ˜¯ä»£ç </span>
                                        <span class="keyword">const</span> <span class="variable">message</span> = <span class="string">"Hello World"</span>;
                                        <span class="function">console</span>.<span class="function">log</span>(<span class="variable">message</span>);
                                    }
                                </pre>
                            </div>
                        `;
                        document.execCommand('insertHTML', false, codeBlock);
                        richTextEditor.value.focus();
                    } else {
                        document.execCommand(command, false, value);
                        activeFormat.value = command;
                    }
                    updateRichTextContent();
                };

                const clearFormatting = () => {
                    if (!richTextEditor.value) return;
                    document.execCommand('removeFormat', false, null);
                    document.execCommand('backColor', false, 'white'); // æ¸…é™¤èƒŒæ™¯é¢œè‰²
                    richTextEditor.value.focus();
                    activeFormat.value = null;
                    updateRichTextContent();
                };

                const saveRichTextNote = async () => {
                    if (!newNote.value.title.trim()) {
                        showStatusMessage('è¯·è¾“å…¥ç¬”è®°æ ‡é¢˜', 'error');
                        return;
                    }
                    if (!newNote.value.content.trim()) {
                        showStatusMessage('ç¬”è®°å†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
                        return;
                    }
                    
                    const tags = newNote.value.tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag);
                    
                    let noteToSave = {
                        id: editingNoteId.value || Date.now(),
                        title: newNote.value.title.trim(),
                        content: newNote.value.content,
                        tags: tags,
                        category: newNote.value.category,
                        imageData: newNote.value.imageData,
                        createdAt: editingNoteId.value ? notes.value.find(n => n.id === editingNoteId.value).createdAt : new Date().toISOString()
                    };

                    if (editingNoteId.value) {
                        const index = notes.value.findIndex(n => n.id === editingNoteId.value);
                        if (index !== -1) {
                            notes.value[index] = noteToSave;
                        }
                    } else {
                        notes.value.unshift(noteToSave);
                    }
                    
                    // æ¸…ç©ºç¼–è¾‘å™¨çŠ¶æ€
                    clearNoteEditor();
                    editingNoteId.value = null;

                    updateNoteCategoriesFromNotes();
                    updateAchievementProgress();
                    const saveSuccess = await saveGameDataToGitHub();
                    if (saveSuccess) {
                        showStatusMessage(editingNoteId.value ? 'ç¬”è®°æ›´æ–°æˆåŠŸï¼' : 'ç¬”è®°ä¿å­˜æˆåŠŸï¼', 'success');
                        activeNoteTab.value = noteToSave.category;
                    }
                };

                const editNote = (id) => {
                    const note = notes.value.find(n => n.id === id);
                    if (!note) return;
                    editingNoteId.value = id;
                    newNote.value.title = note.title;
                    newNote.value.content = note.content;
                    newNote.value.tagsInput = note.tags.join(', ');
                    newNote.value.imageData = note.imageData;
                    newNote.value.category = note.category;
                    activeNoteTab.value = 'editor';
                    if (richTextEditor.value) {
                        richTextEditor.value.innerHTML = note.content;
                    }
                };

                const deleteNote = async (id) => {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ')) return;
                    notes.value = notes.value.filter(n => n.id !== id);
                    updateAchievementProgress();
                    updateNoteCategoriesFromNotes();
                    const saveSuccess = await saveGameDataToGitHub();
                    if (saveSuccess) {
                        showStatusMessage('ç¬”è®°å·²åˆ é™¤ï¼', 'success');
                    }
                };

                const clearNoteEditor = () => {
                    newNote.value = { title: '', content: '', tagsInput: '', imageData: null, category: 'general' };
                    editingNoteId.value = null;
                    if (richTextEditor.value) {
                        richTextEditor.value.innerHTML = '';
                    }
                };

                const previewNote = () => {
                    // ç®€å•çš„é¢„è§ˆï¼Œç›´æ¥åœ¨å½“å‰çª—å£æ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µ
                    const content = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>${newNote.value.title || 'ç¬”è®°é¢„è§ˆ'}</title>
                            <style>
                                body { font-family: 'Microsoft YaHei', 'SimHei', sans-serif, 'Comic Neue', cursive; line-height: 1.8; padding: 30px; }
                                h1 { color: #5a4a42; border-bottom: 2px dashed #ff9a8b; padding-bottom: 10px; margin-bottom: 20px; }
                                .highlight { background: #ffd6cc; padding: 2px 4px; border-radius: 4px; border: 1px dotted #ff6b6b; font-weight: bold; }
                                .code-block pre { background: #f5f5f5; padding: 15px; border-left: 5px solid #4ecdc4; overflow-x: auto; font-family: monospace; white-space: pre-wrap; word-wrap: break-word; }
                                img { max-width: 100%; height: auto; border-radius: 10px; margin-top: 15px; }
                            </style>
                        </head>
                        <body>
                            <h1>${newNote.value.title || 'æ— æ ‡é¢˜'}</h1>
                            ${newNote.value.imageData ? `<img src="${newNote.value.imageData}" alt="å›¾ç‰‡">` : ''}
                            <div style="margin-top: 20px;">
                                ${newNote.value.content}
                            </div>
                        </body>
                        </html>
                    `;
                    const previewWindow = window.open('', '_blank');
                    previewWindow.document.write(content);
                    previewWindow.document.close();
                };

                // ==================== ç¬”è®°ç³»ç»Ÿ - å›¾ç‰‡ä¸Šä¼  ====================

                const handleImageUpload = (event) => { /* ... logic ... */ };
                const clearUploadedImage = () => { newNote.value.imageData = null; };
                const handleImageError = (event) => { /* ... logic ... */ };

                // ==================== ç¬”è®°ç³»ç»Ÿ - æ€ç»´å¯¼å›¾ ====================

                const loadSampleMindmap = () => { /* ... logic ... */ };
                const addMindmapNode = () => { /* ... logic ... */ };
                const editMindmapNodeById = (id) => { /* ... logic ... */ };
                const removeMindmapNode = () => { /* ... logic ... */ };
                const clearMindmap = () => { /* ... logic ... */ };
                const selectMindmapNode = (id) => { /* ... logic ... */ };
                const toggleRootNode = () => { /* ... logic ... */ };
                const startNodeDrag = (node, event) => { /* ... logic ... */ };
                const handleNodeDrag = (event) => { /* ... logic ... */ };
                const endNodeDrag = () => { /* ... logic ... */ };
                const addNodeAtPosition = (event) => { /* ... logic ... */ };
                const saveMindmapAsNote = async () => { /* ... logic ... */ };

                // ==================== ç¬”è®°ç³»ç»Ÿ - é«˜äº®æå– ====================
                
                const extractHighlights = () => { /* ... logic ... */ };
                const copyHighlight = (content) => { /* ... logic ... */ };
                const removeHighlight = (index) => { /* ... logic ... */ };
                const saveHighlightsNote = async () => { /* ... logic ... */ };

                // ==================== ç¬”è®°ç³»ç»Ÿ - Wordé¢„è§ˆ ====================

                const printPreview = () => { /* ... logic ... */ };

                // ==================== Watchers ====================
                watch(notes, updateNoteCategoriesFromNotes, { deep: true });
                watch(bookNotes, updateAchievementProgress, { deep: true });
                watch(skills, updateAchievementProgress, { deep: true });
                watch([player, skills, notes, achievements, bookNotes], () => {
                    // è‡ªåŠ¨ä¿å­˜ (ç®€åŒ–ç‰ˆï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„èŠ‚æµ)
                    saveGameDataToGitHub();
                }, { deep: true, immediate: false });
                
                // ==================== ç”Ÿå‘½å‘¨æœŸé’©å­ ====================

                onMounted(() => {
                    loadConfig();
                    // ç»‘å®šæ‹–æ‹½äº‹ä»¶åˆ° window ç¡®ä¿æ‹–æ‹½ä¸ä¸¢å¤±
                    window.addEventListener('mousemove', handleNodeDrag);
                    window.addEventListener('mouseup', endNodeDrag);
                });

                // ==================== æš´éœ²ç»™æ¨¡æ¿ ====================
                return {
                    // é…ç½®
                    config, isConfigured, isConfigValid, isSaving, isSavingConfig, statusMessage,
                    showImport, saveConfig, loadDemoData, openRepoInGitHub, exportLocalData, importLocalData,
                    
                    // ç©å®¶
                    player, xpPercentage, 
                    
                    // æŠ€èƒ½
                    skills, filteredSkills, newSkillName, newSkillIcon, newSkillXp, newSkillMaxXp, newSkillCategory,
                    getSkillXpPerPractice, addNewSkill, practiceSkill, deleteSkill,

                    // ç¬”è®°
                    notes, activeNoteTab, noteCategories, getCategoryDisplayName, 
                    newNote, richTextEditor, updateRichTextContent, formatText, clearFormatting,
                    saveRichTextNote, clearNoteEditor, editNote, deleteNote, previewNote,
                    handleImageUpload, clearUploadedImage, handleImageError, filteredAndSortedNotes,
                    activeFormat, selectedColor, selectedFontSize, noteFilter, resetNoteFilters,
                    
                    // ç¬”è®°ç»Ÿè®¡
                    totalNoteTags,

                    // æˆå°±
                    achievements, filteredAchievements, unlockedAchievements, activeAchievementTab,
                    loadExampleAchievements, showBatchAdd, batchAchievementInput, clearBatchInput, addBatchAchievements, deleteAchievement,

                    // è¯»ä¹¦ç¬”è®°
                    bookNotes, showBookForm, editingBookNote, newBookNote, 
                    saveBookNote, editBookNote, deleteBookNote, cancelBookNote,
                    bookFilterText, filteredBookNotes, averageBookRating, totalBookTags,

                    // æ€ç»´å¯¼å›¾
                    mindmapNodes, mindmapNodeText, mindmapContainer, mindmapSelectedNode, mindmapRootNode, mindmapLines,
                    addMindmapNode, editMindmapNodeById, removeMindmapNode, clearMindmap, loadSampleMindmap,
                    startNodeDrag, handleNodeDrag, endNodeDrag, addNodeAtPosition, saveMindmapAsNote,
                    selectMindmapNode, toggleRootNode,

                    // é«˜äº®æå–
                    highlightSourceNote, extractedHighlights, newNoteTitleFromHighlights, newNoteFromHighlights,
                    extractHighlights, copyHighlight, removeHighlight, saveHighlightsNote,

                    // Wordé¢„è§ˆ
                    selectedNoteForPreview, printPreview, getNoteById,

                    // é€šç”¨
                    formatDate, sanitizeHtml, hasHighlights, 
                    
                    // åŒæ­¥ä¸é‡ç½®
                    saveGameDataToGitHub, 
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
